!function(e){function t(o){if(i[o])return i[o].exports;var r=i[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,o){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=24)}([function(e,t,i){var o;void 0!==(o=function(){"use strict";function e(){this._FreedoXURL=void 0}return e.isNumber=function(e){return"number"==typeof e&&isFinite(e)},e.calculateLength=function(e){for(var t=0,i=1;i<e.length;++i)t+=Freedo.Cartesian3.distance(e[i-1],e[i]);return t},e.getLengthText=function(e){return e>1e3?(e/1e3).toFixed(2)+"千米":e.toFixed(2)+"米"},e.getCenter=function(e,t){var i=new Freedo.Cartesian3;return Freedo.Cartesian3.add(e,t,i),Freedo.Cartesian3.multiplyByScalar(i,.5,i),i},e.round=function(e,t){var i=Math.pow(10,t);return 1*Math.round(i*e)/i},e.round2=function(e,t){var i=Math.pow(10,t);return 1*Math.round(i*e)/i},e.getLongAndLatRatio=function(e){var t=e.clone();t.latitude+=1e-7;var i=new FreeDo.EllipsoidGeodesic,o=t.clone();o.longitude+=.001,i.setEndPoints(t,o);var r=.001/i.surfaceDistance,n=new FreeDo.EllipsoidGeodesic,s=t.clone();return s.latitude+=.001,n.setEndPoints(t,s),[r,.001/n.surfaceDistance]},e.pickPosition=function(e,t){var i,o=void 0,r=!1,n=e.scene,s=n.pick(t);if(n.pickPositionSupported&&Freedo.defined(s)&&(i=n.pickPosition(t))){n.globe.ellipsoid.cartesianToCartographic(i).height>-1e4&&(r=!0,o=i)}if(!r){var a=n.camera.getPickRay(t);i=n.globe.pick(a,n),o=i,r=!0}return o},e.pickPositionG=function(t,i){var o=e.pickPosition(t,i);if(o){var r=[],n=Freedo.Cartographic.fromCartesian(o),s=Freedo.Math.toDegrees;return r[0]=s(n.longitude),r[1]=s(n.latitude),r[2]=n.height,r}return[0,0,0]},e.tc=function(e){var t=Freedo.Math.toRadians;return Freedo.Cartesian3.fromRadians(t(e[0]),t(e[1]),e[2])},e.leftOfLine=function(e,t,i){var o=e.x,r=e.y,n=t.x,s=t.y,a=i.x,h=i.y;return((o-a)*(s-h)-(r-h)*(n-a))/2>0?1:-1},e.calcAngle=function(t,i,o,r){var n=[i.x-t.x,i.y-t.y],s=[r.x-o.x,r.y-o.y],a=(n[0]*s[0]+n[1]*s[1])/(Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2))*Math.sqrt(Math.pow(s[0],2)+Math.pow(s[1],2)));return Freedo.Math.toDegrees(Math.acos(a))*e.leftOfLine(t,i,r)},e.getFreedoXPath=function(){if(void 0===this._FreedoXURL)for(var e=document.getElementsByTagName("script"),t=0;t<e.length;t++){var i=e[t].getAttribute("src");Freedo.defined(i)&&-1!==i.indexOf("FreedoX.js")&&(this._FreedoXURL=i.substr(0,i.indexOf("FreedoX.js")))}return this._FreedoXURL},e}.call(t,i,t,e))&&(e.exports=o)},function(e,t,i){var o,r;o=[i(0),i(6)],void 0!==(r=function(e,t){"use strict";function i(e){this._viewer=e.getViewer(),this._points={},this._ptsSmoothed=[],this._project=e,this._event=new FreeDo.Event,this._eventHelper=new FreeDo.EventHelper,this._kb=e.getKeyboard(),this._kbCallback=void 0,this._bKBActive=!1,this._lines=[],this._bStop=!0,this._bPause=!0,this._bPauseMannul=0,this._bRun=!1,this._dPitch=-30,this._dOffsetH=0,this._dHeight=100,this._dSpeed=1e3,this._bLock=1,this._lastTS=0,this._timeUsed=0,this._totalLen=0,this._passedLen=0,this._dHeading=0,this._pathPL=void 0,this._smoothRate=2,this.addKBLsnr(),this._showPath=!1,this._loop=!1,this._pathViewMode=!1,this._aTmpPoint=[],this._centerPt=void 0}return i.prototype.start=function(){if(!this._bRun){var e=this;this._bRun=!0,this._viewer.scene.preRender.addEventListener(function(){e.tick()})}(this._bStop||1==this._bPauseMannul)&&(this._bStop&&(this._bStop=!1,this._bPause=!1,this._bPauseMannul=2,this._startTime=0,this._timeUsed=0),1==this._bPauseMannul&&(this._bPauseMannul=2,console.log(this._bPauseMannul)),this._event.raiseEvent("StatusChanged",{status:"play"}),this._kb.setFocus())},i.prototype.enable=function(){this._bKBActive=!0},i.prototype.disable=function(){this._bKBActive=!1},i.prototype.getKeyboardStatus=function(){return this._bKBActive},i.prototype.addKBLsnr=function(){var e=this;this._kbCallback=this._kb.on(function(t,i){if("timer"===t)return void e.onKeyboard(i.metaData)}),this._kb.enable()},i.prototype.onKeyboard=function(e){if(this._bKBActive&&0!=this._points.length){if(e[33]){this._bPauseMannul=1;var t=33.3/1e3*this._dSpeed;this.kbtick(t)}if(e[34]){this._bPauseMannul=1;var t=-33.3/1e3*this._dSpeed;this.kbtick(t)}}},i.prototype.stop=function(){this._bStop||(this._bStop=!0,this._event.raiseEvent("StatusChanged",{status:"stop"}),this._kb.setFocus(),this._centerPt&&(this._viewer.entities.remove(this._centerPt),this._centerPt=void 0),this._project.getCamera().unTrack())},i.prototype.pause=function(){this._bStop||(this._bPauseMannul=1,this._event.raiseEvent("StatusChanged",{status:"pause"}),this._kb.setFocus())},i.prototype.getSpeed=function(){return this._dSpeed},i.prototype.setSpeed=function(e){this._dSpeed=e},i.prototype.getPitch=function(){return this._dPitch},i.prototype.setPitch=function(e){this._dPitch=-1*e},i.prototype.setOffsetH=function(e){this._dOffsetH=e,this.smoothPath()},i.prototype.setPathViewMode=function(e){this._pathViewMode=e},i.prototype.setSmoothRate=function(e){this._smoothRate=e,this.smoothPath()},i.prototype.getHeight=function(){return this._dHeight},i.prototype.setHeight=function(e){this._dHeight=e},i.prototype.setHeading=function(e){this._dHeading=e},i.prototype.setPathShow=function(e){this._showPath!==e&&this._event.raiseEvent("PathStatusChanged",{status:this._showPath}),this._showPath=e,this.showPath()},i.prototype.getStatus=function(){return this._bStop?"stop":1==this._bPauseMannul?"pause":"play"},i.prototype.showPath=function(){if(this._showPath){void 0!==this._pathPL&&(this._viewer.entities.remove(this._pathPL),this._pathPL=void 0);for(var e in this._aTmpPoint)this._viewer.entities.remove(this._aTmpPoint[e]);this._aTmpPoint=[];for(var t=0;t<this._points.length;t++){var i=Freedo.Cartesian3.fromDegrees(this._points[t][0],this._points[t][1],this._points[t][2]+this._dOffsetH),o=this._viewer.entities.add({position:i,point:{color:Freedo.Color.RED,pixelSize:10,disableDepthTestDistance:Number.POSITIVE_INFINITY,show:!0}});this._aTmpPoint.push(o)}this._pathPL=this._viewer.entities.add({name:"MeasureLine",polyline:{positions:this._ptsSmoothed,width:3,material:Freedo.Color.YELLOW,depthFailMaterial:Freedo.Color.YELLOW}})}else{this._viewer.entities.remove(this._pathPL),this._pathPL=void 0;for(var e in this._aTmpPoint)this._viewer.entities.remove(this._aTmpPoint[e])}this._kb.setFocus()},i.prototype.calVectorOri=function(e,t){var i=FreeDo.Cartographic.fromCartesian(e),o=FreeDo.Cartographic.fromCartesian(t);return o.longitude>i.longitude&&o.latitude>i.latitude?1:o.longitude>i.longitude&&o.latitude<i.latitude?2:o.longitude<i.longitude&&o.latitude<i.latitude?3:o.longitude<i.longitude&&o.latitude>i.latitude?4:void 0},i.prototype.calVectorHeading=function(e,t){var i=FreeDo.Cartographic.fromCartesian(e),o=FreeDo.Cartographic.fromCartesian(t);return Math.atan((o.longitude-i.longitude)/(o.latitude-i.latitude))},i.prototype.calcCP=function(e,t,i){var o,r,n;o=e.position,r=t.position,n=i.position;var s=FreeDo.Cartesian3.subtract(o,r,new FreeDo.Cartesian3),a=FreeDo.Cartesian3.subtract(n,r,new FreeDo.Cartesian3),h=FreeDo.Cartesian3.cross(s,a,new FreeDo.Cartesian3),l=FreeDo.Cartesian3.normalize(s,new FreeDo.Cartesian3),c=FreeDo.Cartesian3.normalize(a,new FreeDo.Cartesian3),d=FreeDo.Cartesian3.add(l,c,new FreeDo.Cartesian3),p=Freedo.Quaternion.fromAxisAngle(h,Freedo.Math.PI_OVER_TWO,new Freedo.Quaternion),_=Freedo.Quaternion.fromAxisAngle(h,-1*Freedo.Math.PI_OVER_TWO,new Freedo.Quaternion),u=Freedo.Matrix3.fromQuaternion(p,new Freedo.Matrix3),v=Freedo.Matrix3.fromQuaternion(_,new Freedo.Matrix3),f=Freedo.Matrix3.multiplyByVector(u,d,new Freedo.Cartesian3),g=Freedo.Matrix3.multiplyByVector(v,d,new Freedo.Cartesian3),y=FreeDo.Cartesian3.normalize(f,new FreeDo.Cartesian3),m=FreeDo.Cartesian3.normalize(g,new FreeDo.Cartesian3),C=FreeDo.Cartesian3.distance(o,r),F=FreeDo.Cartesian3.distance(n,r),w=1;w=C<F?C/4:F/4,y=FreeDo.Cartesian3.multiplyByScalar(y,w,new FreeDo.Cartesian3),m=FreeDo.Cartesian3.multiplyByScalar(m,w,new FreeDo.Cartesian3);var b=FreeDo.Cartesian3.add(r,y,new FreeDo.Cartesian3),P=FreeDo.Cartesian3.add(r,m,new FreeDo.Cartesian3);return FreeDo.Cartesian3.distance(o,b)<FreeDo.Cartesian3.distance(o,P)?[b,P]:[P,b]},i.prototype.smoothPolyline=function(e){var i=[];if(e.length<3)for(var o=0;o<e.length;o++)i.push(e[o].position);else for(var o=0;o<=e.length-2;o++){var r={},n={},s={},a={};0==o?(r=e[0],n.position=this.calcCP(e[0],e[1],e[2])[0],s=e[0],a=e[1]):o==e.length-2?(r.position=this.calcCP(e[o-1],e[o],e[o+1])[1],n=e[o+1],s=e[o],a=e[o+1]):(r.position=this.calcCP(e[o-1],e[o],e[o+1])[1],n.position=this.calcCP(e[o],e[o+1],e[o+2])[0],s=e[o],a=e[o+1]);var h=new t(s,a,r,n),l=h.getVertexForCurve(this._smoothRate);i=i.concat(l)}for(var c=[],o=0;o<i.length;o++){var d={};if(d=i[o],c.length>0){FreeDo.Cartesian3.distance(c[c.length-1],d)>1e-4&&c.push(d)}else c.push(d)}return c},i.prototype.calcHeading=function(e){var t=this.calVectorHeading(this._ptsSmoothed[e],this._ptsSmoothed[e+1]),i=this.calVectorOri(this._ptsSmoothed[e],this._ptsSmoothed[e+1]);return t=Freedo.Math.toDegrees(t),1==i&&(t+=0),2==i&&(t+=180),3==i&&(t+=180),4==i&&(t+=360),t},i.prototype.smoothPath=function(){if(this._points){for(var t=[],i=0;i<this._points.length;i++){var o=Freedo.Cartesian3.fromDegrees(this._points[i][0],this._points[i][1],this._points[i][2]+this._dOffsetH);t.push({position:o})}this._ptsSmoothed=this.smoothPolyline(t),this.showPath(),this._totalLen=e.calculateLength(this._ptsSmoothed),this._kb.setFocus()}},i.prototype.getTotalLength=function(){return this._totalLen},i.prototype.setPoints=function(e){this._points=e,this.smoothPath()},i.prototype.setLoop=function(e){this._loop=e},i.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},i.prototype.callbackCenter=function(e,t){return this._center},i.prototype.gotoSubByLength=function(e,t,i){var o=0,r=0,n=0,s=0;o=this.calcHeading(e),r=e==this._ptsSmoothed.length-2?o:this.calcHeading(e+1);var n=o+t/i*(r-o);if(o+180<r){var a=360-r+o;t/i<o/a?(n=o-t/i/(o/a)*o)<0&&(n+=360):n=360-(t/i-o/a)/((360-r)/a)*(360-r)}if(o-180>r){var a=360-o+r;t/i<(360-o)/a?(n=o+t/i/((360-o)/a)*(360-o))>360&&(n-=360):n=(t/i-(360-o)/a)/(r/a)*r}var h={};h.x=this._ptsSmoothed[e].x+t/i*(this._ptsSmoothed[e+1].x-this._ptsSmoothed[e].x),h.y=this._ptsSmoothed[e].y+t/i*(this._ptsSmoothed[e+1].y-this._ptsSmoothed[e].y),h.z=this._ptsSmoothed[e].z+t/i*(this._ptsSmoothed[e+1].z-this._ptsSmoothed[e].z);var l=FreeDo.Cartographic.fromCartesian(h),c=FreeDo.Math.toDegrees(l.longitude),d=FreeDo.Math.toDegrees(l.latitude),p=Freedo.Cartesian3.fromDegrees(c,d,l.height);if(this._center=p,!this._centerPt){var _=new Freedo.CallbackProperty(this.callbackCenter.bind(this),!1);this._centerPt=this._viewer.entities.add({position:_,point:{color:Freedo.Color.GREEN,pixelSize:10,disableDepthTestDistance:Number.POSITIVE_INFINITY,show:!0}})}n=Freedo.Math.toRadians(n+this._dHeading),s=Freedo.Math.toRadians(this._dPitch),this._viewer.camera.lookAt(p,new Freedo.HeadingPitchRange(n,s,this._dHeight))},i.prototype.gotoSubByLengthUsePathViewMode=function(e,t,i){var o={};o.x=this._ptsSmoothed[e].x+t/i*(this._ptsSmoothed[e+1].x-this._ptsSmoothed[e].x),o.y=this._ptsSmoothed[e].y+t/i*(this._ptsSmoothed[e+1].y-this._ptsSmoothed[e].y),o.z=this._ptsSmoothed[e].z+t/i*(this._ptsSmoothed[e+1].z-this._ptsSmoothed[e].z);var r=FreeDo.Cartographic.fromCartesian(o),n=FreeDo.Math.toDegrees(r.longitude),s=FreeDo.Math.toDegrees(r.latitude),a=Freedo.Cartesian3.fromDegrees(n,s,r.height+this._dHeight),h=FreeDo.Cartesian3.subtract(this._ptsSmoothed[e+1],this._ptsSmoothed[e],new FreeDo.Cartesian3),l=Freedo.Cartesian3.normalize(h,new Freedo.Cartesian3),c=Freedo.Cartesian3.normalize(a,new Freedo.Cartesian3);this._viewer.camera.setView({destination:a,orientation:{direction:l,up:c}}),a=null,h=null,c=null},i.prototype.gotoByLength=function(e){for(var t=0,i=0,o=0;o<this._ptsSmoothed.length-1;o++)i=FreeDo.Cartesian3.distance(this._ptsSmoothed[o],this._ptsSmoothed[o+1]),e>t&&e<t+i&&(this._pathViewMode?this.gotoSubByLengthUsePathViewMode(o,e-t,i):this.gotoSubByLength(o,e-t,i)),t+=i},i.prototype.tick=function(){var e=(new Date).getTime();if(this._bStop)return this._lastTS=0,void(this._timeUsed=0);this._bStop||this._bPause||!Freedo.defined(e)||0!=this._bPauseMannul&&2!=this._bPauseMannul||(0==this._lastTS?this._lastTS=e:(this._timeUsed+=e-this._lastTS,this._passedLen=this._timeUsed/1e3*this._dSpeed,this._passedLen<this._totalLen?this.gotoByLength(this._passedLen):(this.stop(),this._event.raiseEvent("Finished",{status:"Finished"}),this._loop&&this.start()))),this._lastTS=e},i.prototype.kbtick=function(e){this._timeUsed+=33*e/Math.abs(e),this._passedLen+=e,this._passedLen<=0&&(this._passedLen=0,this._timeUsed=0,console.log("重新播放:"+this._passedLen)),this._passedLen<this._totalLen?this.gotoByLength(this._passedLen):(this._passedLen=0,this._timeUsed=0)},i.prototype.clear=function(){for(var e in this._lines)this._viewer.entities.remove(this._lines[e]);this._pathPL&&(this._viewer.entities.remove(this._pathPL),this._pathPL=void 0);for(var e in this._aTmpPoint)this._viewer.entities.remove(this._aTmpPoint[e]);this._aTmpPoint=[],this._centerPt&&(this._viewer.entities.remove(this._centerPt),this._centerPt=void 0)},i.prototype.reset=function(){this.clear(),this._bStop=!0,this._points=void 0},i.prototype.dispose=function(){this.reset()},i}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o,r;o=[i(0)],void 0!==(r=function(e){"use strict";function t(e){this._viewer=e.getViewer(),this._polylines={},this._project=e,this._event=new FreeDo.Event,this._eventHelper=new FreeDo.EventHelper,this._curGuid="",this._startPoint=void 0,this._tempLine=void 0,this._tempPoint={},this._startCapture=!1,this._bKeydown=!1,this._lineWidth=2,this._autoLoop=!0,this._singleLineMode=!1,this._hanlder=void 0}return t.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},t.prototype.run=function(){this.registerHandlers(),this._startCapture=!0,this._event.raiseEvent("Start",{})},t.prototype.start=function(){this.run()},t.prototype.setAutoLoop=function(e){this._autoLoop=e},t.prototype.onKeyDown=function(){this._startCapture&&(this.bKeydown=!0,27==window.event.keyCode&&this.onMouseRightClick(void 0))},t.prototype.onKeyUp=function(){this._startCapture&&(this.bKeydown=!1)},t.prototype.setStartPt=function(e){this._startPoint=e,this._curGuid=Freedo.createGuid(),this._polylines[this._curGuid]={},this._polylines[this._curGuid].lines=[],this._polylines[this._curGuid].pts=[],this._polylines[this._curGuid].pts[0]=e},t.prototype.callbackX=function(){return[this._startPoint,this._tempPoint]},t.prototype.updateTmpLine=function(t){var i=e.pickPositionG(this._viewer,t);if(0!=i[0]){var o=e.tc(i);if(this._tempPoint=o,void 0===this._tempLine){var r=new Freedo.CallbackProperty(this.callbackX.bind(this),!1);this._tempLine=this._viewer.entities.add({name:"MeasureLine",polyline:{positions:r,width:this._lineWidth,material:Freedo.Color.RED,depthFailMaterial:Freedo.Color.RED}})}}},t.prototype.removeTmpLine=function(){this._tempLine&&(this._viewer.entities.remove(this._tempLine),this._tempLine=void 0)},t.prototype.addResult=function(e){var t=[this._startPoint,e],i=this._viewer.entities.add({name:"MeasureLine",polyline:{positions:t,width:this._lineWidth,material:Freedo.Color.RED,depthFailMaterial:Freedo.Color.RED}});Freedo.defined(this._polylines[this._curGuid])&&(this._polylines[this._curGuid].lines.push(i),this._polylines[this._curGuid].pts.push(e)),this._startPoint=FreeDo.clone(e,!0),this._endPoint=void 0},t.prototype.pickStartPoint=function(t){var i=e.pickPositionG(this._viewer,t);0!=i[0]&&(this._startPoint=e.tc(i),this._polylines[this._curGuid].pts.push(e.tc(i)),this._event.raiseEvent("PointAdded",{position:i}))},t.prototype.pickEndPoint=function(t){var i=e.pickPositionG(this._viewer,t);0!=i[0]&&(this.addResult(e.tc(i)),this._event.raiseEvent("PointAdded",{position:i}))},t.prototype.onMouseLeftClick=function(e){this._startCapture&&(""==this._curGuid&&(this._curGuid=Freedo.createGuid(),this._polylines[this._curGuid]={},this._polylines[this._curGuid].lines=[],this._polylines[this._curGuid].pts=[]),Freedo.defined(this._polylines[this._curGuid])&&(this._startPoint?this.pickEndPoint(e.position):this.pickStartPoint(e.position)))},t.prototype.delResult=function(e){e||(e=this._curGuid);var t=this._polylines[e].lines;if(t)for(var i in t){var o=t[i];this._viewer.entities.remove(o)}delete this._polylines[e]},t.prototype.polylineAdded=function(){this._event.raiseEvent("PLAdd",{id:this._curGuid,polyline:this._polylines[this._curGuid]})},t.prototype.onMouseRightClick=function(e){if(this._startCapture&&this._startPoint){var t=this._polylines[this._curGuid].pts[0],i=this._polylines[this._curGuid].pts[this._polylines[this._curGuid].pts.length-1];if(this._loop){var o=this._viewer.entities.add({name:"MeasureLine",polyline:{positions:[i,t],width:this._lineWidth,material:Freedo.Color.RED,depthFailMaterial:Freedo.Color.RED}});this._polylines[this._curGuid].lines.push(o),this._polylines[this._curGuid].pts.push(t),this._polylines[this._curGuid].pts.length<=3&&this.delResult(this._curGuid)}else this._polylines[this._curGuid].pts.length<=1&&this.delResult(this._curGuid);this.polylineAdded(),this.removeTmpLine(),this._startPoint=void 0,this._curGuid=""}},t.prototype.onMouseMove=function(e){this._startCapture&&this._startPoint&&!FreeDo.Cartesian3.equals(e.endPosition,e.startPosition)&&this.updateTmpLine(e.endPosition)},t.prototype.registerHandlers=function(){this._hanlder=this._hanlder&&this._hanlder.destroy(),this._hanlder=new FreeDo.ScreenSpaceEventHandler(this._viewer.scene.canvas),this._hanlder.setInputAction(this.onMouseLeftClick.bind(this),FreeDo.ScreenSpaceEventType.LEFT_CLICK),this._hanlder.setInputAction(this.onMouseRightClick.bind(this),FreeDo.ScreenSpaceEventType.RIGHT_CLICK),this._hanlder.setInputAction(this.onMouseMove.bind(this),FreeDo.ScreenSpaceEventType.MOUSE_MOVE)},t.prototype.cancel=function(){for(var e in this._polylines){for(var t in this._polylines[e].lines){var i=this._polylines[e].lines[t];this._viewer.entities.remove(i)}delete this._polylines[e]}this.removeTmpLine(),this._startPoint=void 0,this._curGuid="",this._startCapture=!1,this._hanlder&&(this._hanlder.removeInputAction(Freedo.ScreenSpaceEventType.LEFT_CLICK),this._hanlder.removeInputAction(Freedo.ScreenSpaceEventType.RIGHT_CLICK),this._hanlder.removeInputAction(Freedo.ScreenSpaceEventType.MOUSE_MOVE)),this._event.raiseEvent("Cancel",{})},t.prototype.reset=function(){this.cancel()},t.prototype.dispose=function(){this.reset()},t}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o,r;o=[i(28)],void 0!==(r=function(e){"use strict";function t(e){return void 0===e?void 0:Freedo.Math.toDegrees(e)}function i(e,i){void 0===i&&(i=[]);var o=e.positionCartographic;i[0]=t(o.longitude),i[1]=t(o.latitude),i[2]=o.height,i[3]=t(e.heading),i[4]=t(e.pitch),i[5]=t(e.roll)}function o(t){function o(e,t){return void 0===t&&(t={}),t.position=e.positionWC.clone(),t.heading=e.heading,t.pitch=e.pitch,t.roll=e.roll,t}this._viewer=t,this._scene=t.scene,this._camera=t.camera,this._flying=!1,this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper;var r=Freedo.Math.toDegrees(this._camera.positionCartographic.longitude),n=Freedo.Math.toDegrees(this._camera.positionCartographic.latitude),s=this._camera.positionCartographic.height,a=Freedo.Math.toDegrees(this._camera.heading),h=Freedo.Math.toDegrees(this._camera.pitch),l=Freedo.Math.toDegrees(this._camera.roll);this._currentCameraInfo=[r,n,s,a,h,l],this._cameraPath=[],this._cameraPathCurrentIndex=-1,this._cameraHistoryStatus={nextActive:!1,prevActive:!1},this._lastHistoryOpFrameCount=0,this._delayRecordViewValid=!0;var c=this;this.delayRecordView=_.debounce(function(){var e=c._camera;if(c._delayRecordViewValid){var t=o(e);c._cameraPath.length>=10&&(c._cameraPath.splice(0,1),c.cameraPathCurrentIndex=c.cameraPathCurrentIndex-1),c._cameraPath.splice(c.cameraPathCurrentIndex+1,c._cameraPath.length-1-c.cameraPathCurrentIndex,t),c.cameraPathCurrentIndex=c._cameraPath.length-1}},1e3),this.delayRecordView(),this._camera.percentageChanged=1e-4,this._camera.changed.addEventListener(function(){var e=c._camera;c._scene._frameState.frameNumber<=c._lastHistoryOpFrameCount?c._delayRecordViewValid=!1:(c._delayRecordViewValid=!0,c.delayRecordView()),i(e,c._currentCameraInfo),c._event.raiseEvent("Changed",c._currentCameraInfo)}),this._captureManager=new e(t)}return Object.defineProperties(o.prototype,{cameraPathCurrentIndex:{get:function(){return this._cameraPathCurrentIndex},set:function(e){this._cameraPathCurrentIndex=e,this._updateCameraHistoryStatus()}}}),o.prototype.moveForward=function(e){this._camera.moveForward(e),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)},o.prototype.moveBackward=function(e){this._camera.moveBackward(e),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)},o.prototype.moveLeft=function(e){this._camera.moveLeft(e),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)},o.prototype.moveRight=function(e){this._camera.moveRight(e),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)},o.prototype.moveUp=function(e){this._camera.moveUp(e),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)},o.prototype.moveDown=function(e){this._camera.moveDown(e),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)},o.prototype.lookDown=function(e){this._camera.lookDown(FreeDo.Math.toRadians(e)),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)},o.prototype.lookLeft=function(e){var t=this._camera.positionWC,o=Freedo.Matrix4.clone(this._camera.transform,o);this.lookAtTransform(Freedo.Matrix4.IDENTITY),this._camera.look(t,Freedo.Math.toRadians(-1*parseInt(e))),this.lookAtTransform(o),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)},o.prototype.lookRight=function(e){var t=this._camera.positionWC,o=Freedo.Matrix4.clone(this._camera.transform,o);this.lookAtTransform(Freedo.Matrix4.IDENTITY),this._camera.look(t,Freedo.Math.toRadians(parseInt(e))),this.lookAtTransform(o),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)},o.prototype.lookUp=function(e){this._camera.lookUp(FreeDo.Math.toRadians(e)),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)},o.prototype._updateCameraHistoryStatus=function(){var e=this._cameraHistoryStatus,t=e.prevActive,i=e.nextActive;e.nextActive=this.cameraPathCurrentIndex!==this._cameraPath.length-1,e.prevActive=this.cameraPathCurrentIndex>0,t==e.prevActive&&i==e.nextActive||this._event.raiseEvent("cameraHistoryStatusChanged",e)},o.prototype.prev=function(){if(0!=this._cameraPath.length){this._camera.cancelFlight();var e={};if(this._lastHistoryOpFrameCount=Number.MAX_SAFE_INTEGER,this.cameraPathCurrentIndex>0){this.cameraPathCurrentIndex-=1;var t=this._cameraPath[this.cameraPathCurrentIndex];e.destination=t.position,e.orientation={heading:t.heading,pitch:t.pitch,roll:t.roll},e.duration=1;var o=this;e.complete=function(){o._lastHistoryOpFrameCount=o._scene._frameState.frameNumber},e.cancel=function(){o._lastHistoryOpFrameCount=o._scene._frameState.frameNumber};var r=this._camera;Freedo.Matrix4.equals(r.transform,Freedo.Matrix4.IDENTITY)||(e.endTransform=Freedo.Matrix4.clone(r.transform),r.lookAtTransform(Freedo.Matrix4.IDENTITY)),this._camera.flyTo(e),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)}}},o.prototype.next=function(){if(0!=this._cameraPath.length){this._camera.cancelFlight();var e={};if(this._lastHistoryOpFrameCount=Number.MAX_SAFE_INTEGER,this.cameraPathCurrentIndex+1<this._cameraPath.length){this.cameraPathCurrentIndex=this.cameraPathCurrentIndex+1;var t=this._cameraPath[this.cameraPathCurrentIndex];e.destination=t.position,e.orientation={heading:t.heading,pitch:t.pitch,roll:t.roll},e.duration=1;var o=this;e.complete=function(){o._lastHistoryOpFrameCount=o._scene._frameState.frameNumber},e.cancel=function(){o._lastHistoryOpFrameCount=o._scene._frameState.frameNumber};var r=this._camera;Freedo.Matrix4.equals(r.transform,Freedo.Matrix4.IDENTITY)||(e.endTransform=Freedo.Matrix4.clone(r.transform),r.lookAtTransform(Freedo.Matrix4.IDENTITY)),this._camera.flyTo(e),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)}}},Object.defineProperties(o.prototype,{heading:{get:function(){return Freedo.Math.toDegrees(this._camera.heading)},set:function(e){var t=this.getCurrentCameraInfo();t[3]=e,t[5]=0,this.flytoByCameraInfo(t,{duration:.3})}},cameraStatus:{get:function(){return this._cameraHistoryStatus}}}),o.prototype.getCurrentCameraInfo=function(e){void 0===e&&(e=[]);for(var t=0;t<6;++t)e[t]=this._currentCameraInfo[t];return e},o.prototype.flytoByCameraInfo=function(e,t){var o=this.getCurrentCameraInfo();if(_.isEqual(o,e))return!1;var r,n=e,s=this._camera;Freedo.Matrix4.equals(s.transform,Freedo.Matrix4.IDENTITY)||(r=Freedo.Matrix4.clone(s.transform,r),s.lookAtTransform(Freedo.Matrix4.IDENTITY));var a;return a=void 0===t?{}:Freedo.clone(t,!0),a.destination=Freedo.Cartesian3.fromDegrees(n[0],n[1],n[2]),a.orientation={heading:Freedo.Math.toRadians(n[3]),pitch:Freedo.Math.toRadians(n[4]),roll:n[5]},void 0!==r&&void 0===a.endTransform&&(a.endTransform=r),this._camera.flyTo(a),i(s,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo),!0},o.prototype.gotoByCameraInfo=function(e){var t=this.getCurrentCameraInfo();if(_.isEqual(t,e))return!1;var o,r=e,n=this._camera;return Freedo.Matrix4.equals(n.transform,Freedo.Matrix4.IDENTITY)||(o=Freedo.Matrix4.clone(n.transform,o),n.lookAtTransform(Freedo.Matrix4.IDENTITY)),this._camera.setView({destination:Freedo.Cartesian3.fromDegrees(r[0],r[1],r[2]),orientation:{heading:Freedo.Math.toRadians(r[3]),pitch:Freedo.Math.toRadians(r[4]),roll:r[5]}}),void 0!==o&&n.lookAtTransform(o),i(n,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo),!0},o.prototype.cancelFlight=function(){this._camera.cancelFlight(),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)},o.prototype.isFlying=function(){return Freedo.defined(this._camera._currentFlight)},o.prototype.capture=function(e){this._captureManager.capture(e)},o.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},o.prototype.reset=function(){this._cameraPath=[],this.cameraPathCurrentIndex=-1,this._lastHistoryOpFrameCount=0},o.prototype.clearAllEventListeners=function(){this._eventHelper.removeAll()},o.prototype.dispose=function(){this.reset(),this._eventHelper.removeAll()},o.prototype.flyToBoundingSphere=function(e,t){this._camera.flyToBoundingSphere(e,t),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)},o.prototype.flyTo=function(e){this._camera.flyTo(e),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)},o.prototype.viewBoundingSphere=function(e,t){this._camera.viewBoundingSphere(e,t),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)},o.prototype.lookAtTransform=function(e,t){this._camera.lookAtTransform(e,t)},o.prototype.entityRound=function(e,t,o){var r,n=720/o*1e3,s=0,a=0,h=this._currentCameraInfo[3],l=this,c=!1,d=function(){var d=(new Date).getTime();if(0===a&&(a=d),(s=d-a)>=n)return c=!0,void p();r=h+s/1e3*o,l._camera.viewBoundingSphere(e,new Freedo.HeadingPitchRange(Freedo.Math.toRadians(r),Freedo.Math.toRadians(-30),t)),i(l._camera,l._currentCameraInfo),l._event.raiseEvent("Changed",l._currentCameraInfo)},p=l._scene.preRender.addEventListener(function(){c||d()})},o.prototype.lookAt=function(e,t){return this._camera.lookAt(e,t)},o.prototype.distanceToBoundingSphere=function(e){return this._camera.distanceToBoundingSphere(e)},o.prototype.flyToSouth=function(e){var t=this.getCurrentCameraInfo(),o=new Freedo.Cartographic.fromCartesian(e.center),r=o.height,n=this,s=function(){n.flyToBoundingSphere(e,{offset:new Freedo.HeadingPitchRange(0,0,3*e.radius),maximumHeight:r,duration:2})};this.distanceToBoundingSphere(e)>5*e.radius?this.flyToBoundingSphere(e,{duration:6,offset:new Freedo.HeadingPitchRange(FreeDo.Math.toRadians(t[3]),FreeDo.Math.toRadians(t[4]),5*e.radius),complete:s}):s(),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)},o.prototype.flyToWest=function(e){var t=this.getCurrentCameraInfo(),o=new Freedo.Cartographic.fromCartesian(e.center),r=o.height,n=this,s=function(){n.flyToBoundingSphere(e,{offset:new Freedo.HeadingPitchRange(FreeDo.Math.toRadians(90),0,3*e.radius),maximumHeight:r,duration:2})};this.distanceToBoundingSphere(e)>5*e.radius?this.flyToBoundingSphere(e,{duration:6,offset:new Freedo.HeadingPitchRange(FreeDo.Math.toRadians(t[3]),FreeDo.Math.toRadians(t[4]),5*e.radius),complete:s}):s(),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)},o.prototype.flyToNorth=function(e){var t=this.getCurrentCameraInfo(),o=new Freedo.Cartographic.fromCartesian(e.center),r=o.height,n=this,s=function(){n.flyToBoundingSphere(e,{offset:new Freedo.HeadingPitchRange(FreeDo.Math.toRadians(180),0,3*e.radius),maximumHeight:r,duration:2})};this.distanceToBoundingSphere(e)>5*e.radius?this.flyToBoundingSphere(e,{duration:6,offset:new Freedo.HeadingPitchRange(FreeDo.Math.toRadians(t[3]),FreeDo.Math.toRadians(t[4]),5*e.radius),complete:s}):s(),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)},o.prototype.flyToEast=function(e){var t=this.getCurrentCameraInfo(),o=new Freedo.Cartographic.fromCartesian(e.center),r=o.height,n=this,s=function(){n.flyToBoundingSphere(e,{offset:new Freedo.HeadingPitchRange(FreeDo.Math.toRadians(270),0,3*e.radius),maximumHeight:r,duration:2})};this.distanceToBoundingSphere(e)>5*e.radius?this.flyToBoundingSphere(e,{duration:6,offset:new Freedo.HeadingPitchRange(FreeDo.Math.toRadians(t[3]),FreeDo.Math.toRadians(t[4]),5*e.radius),complete:s}):s(),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)},o.prototype.flyToUp=function(e){var t=this.getCurrentCameraInfo(),o=new Freedo.Cartographic.fromCartesian(e.center),r=o.height,n=this,s=function(){t=n.getCurrentCameraInfo(),n.flyToBoundingSphere(e,{offset:new Freedo.HeadingPitchRange(FreeDo.Math.toRadians(t[3]),FreeDo.Math.toRadians(-90),3*e.radius),maximumHeight:r,duration:2})};this.distanceToBoundingSphere(e)>5*e.radius?this.flyToBoundingSphere(e,{duration:6,offset:new Freedo.HeadingPitchRange(FreeDo.Math.toRadians(t[3]),FreeDo.Math.toRadians(t[4]),5*e.radius),complete:s}):s(),i(this._camera,this._currentCameraInfo),this._event.raiseEvent("Changed",this._currentCameraInfo)},o.prototype.trackByBoundingSphere=function(e){this._viewer.scene.screenSpaceCameraController.bimTrackByBoundingSphere(e),this._event.raiseEvent("beginTrackEvent",e)},o.prototype.unTrack=function(){this._viewer.scene.screenSpaceCameraController.bimUnTrack(),this._event.raiseEvent("endTrackEvent")},o.prototype.isTracking=function(){return this._viewer.scene.screenSpaceCameraController.isTracking()},o}.apply(t,o))&&(e.exports=r)},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){l({async:!0,url:e,type:"GET",data:{},dataType:"json",success:function(e,i){if(""!==e){var o=JSON.parse(e);t(o)}},fail:function(e){t()}})}function n(e,t,i,o){var r=new Freedo.Cartesian3(e[0],e[1],e[2]),n=new Freedo.Cartesian3(t[0],t[1],t[2]),s=new Freedo.Cartesian3.fromDegrees(i[0],i[1],i[2]),a=FreeDo.Transforms.eastNorthUpToFixedFrame(s),h=n.y;return n.y=-n.z,n.z=h,h=r.y,r.y=-r.z,r.z=h,Freedo.Matrix4.multiplyByPoint(a,n,n),Freedo.Matrix4.multiplyByPoint(a,r,r),o&&(Freedo.Matrix4.multiplyByPoint(o,n,n),Freedo.Matrix4.multiplyByPoint(o,r,r)),FreeDo.BoundingSphere.fromCornerPoints(n,r)}function s(e){var t=e.split(",");return t.map(function(e){return+e})}Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"FdPMComponent",function(){return c});var a=i(21),h=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),l=a.a.fd_ajax,c=function(){function e(t,i){o(this,e),this._pModelSet=t,this._uid=i}return h(e,[{key:"reset",value:function(e,t){this._pModelSet=e,this._uid=t}},{key:"getUidQueryStr",value:function(){var e=this._pModelSet._json;return e.templateStr+"uid/"+e.LayerIdentifier+"/"+e.TileMatrixSetIdentifier+"/"+this._uid}},{key:"getCidQueryStr",value:function(){var e=this._pModelSet._json;return e.templateStr+"cid/"+e.LayerIdentifier+"/"+e.TileMatrixSetIdentifier+"/"+this._uid}},{key:"getPropQueryStr",value:function(){var e=this._pModelSet._json;return e.templateStr+"prop/"+e.LayerIdentifier+"/"+e.TileMatrixSetIdentifier+"/"+this._uid}},{key:"getUid",value:function(e){r(this.getUidQueryStr(),function(t){e(t)})}},{key:"getCid",value:function(e){r(this.getCidQueryStr(),function(t){e(t)})}},{key:"getProp",value:function(e){r(this.getPropQueryStr(),function(t){e(t)})}},{key:"getChildrenComponents",value:function(t){var i=this;this.getUid(function(o){if(1===o.length){for(var r=o[0].cids,n=[],s=0;s<r.length;++s)n.push(new e(i._pModelSet,r[s]));t(n,i)}})}},{key:"getChildrenIDs",value:function(e){var t=this;this.getUid(function(i){if(1===i.length){for(var o=i[0].cids,r=[],n=0;n<o.length;++n)r.push(o[n]);e(r,t._uid)}})}},{key:"getBoundingSphere",value:function(e){var t=this;this.getUid(function(i){if(i&&i[0]&&i[0].BoundsMin&&i[0].BoundsMax){var o=s(i[0].BoundsMin),r=s(i[0].BoundsMax),a=t._pModelSet.position,h=n(o,r,a,t._pModelSet.offsetModelMatrix);e(h)}})}},{key:"uid",get:function(){return this._uid}},{key:"pModelSet",get:function(){return this._pModelSet}}]),e}()},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"FdPModel",function(){return s});var r=i(4),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),s=function(){function e(t,i){o(this,e),this._pModelSet=t,this._json=i,this._rootComponent=new r.FdPMComponent(t,i.uid)}return n(e,[{key:"getPModelURI",value:function(){var e=this._pModelSet._json;return this._json.pModelUri?this._json.pModelUri:e.templateStr+"file/"+e.LayerIdentifier+"/"+e.TileMatrixSetIdentifier+"/"+this.Identifier}},{key:"getRootComponent",value:function(){return this._rootComponent}},{key:"position",get:function(){return this._json.position}},{key:"Identifier",get:function(){return this._json.Identifier}},{key:"uid",get:function(){return this._json.uid}},{key:"pModelSet",get:function(){return this._pModelSet}}]),e}()},function(e,t,i){var o,r;o=[i(0)],void 0!==(r=function(e){"use strict";function t(e,t,i,o){this.mPointA=e.position,this.mPointB=t.position,this.mControlPointA=i.position,this.mControlPointB=o.position}return t.prototype.coefficients=function(e,t,i,o,r){var n=1-e;return i=n*n,o=e*e,r=o*e,t=i*n,i*=3*e,o*=3*n,{a:t,b:i,c:o,d:r}},t.prototype.getPointAt=function(e,t,i,o){e<0&&(e=0),e>1&&(e=1);var r=this.coefficients(e,void 0,void 0,void 0,void 0);return t=r.a*this.mPointA.x+r.b*this.mControlPointA.x+r.c*this.mControlPointB.x+r.d*this.mPointB.x,i=r.a*this.mPointA.y+r.b*this.mControlPointA.y+r.c*this.mControlPointB.y+r.d*this.mPointB.y,o=r.a*this.mPointA.z+r.b*this.mControlPointA.z+r.c*this.mControlPointB.z+r.d*this.mPointB.z,{x:t,y:i,z:o}},t.prototype.getVertexForCurve=function(e){var t=0,i=0;switch(e){case 1:t=1,i=2;break;case 2:t=.5,i=3;break;case 3:t=.2,i=6;break;case 4:t=.1,i=11;break;case 5:t=.05,i=21;break;case 6:t=.02,i=51;break;case 7:t=.01,i=101;break;case 8:t=.005,i=201;break;case 9:t=.0025,i=401;break;case 10:t=.00125,i=801;break;case 11:t=625e-6,i=1601;break;default:t=.005,i=201}for(var o=[],r=0,n=0;n<i;++n){var s={},a=this.getPointAt(r,0,0,0);s.x=a.x,s.y=a.y,s.z=a.z,o.push(s),r+=t}return o},t}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o,r;o=[i(0)],void 0!==(r=function(e){"use strict";function t(e){this.SurveyType={NONE:0,LINE_DISTANCE:1,SEGMENTS_DISTANCE:2},this.PositionType={NONE:0,ON_MODEL:1,ON_TERRAIN:2,ON_ELLIPSOID:3},this.ResultType={StraightLine:1,HorizontalAndVertical:2},this._project=e,this._viewer=this._project.getViewer(),this._results=[],this._startPoint=void 0,this._tempPoint=void 0,this._polylineCollection=new Freedo.PolylineCollection,this._viewer.scene.primitives.add(this._polylineCollection),this._collection=new Freedo.PrimitiveCollection,this._viewer.scene.primitives.add(this._collection),this._tempLine,this._tempPointEntities=[null,null],this._tempSumLabelEntity=void 0,this._sumLabel=[],this._lastLabel=void 0,this._points=[],this._hanlder={},this._ballSize=.5,this._lineWidth=3,this._fontSize="22px 黑体",this._bInSurvey=!1,this._surveyType="",this._useDepthPicking=!0,this._pickTranslucentDepth=!0,this._bRmStarting=!1}return t.prototype.pickPosition=function(t){var i=e.pickPosition(this._viewer,t);return i?{type:this.PositionType.ON_TERRAIN,position:i}:{type:this.PositionType.NONE,position:i}},t.prototype.removeTmpLine=function(){this._tempLine&&(this._viewer.entities.remove(this._tempLine),this._tempLine=void 0),this._tempSumLabelEntity&&(this._viewer.entities.remove(this._tempSumLabelEntity),this._tempSumLabelEntity=void 0);for(var e=0;e<this._tempPointEntities.length;e++)this._tempPointEntities[e]&&(this._viewer.entities.remove(this._tempPointEntities[e]),this._tempPointEntities[e]=null);"LINE_DISTANCE"==this._surveyType&&(this._startPoint=void 0),this._bRmStarting=!1},t.prototype.calcLineType=function(t,i){var o=Freedo.Cartographic.fromCartesian(t.position),r=Freedo.Cartographic.fromCartesian(i.position),n=e.calculateLength([t.position,i.position]);return Math.abs(o.height-r.height)>n/10?this.ResultType.HorizontalAndVertical:this.ResultType.StraightLine},t.prototype.createLinePrimitive=function(e,t){return new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:new Freedo.PolylineGeometry({positions:[e,t],width:2,vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT})}),appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:new Freedo.Color(1,.3,.3,1)}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:!0,factor:-100,units:-100},depthTest:{enabled:!0,func:Freedo.WebGLConstants.LEQUAL}})}),depthFailAppearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"PolylineDash",uniforms:{color:new Freedo.Color(1,.3,.3,.5)}}})})})},t.prototype.createLabel=function(e,t){return this._viewer.entities.add({position:e,label:{style:Freedo.LabelStyle.FILL_AND_OUTLINE,text:t,show:!0,showBackground:!0,backgroundColor:new Freedo.Color(.165,.165,.165,1),font:this._fontSize,horizontalOrigin:Freedo.HorizontalOrigin.CENTER,verticalOrigin:Freedo.VerticalOrigin.BOTTOM,pixelOffset:new Freedo.Cartesian2(1,1),disableDepthTestDistance:Number.POSITIVE_INFINITY}})},t.prototype.addResult=function(t){var i=this.calcLineType(this._startPoint,t);if(this._points.pop(),this._points.push(t.position),this._points.push(t.position),this._ballSize=e.calculateLength(this._points)/1e3,i===this.ResultType.StraightLine){var o=[this._startPoint.position,t.position],r=e.calculateLength(o);if(r<.01)return void this._points.pop();var n=this._viewer.scene.primitives.add(this.createLinePrimitive(this._startPoint.position,t.position)),s=e.getCenter(this._startPoint.position,t.position),a=e.getLengthText(e.calculateLength(o)),h=this.createLabel(s,a),l=this._viewer.entities.add({position:this._startPoint.position,show:!0,point:{color:Freedo.Color.YELLOW,pixelSize:5,show:!1,point:!1}}),c=this._viewer.entities.add({position:t.position,show:!0,point:{color:Freedo.Color.YELLOW,pixelSize:5,show:!1,point:!1}});this._results.push({type:i,labelEntity:h,line:n,startPointEntity:l,endPointEntity:c})}else if(i===this.ResultType.HorizontalAndVertical){var d=Freedo.Cartographic.fromCartesian(this._startPoint.position),p=Freedo.Cartographic.fromCartesian(t.position),o=[this._startPoint.position,t.position],r=e.calculateLength(o);if(r<.01)return void this._points.pop();var _,u,v,f;d.height>p.height?(u=this._startPoint.position,_=t.position,v=d.height-p.height):(u=t.position,_=this._startPoint.position,v=p.height-d.height);var g=new Freedo.Cartesian3;Freedo.Cartesian3.normalize(_,g),Freedo.Cartesian3.multiplyByScalar(g,v,g);var y=new Freedo.Cartesian3;Freedo.Cartesian3.add(_,g,y),f=Freedo.Cartesian3.distance(y,u);var n=this._viewer.scene.primitives.add(this.createLinePrimitive(u,_)),m=this._viewer.scene.primitives.add(this.createLinePrimitive(_,y)),C=this._viewer.scene.primitives.add(this.createLinePrimitive(u,y)),F=e.getCenter(u,_),w=e.getLengthText(e.calculateLength([u,_])),b=this.createLabel(F,w);F=e.getCenter(y,_),w=e.getLengthText(v);var P=this.createLabel(F,w);F=e.getCenter(y,u),w=e.getLengthText(f);var T=this.createLabel(F,w),l=this._viewer.entities.add({position:this._startPoint.position,point:{color:Freedo.Color.YELLOW,pixelSize:5,show:!1,point:!1}}),c=this._viewer.entities.add({position:t.position,point:{color:Freedo.Color.YELLOW,show:!1,pixelSize:5,point:!1}});this._results.push({type:i,line:n,verticalLine:m,horizontalLine:C,lineLabelEntity:b,verticalLineLabelEntity:P,horizontalLineLabelEntity:T,startPointEntity:l,endPointEntity:c})}if(this._points.length>3&&"SEGMENTS_DISTANCE"==this._surveyType)if(void 0==this._lastLabel){var M=e.getLengthText(e.calculateLength(this._points));this._lastLabel=this.createLabel(t.position,M)}else this._lastLabel.position=t.position,this._lastLabel.label.text=e.getLengthText(e.calculateLength(this._points));"SEGMENTS_DISTANCE"==this._surveyType&&(this._startPoint=Freedo.clone(t,!0)),t=void 0},t.prototype.clearResults=function(){this.removeTmpLine(),this._lastLabel&&(this._viewer.entities.remove(this._lastLabel),this._lastLabel=void 0);for(var e=0;e<this._results.length;++e)this._results[e].type===this.ResultType.StraightLine?(this._viewer.scene.primitives.remove(this._results[e].line),this._viewer.entities.remove(this._results[e].labelEntity),this._viewer.entities.remove(this._results[e].startPointEntity),this._viewer.entities.remove(this._results[e].endPointEntity)):this._results[e].type===this.ResultType.HorizontalAndVertical&&(this._viewer.scene.primitives.remove(this._results[e].line),this._viewer.scene.primitives.remove(this._results[e].verticalLine),this._viewer.scene.primitives.remove(this._results[e].horizontalLine),this._viewer.entities.remove(this._results[e].lineLabelEntity),this._viewer.entities.remove(this._results[e].verticalLineLabelEntity),this._viewer.entities.remove(this._results[e].horizontalLineLabelEntity),this._viewer.entities.remove(this._results[e].startPointEntity),this._viewer.entities.remove(this._results[e].endPointEntity));for(var t in this._sumLabel)this._viewer.entities.remove(this._sumLabel[t]);this._viewer.scene.primitives.remove(this._polylineCollection),this._results=[],this._sumLabel=[]},t.prototype.pickStartPoint=function(e){this._points=[];var t=this.pickPosition(e);t.type!==this.PositionType.NONE&&(this._startPoint=t,this._points.push(t.position),this._points.push(t.position),this._tempPointEntities[0]=this._viewer.entities.add({position:this._startPoint.position,show:!1,point:{color:Freedo.Color.YELLOW,pixelSize:5,show:!1,point:!1}}))},t.prototype.pickEndPoint=function(e){var t=this.pickPosition(e);t.type!==this.PositionType.NONE&&(this.addResult(t),this._bRmStarting=!0,setTimeout(this.removeTmpLine.bind(this),100))},t.prototype.handleLeftClick=function(e){0!=this._bInSurvey&&(this._startPoint?this.pickEndPoint(e.position):this.pickStartPoint(e.position))},t.prototype.addSumLabel=function(){if(this._points.pop(),this._viewer.entities.remove(this._lastLabel),this._lastLabel=void 0,this._points.length>2&&"SEGMENTS_DISTANCE"==this._surveyType){var t=this._points[this._points.length-1],i=e.getLengthText(e.calculateLength(this._points)),o=this.createLabel(t,i);this._sumLabel.push(o)}},t.prototype.handleRightClick=function(e){0!=this._bInSurvey&&(this._startPoint&&(this._startPoint=void 0,this.addSumLabel()),this.removeTmpLine())},t.prototype.callbackPosition=function(){return[this._startPoint.position,this._tempPoint.position]},t.prototype.handleMouseMove=function(e){if(0!=this._bInSurvey&&!this._bRmStarting&&this._startPoint&&!Freedo.Cartesian3.equals(e.endPosition,e.startPosition)){var t=this.pickPosition(e.endPosition);if(!Freedo.defined(t.position))return;if(this._tempPoint=t,void 0===this._tempLine){var i=new Freedo.CallbackProperty(this.callbackPosition.bind(this),!1);this._tempLine=this._viewer.entities.add({name:"MeasureLine",polyline:{positions:i,width:this._lineWidth,material:Freedo.Color.RED,depthFailMaterial:Freedo.Color.GREEN}})}}},t.prototype.onKeyDown=function(){0!=this._bInSurvey&&27==window.event.keyCode&&this.handleRightClick()},t.prototype.run=function(e){this._surveyType=e,this._hanlder=new Freedo.ScreenSpaceEventHandler(this._project.getViewer().scene.canvas),this._hanlder.setInputAction(this.handleLeftClick.bind(this),Freedo.ScreenSpaceEventType.LEFT_CLICK),this._hanlder.setInputAction(this.handleRightClick.bind(this),Freedo.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this._hanlder.setInputAction(this.handleRightClick.bind(this),Freedo.ScreenSpaceEventType.RIGHT_CLICK),this._hanlder.setInputAction(this.handleMouseMove.bind(this),Freedo.ScreenSpaceEventType.MOUSE_MOVE),window.addEventListener("keydown",this.onKeyDown.bind(this)),this._bInSurvey=!0},t.prototype.reset=function(){this._bInSurvey=!1,this._hanlder.removeInputAction(Freedo.ScreenSpaceEventType.LEFT_CLICK),this._hanlder.removeInputAction(Freedo.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this._hanlder.removeInputAction(Freedo.ScreenSpaceEventType.RIGHT_CLICK),this._hanlder.removeInputAction(Freedo.ScreenSpaceEventType.MOUSE_MOVE),window.removeEventListener("keydown",this.onKeyDown.bind(this)),this.clearResults()},t}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o,r;o=[i(0),i(7),i(26)],void 0!==(r=function(e,t,i){"use strict";function o(t){this._project=t,this._viewer=this._project.getViewer(),this._fdMidc=new e,this._survey=void 0,this._depthTestAgainstTerrain=!0,this._mode="",this._event=new FreeDo.Event,this._eventHelper=new FreeDo.EventHelper,this._lsnr=void 0}return o.prototype.setMode=function(e){if("CANCEL"==e)return void this.reset();if("LINE_DISTANCE"===e||"SEGMENTS_DISTANCE"===e||"SINGLE_POINT"===e){if(this.reset(),this._mode=e,"LINE_DISTANCE"===e&&(this._survey=new t(this._project)),"SEGMENTS_DISTANCE"===e&&(this._survey=new t(this._project)),"SINGLE_POINT"===e){this._survey=new i(this._project);var o=this;this._lsnr=this._survey.on(function(e,t){"Point"==e&&o._event.raiseEvent("Point",t)})}this._survey.run(this._mode),this._event.raiseEvent("Start",{mode:this._mode})}},o.prototype.getMode=function(){return this._mode},o.prototype.cancel=function(){this.reset(),this._event.raiseEvent("Cancel",{mode:this._mode})},o.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},o.prototype.reset=function(){this._survey&&this._survey.reset(),this._lsnr&&this._lsnr()},o.prototype.dispose=function(){this.reset()},o}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o,r;o=[i(6),i(0)],void 0!==(r=function(e,t){function i(e){this._project=e,this._viewer=e.getViewer(),this._scene=this._viewer.scene,this._polylines={},this._egs=[],this._lsner=void 0,this._ple=e.getPolylineEditor(),this._handler=void 0,this.oldV=void 0,this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper,this._level=void 0,this._smoothRate=5}i.prototype.start=function(e){this._ple.run(),this._level=e,this._lsner&&(this._lsner(),this._lsner=void 0);var t=this;this._lsner=this._ple.on(function(e,i){"PLAdd"==e&&t.onPLAdd(i)}),this._event.raiseEvent("Start",{})},i.prototype.onPLAdd=function(e){for(var t=this.getRoadUrlByLevel(this._level),i=[],o=e.polyline.pts,r=Freedo.Math.toDegrees,n=0;n<o.length;n++){var s=Freedo.Cartographic.fromCartesian(o[n]);i.push({lon:r(s.longitude),lat:r(s.latitude),height:s.height+3})}this.drawRoad(i,5,t)},i.prototype.TransfPointToCartesian3=function(e){for(var t=[],i=0;i<e.length;i++)t[i]=FreeDo.Cartesian3.fromDegrees(e[i].lon,e[i].lat,e[i].height);return t};var o=new FreeDo.Cartesian3;return i.prototype.TransfCartesian3ToSelf=function(e){for(var t=[],i=0;i<e.length;i++)t[i]=new Freedo.Cartesian3(e[i].x-o.x,e[i].y-o.y,e[i].z-o.z);return t},i.prototype.getPointArray=function(e,t,i){var o=new FreeDo.Cartesian3,r=new FreeDo.Cartesian3,n=new FreeDo.Cartesian3,s=new FreeDo.Cartesian3,a=new FreeDo.Cartesian3,h=new FreeDo.Cartesian3,l=new FreeDo.Cartesian3,c=(new FreeDo.Cartesian3,new FreeDo.Cartesian3),d=new FreeDo.Cartesian3,p=null,_=null,u=[];switch(t.length){case 0:case 1:break;case 2:FreeDo.Cartesian3.subtract(t[1],t[0],o),FreeDo.Cartesian3.cross(e[0],o,n),FreeDo.Cartesian3.cross(o,e[0],s),FreeDo.Cartesian3.normalize(n,a),FreeDo.Cartesian3.normalize(s,h),a.x=a.x*i,a.y=a.y*i,a.z=a.z*i,h.x=h.x*i,h.y=h.y*i,h.z=h.z*i,FreeDo.Cartesian3.add(t[0],a,c),FreeDo.Cartesian3.add(t[0],h,d),u.push(new FreeDo.Cartesian3(c.x,c.y,c.z)),u.push(new FreeDo.Cartesian3(d.x,d.y,d.z)),FreeDo.Cartesian3.add(t[1],a,c),FreeDo.Cartesian3.add(t[1],h,d),u.push(new FreeDo.Cartesian3(c.x,c.y,c.z)),u.push(new FreeDo.Cartesian3(d.x,d.y,d.z));break;default:for(var v=1;v<t.length-1;v++)FreeDo.Cartesian3.subtract(t[v],t[v-1],o),FreeDo.Cartesian3.subtract(t[v+1],t[v],r),0==FreeDo.Cartesian3.angleBetween(o,r)&&t.splice(v--,1);for(var f=0;f<t.length;f++)0==f?(FreeDo.Cartesian3.subtract(t[f+1],t[f],o),FreeDo.Cartesian3.cross(e[f],o,n),FreeDo.Cartesian3.cross(o,e[f],s),FreeDo.Cartesian3.normalize(n,a),FreeDo.Cartesian3.normalize(s,h),a.x=a.x*i,a.y=a.y*i,a.z=a.z*i,h.x=h.x*i,h.y=h.y*i,h.z=h.z*i,FreeDo.Cartesian3.add(t[f],a,c),FreeDo.Cartesian3.add(t[f],h,d),u.push(new FreeDo.Cartesian3(c.x,c.y,c.z)),u.push(new FreeDo.Cartesian3(d.x,d.y,d.z))):f==t.length-1?(FreeDo.Cartesian3.subtract(t[f],t[f-1],o),FreeDo.Cartesian3.cross(e[f],o,n),FreeDo.Cartesian3.cross(o,e[f],s),FreeDo.Cartesian3.normalize(n,a),FreeDo.Cartesian3.normalize(s,h),a.x=a.x*i,a.y=a.y*i,a.z=a.z*i,h.x=h.x*i,h.y=h.y*i,h.z=h.z*i,FreeDo.Cartesian3.add(t[f],a,c),FreeDo.Cartesian3.add(t[f],h,d),u.push(new FreeDo.Cartesian3(c.x,c.y,c.z)),u.push(new FreeDo.Cartesian3(d.x,d.y,d.z))):(FreeDo.Cartesian3.subtract(t[f-1],t[f],o),FreeDo.Cartesian3.subtract(t[f+1],t[f],r),_=FreeDo.Cartesian3.angleBetween(o,r)/2,p=i/Math.sin(_),FreeDo.Cartesian3.subtract(t[f+1],t[f],o),FreeDo.Cartesian3.subtract(t[f],t[f-1],r),FreeDo.Cartesian3.normalize(o,o),FreeDo.Cartesian3.normalize(r,r),FreeDo.Cartesian3.add(o,r,l),FreeDo.Cartesian3.cross(e[f],l,n),FreeDo.Cartesian3.normalize(n,a),a.x=a.x*p,a.y=a.y*p,a.z=a.z*p,FreeDo.Cartesian3.add(t[f],a,c),FreeDo.Cartesian3.cross(l,e[f],s),FreeDo.Cartesian3.normalize(s,h),h.x=h.x*p,h.y=h.y*p,h.z=h.z*p,FreeDo.Cartesian3.add(t[f],h,d),u.push(new FreeDo.Cartesian3(c.x,c.y,c.z)),u.push(new FreeDo.Cartesian3(d.x,d.y,d.z)))}return u},i.prototype.getRoadUrlByLevel=function(e){return"一级"==e?t.getFreedoXPath()+"static/img/road/road1.jpg":"二级"==e?t.getFreedoXPath()+"static/img/road/road2.jpg":"三级"==e?t.getFreedoXPath()+"static/img/road/road3.jpg":null},i.prototype.calcCP=function(e,t,i){var o,r,n;o=e.position,r=t.position,n=i.position;var s=FreeDo.Cartesian3.subtract(o,r,new FreeDo.Cartesian3),a=FreeDo.Cartesian3.subtract(n,r,new FreeDo.Cartesian3),h=FreeDo.Cartesian3.cross(s,a,new FreeDo.Cartesian3),l=FreeDo.Cartesian3.normalize(s,new FreeDo.Cartesian3),c=FreeDo.Cartesian3.normalize(a,new FreeDo.Cartesian3),d=FreeDo.Cartesian3.add(l,c,new FreeDo.Cartesian3),p=Freedo.Quaternion.fromAxisAngle(h,Freedo.Math.PI_OVER_TWO,new Freedo.Quaternion),_=Freedo.Quaternion.fromAxisAngle(h,-1*Freedo.Math.PI_OVER_TWO,new Freedo.Quaternion),u=Freedo.Matrix3.fromQuaternion(p,new Freedo.Matrix3),v=Freedo.Matrix3.fromQuaternion(_,new Freedo.Matrix3),f=Freedo.Matrix3.multiplyByVector(u,d,new Freedo.Cartesian3),g=Freedo.Matrix3.multiplyByVector(v,d,new Freedo.Cartesian3),y=FreeDo.Cartesian3.normalize(f,new FreeDo.Cartesian3),m=FreeDo.Cartesian3.normalize(g,new FreeDo.Cartesian3),C=FreeDo.Cartesian3.distance(o,r),F=FreeDo.Cartesian3.distance(n,r),w=1;w=C<F?C/4:F/4,y=FreeDo.Cartesian3.multiplyByScalar(y,w,new FreeDo.Cartesian3),m=FreeDo.Cartesian3.multiplyByScalar(m,w,new FreeDo.Cartesian3);var b=FreeDo.Cartesian3.add(r,y,new FreeDo.Cartesian3),P=FreeDo.Cartesian3.add(r,m,new FreeDo.Cartesian3);return FreeDo.Cartesian3.distance(o,b)<FreeDo.Cartesian3.distance(o,P)?[b,P]:[P,b]},i.prototype.smoothPolyline=function(t){var i=[];if(t.length<3)for(var o=0;o<t.length;o++)i.push(t[o].position);else for(var o=0;o<=t.length-2;o++){var r={},n={},s={},a={};0==o?(r=t[0],n.position=this.calcCP(t[0],t[1],t[2])[0],s=t[0],a=t[1]):o==t.length-2?(r.position=this.calcCP(t[o-1],t[o],t[o+1])[1],n=t[o+1],s=t[o],a=t[o+1]):(r.position=this.calcCP(t[o-1],t[o],t[o+1])[1],n.position=this.calcCP(t[o],t[o+1],t[o+2])[0],s=t[o],a=t[o+1]);var h=new e(s,a,r,n),l=h.getVertexForCurve(this._smoothRate);i=i.concat(l)}for(var c=[],o=0;o<i.length;o++){var d={};if(d=i[o],c.length>0){FreeDo.Cartesian3.distance(c[c.length-1],d)>1e-4&&c.push(d)}else c.push(d)}return c},i.prototype.drawRoad=function(e,t,i){for(var r=this.TransfPointToCartesian3(e),n=[],s=0;s<r.length;s++)n[s]={position:r[s]};r=this.smoothPolyline(n),o.x=r[0].x,o.y=r[0].y,o.z=r[0].z;for(var a=this.TransfCartesian3ToSelf(r),h=this.getPointArray(r,a,t),l=h,c=[],d=0;d<e.length;d++)c[d]={lon:e[d].lon,lat:e[d].lat,height:e[d].height-3};var p=t+4,_=this.TransfPointToCartesian3(c);n=[];for(var u=0;u<_.length;u++)n[u]={position:_[u]};_=this.smoothPolyline(n);for(var v=this.TransfCartesian3ToSelf(_),f=this.getPointArray(_,v,p),g=f,y=[],m=0;m<g.length;m++)m%2==0?(y.push(g[m].x),y.push(g[m].y),y.push(g[m].z),y.push(l[m].x),y.push(l[m].y),y.push(l[m].z)):(y.push(l[m].x),y.push(l[m].y),y.push(l[m].z),y.push(g[m].x),y.push(g[m].y),y.push(g[m].z));var C=new Float64Array(y),F=[],w=null,b=null,P=null,T=0;F.push(T,0),F.push(T,.1),F.push(T,.9),F.push(T,.99);for(var M=h.length/2-1,S=2*t+2*Math.sqrt(25),D=0;D<M;D++)w=FreeDo.Cartesian3.distance(l[2*D+2],l[2*D])/S,b=FreeDo.Cartesian3.distance(l[2*D+3],l[2*D+1])/S,P=(w+b)/2,T+=P,F.push(T,0),F.push(T,.1),F.push(T,.9),F.push(T,.99);for(var x=new Float32Array(F),E=[],I=4*(h.length/2-2)+2,A=0;A<=I;A++)(A-3)%4!=0&&(E.push(A+0),E.push(A+4),E.push(A+5),E.push(A+5),E.push(A+1),E.push(A+0));for(var L=new Uint16Array(E),O=[],k=0;k<r.length;k++)O.push(r[k].x),O.push(r[k].y),O.push(r[k].z);var R=FreeDo.BoundingSphere.fromVertices(O),X=new FreeDo.Geometry({attributes:{position:new FreeDo.GeometryAttribute({componentDatatype:FreeDo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:C}),st:new FreeDo.GeometryAttribute({componentDatatype:FreeDo.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:x})},indices:L,primitiveType:FreeDo.PrimitiveType.TRIANGLES,boundingSphere:FreeDo.BoundingSphere.fromVertices(C)}),Y=new FreeDo.GeometryInstance({geometry:X,modelMatrix:new FreeDo.Matrix4(1,0,0,o.x,0,1,0,o.y,0,0,1,o.z,0,0,0,1),attributes:{color:FreeDo.ColorGeometryInstanceAttribute.fromColor(FreeDo.Color.RED)},id:"trangle"});return{primitive:this._viewer.scene.primitives.add(new FreeDo.Primitive({geometryInstances:Y,appearance:new FreeDo.MaterialAppearance({material:new FreeDo.Material({fabric:{type:"Image",uniforms:{image:i}}})})})),boundingsphere:R}},i.prototype.cancel=function(){this._ple.cancel(),this._polylines={};for(var e in this._egs)this._scene.groundPrimitives.remove(this._egs[e]);this._event.raiseEvent("Cancel",{})},i.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},i.prototype.setSmoothRate=function(e){this._smoothRate=e},i.prototype.reset=function(){this._lsner&&this._lsner(),this._lsner=void 0},i.prototype.dispose=function(){},i}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o;void 0!==(o=function(){"use strict";function e(e){this._viewpoints=null,this._fdCamera=e,this._currentIndex=-1,this._status="Stopped",this._flyingToIndex=-1,this._loop=!1,this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper,this._timeoutID=void 0}return Object.defineProperties(e.prototype,{currentIndex:{get:function(){return this._currentIndex},set:function(e){this._goto(e),this._setCurrentIndex(e)}},status:{get:function(){return this._status}},loop:{get:function(){return this._loop},set:function(e){this._loop=e,this._event.raiseEvent("PropertyChanged")}}}),e.prototype.startOrResume=function(){switch(this._status){case"Playing":break;case"Stopped":case"Paused":this._play();break;default:throw new Error("ViewpointsManager FdFlytoController error")}},e.prototype.pause=function(){switch(this._status){case"Playing":this._pause();break;case"Stopped":case"Paused":break;default:throw new Error("ViewpointsManager FdFlytoController error")}},e.prototype.stop=function(){switch(this._status){case"Playing":this._stop();break;case"Stopped":break;case"Paused":this._stop();break;default:throw new Error("ViewpointsManager FdFlytoController error")}},e.prototype.reset=function(){this._stop(),this._viewpoints=null},e.prototype.dispose=function(){this._viewpoints=null},e.prototype._setViewpoints=function(e){this._stop(),this._viewpoints=e},e.prototype._getViewpoints=function(){return this._viewpoints},e.prototype._play=function(){if(null===this._viewpoints)throw new Error("FdFlytoController play error!");this._flytoNext(),this._setStatus("Playing")},e.prototype._pause=function(){this._cancel(),this._setStatus("Paused")},e.prototype._stop=function(){this._cancel(),this._setCurrentIndex(-1),this._setStatus("Stopped")},e.prototype._completeCallback=function(){this._setCurrentIndex(this._flyingToIndex),this._currentIndex>=this._viewpoints.length&&this._setCurrentIndex(-1),this._flyingToIndex=-1;var e=this;this._timeoutID=setTimeout(function(){e._flytoNext()},1e3)},e.prototype._flytoNext=function(){this._cancel();var e;if(this._currentIndex>=this._viewpoints.length-1?this._loop&&1!=this._viewpoints.length?this._flyingToIndex=0:this._stop():this._flyingToIndex=this._currentIndex+1,-1!=this._flyingToIndex&&void 0!==(e=this._viewpoints[this._flyingToIndex].cameraInfo)){var t=this;this._fdCamera.flytoByCameraInfo(e,{complete:function(){t._completeCallback()}})}},e.prototype._cancel=function(){clearTimeout(this._timeoutID),this._timeoutID=void 0,this._fdCamera.cancelFlight(),this._flyingToIndex=-1},e.prototype._goto=function(e){if(e>=this._viewpoints.length)throw new Error("FdFlytoController inde error");this._cancel();var t=this._viewpoints.list[e],i=t.cameraInfo;if(void 0===i)throw new Error("FdFlytoController cameraInfo error");this._fdCamera.gotoByCameraInfo(i)},e.prototype._setStatus=function(e){this._status=e,this._event.raiseEvent("StatusChanged",e)},e.prototype._setCurrentIndex=function(e){this._currentIndex=e,this._event.raiseEvent("CurrentIndexChanged",e)},e.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},e.prototype.reset=function(){this._setViewpoints(null),this._stop()},e.prototype.dispose=function(){this.reset(),this._eventHelper.removeAll()},e}.call(t,i,t,e))&&(e.exports=o)},function(e,t,i){var o,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void 0!==(o=function(){"use strict";function e(t){t._options.imageryLayers=[],this._imageryLayersOpts=t._options.imageryLayers,this._project=t,this._imageryLayers=this._project.getViewer().imageryLayers,this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper,this._imageryLayers.layerAdded.addEventListener(e.prototype._rawEventCallback,this),this._imageryLayers.layerMoved.addEventListener(e.prototype._rawEventCallback,this),this._imageryLayers.layerRemoved.addEventListener(e.prototype._rawEventCallback,this),this._imageryLayers.layerShownOrHidden.addEventListener(e.prototype._rawEventCallback,this)}return Object.defineProperties(e.prototype,{length:{get:function(){return this._imageryLayersOpts.length}}}),e.prototype._rawEventCallback=function(){this._event.raiseEvent("Changed")},e.prototype.addDefaultImageryLayer=function(){var e={name:"谷歌影像",type:"UrlTemplate",iconUrl:"//res.gbim360.com/lib/freedo/rel/1.5.8/Freedo/Widgets/Images/ImageryProviders/blackMarble.png",layerOption:{show:!0,alpha:1},providerOptions:{url:"//mt0.google.cn/vt/lyrs=s&hl=zh-CN&x={x}&y={y}&z={z}",maximumLevel:20,tilingScheme:"WebMercator"}},t=this._imageryLayers.length;this.add(e,t)},e.prototype.getLayerProperty=function(e,t){var i=this._imageryLayersOpts[e];if(void 0===i)throw new Error("FdImageryLayersManager.getLayerProperty: cannot get property!");if(i.layerOption&&void 0!==i.layerOption[t])return Freedo.clone(i.layerOption[t],!0);var o=this._imageryLayers.get(e);if(r("undefined"!==o[t]))return o[t];throw new Error("FdImageryLayersManager.getLayerProperty: cannot get property!")},e.prototype.setLayerProperty=function(e,t,i){var o=this._imageryLayersOpts[e];if(void 0===o)throw new Error("FdImageryLayersManager.setLayerProperty: cannot get property!");var n=this.getLayerProperty(e,t);if(!_.isEqual(n,i)){var s=this._imageryLayers.get(e);if(!r("undefined"!==s[t]))throw new Error("FdImageryLayersManager.setLayerProperty: cannot get property!");s[t]=i,void 0===o.layerOption&&(o.layerOption={}),o.layerOption[t]=i,this._event.raiseEvent("Changed")}},e.prototype.add=function(e,t){void 0===t?(t=this._imageryLayersOpts.length,this._imageryLayersOpts.push(e)):this._imageryLayersOpts.splice(t,0,e);var i,o=Freedo.clone(e.providerOptions,!0);switch(e.type){case"BingMaps":"AERIAL"===o.mapStyle?o.mapStyle=Freedo.BingMapsStyle.AERIAL:"AERIAL_WITH_LABELS"===o.mapStyle?o.mapStyle=Freedo.BingMapsStyle.AERIAL_WITH_LABELS:"ROAD"===o.mapStyle&&(o.mapStyle=Freedo.BingMapsStyle.ROAD),i=new Freedo.BingMapsImageryProvider(o);break;case"Mapbox":i=new Freedo.MapboxImageryProvider(o);break;case"ESRI":i=new Freedo.ArcGisMapServerImageryProvider(o);break;case"OpenStreetMap":i=Freedo.createOpenStreetMapImageryProvider(o);break;case"WMTS":if("Geographic"===o.tilingScheme&&(o.tilingScheme=new Freedo.GeographicTilingScheme),o.tileDiscardPolicy){var n=o.tileDiscardPolicy;if(n.pixelsToCheck){for(var s=o.tileDiscardPolicy.pixelsToCheck,a=[],h=0;h<s.length;++h)a.push(new Freedo.Cartesian2(s[h][0],s[h][1]));n.pixelsToCheck=a}o.tileDiscardPolicy=new Freedo.DiscardMissingTileImagePolicy(n)}i=new Freedo.WebMapTileServiceImageryProvider(o);break;case"TileMapService":i=Freedo.createTileMapServiceImageryProvider(o);break;case"UrlTemplate":"WebMercator"===o.tilingScheme?o.tilingScheme=new Freedo.WebMercatorTilingScheme:"Geographic"===o.tilingScheme&&(o.tilingScheme=new Freedo.GeographicTilingScheme),"Geographic"===o.tilingScheme&&(o.tilingScheme=new Freedo.GeographicTilingScheme),i=new Freedo.UrlTemplateImageryProvider(o)}this._imageryLayers.addImageryProvider(i,t);var l=this._imageryLayers.get(t);for(var c in e.layerOption){if(this.setLayerProperty(t,c,e.layerOption[c]),!r("undefined"!==l[c]))throw new Error("FdImageryLayersManager.setLayerProperty: cannot get property!");l[c]=e.layerOption[c]}},e.prototype.raise=function(e){if(e>=0&&e<this.length-1){var t=this._imageryLayersOpts[e];this._imageryLayersOpts[e]=this._imageryLayersOpts[e+1],this._imageryLayersOpts[e+1]=t;var i=this._imageryLayers.get(e);this._imageryLayers.raise(i)}},e.prototype.lower=function(e){if(e>0&&e<this.length){var t=this._imageryLayersOpts[e];this._imageryLayersOpts[e]=this._imageryLayersOpts[e-1],this._imageryLayersOpts[e-1]=t;var i=this._imageryLayers.get(e);this._imageryLayers.lower(i)}},e.prototype.remove=function(e){if(e>=0&&e<this.length){this._imageryLayersOpts.splice(e,1);var t=this._imageryLayers.get(e);this._imageryLayers.remove(t)}},e.prototype.removeAll=function(){this._imageryLayersOpts.splice(0,this.length),this._imageryLayers.removeAll()},e.prototype.getAllLayers=function(){return Freedo.clone(this._imageryLayersOpts,!0)},e.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},e.prototype.reset=function(){this.removeAll()},e.prototype.dispose=function(){this.reset(),this._eventHelper.removeAll()},e}.call(t,i,t,e))&&(e.exports=o)},function(e,t,i){var o;void 0!==(o=function(){"use strict";function e(t){t._options.labelPoints={},this._pointCollection=t.getViewer().scene.primitives.add(new Freedo.PointPrimitiveCollection),this._labelPointOpts=t._options.labelPoints,this._labelPoints={},this._initLabelDivFunc=e.defaultInitLabelDivFunc,this._hideLabelDivFunc=e.defaultHideLabelDivFunc,this._showLabelDivFunc=e.defaultShowLabelDivFunc,this._project=t,this._viewer=t.getViewer(),this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper,this._freeDivs=[],this._freeLabelStatusCollection=[],this._changedLabelPointIDs=[],this._changedLabelPointStatusCollection=[];var i=this;this._updateLabelDivsByChangedInfoThrottle=_.throttle(function(){i._updateLabelsDivsByChangedInfo()},100),this._updateAllLabelDivsByStatusDebounce=_.throttle(function(){i._updateAllLabelDivsByStatus()},500),this._project.getCamera().on(this._dirtyAllLabelPoints,this)}return e.defaultInitLabelDivFunc=function(e){e.style.position="absolute",e.style.left="50px",e.style.top="50px",e.style.zIndex="100",e.style.color="white",e.style.visibility="hidden"},e.defaultHideLabelDivFunc=function(e,t,i){e.style.visibility="hidden",e.style.opacity="0",e.style.transition="opacity 0.0s linear"},e.defaultShowLabelDivFunc=function(e,t,i,o){e.style.left=t.screenPos.x+"px",e.style.top=t.screenPos.y+"px",e.innerText=i.name,e.style.transition="opacity 0.5s linear",e.style.visibility="visible",e.style.opacity="1",e.style.fontSize="20px",e.style.textShadow="0px 0px 1px #000"},e.copyLabelPointStatus=function(e,t){t.screenPos.x=e.screenPos.x,t.screenPos.y=e.screenPos.y,t.isInWindow=e.isInWindow,t.cameraDistanceSquared=e.cameraDistanceSquared,t.isInDistanceRange=e.isInDistanceRange,t.isOcculuded=e.isOcculuded},e.defaultLabelPointOptions={name:"未命名标签",position:[0,0,0],viewDistance:100,tags:[],pixelSize:10,color:[1,0,0,1],distanceDisplayCondition:[0,1e14],iconUrl:"//res2.gbim360.com/txf/170712/bimimage/32.jpg",occuludedDisabled:!0,enabled:!1},e.defaultLabelPointStatus={screenPos:{x:0,y:0},isInWindow:!1,cameraDistanceSquared:0,isInDistanceRange:!1,isOcculuded:!0},e.prototype.setLabelDivFuncs=function(e,t,i){void 0!==e&&(this._initLabelDivFunc=e),void 0!==t&&(this._showLabelDivFunc=t),void 0!==i&&(this._hideLabelDivFunc=i)},e.prototype._createLabelDiv=function(){var e;if(0===this._freeDivs.length){var e=document.createElement("div");this._initLabelDivFunc(e),this._viewer.container.appendChild(e)}else e=this._freeDivs[this._freeDivs.length-1],this._initLabelDivFunc(e),this._freeDivs.pop();return e},e.prototype.addLabelPoint=function(t){var i=Freedo.createGuid(),o=Freedo.clone(e.defaultLabelPointOptions,!0),r=Freedo.clone(t,!0);Object.assign(o,r),this._labelPointOpts[i]=o;var n=o.position,s=o.color,a=o.distanceDisplayCondition,h=this._pointCollection.add({position:Freedo.Cartesian3.fromDegrees(n[0],n[1],n[2]),color:new Freedo.Color(s[0],s[1],s[2],s[3]),pixelSize:o.pixelSize,distanceDisplayCondition:new Freedo.DistanceDisplayCondition(a[0],a[1]),point:!1});return this._labelPoints[i]={},this._labelPoints[i].point=h,o.enabled&&(this._enableLabelPointDiv(this._labelPoints[i],!0),h.show=!0),this._addChangedLabelPoint(i),this._event.raiseEvent("Add",{id:i}),i},e.prototype._enableLabelPointDiv=function(e,t){if(t){var i=this._createLabelDiv();e.labelDiv=i,e.point.show=!0}else{var o=e.labelDiv;void 0!==o&&(this._hideLabelDivFunc(o),this._freeDivs.push(o),delete e.labelDiv),e.point.show=!1}},e.prototype._enableLabelPoint=function(e,t){var i=this._labelPointOpts[e],o=this._labelPoints[e];return i.enabled!=t&&(this._enableLabelPointDiv(o,t),i.enabled=t,!0)},e.prototype.enableLablePoint=function(e,t){if(void 0===this._labelPointOpts[e])throw new Error("FdLabelPointsManager.enableLablePoint got error!");this._enableLabelPoint(e,t)&&(this._addChangedLabelPoint(e),this._event.raiseEvent("Changed",e))},e.prototype.isLabelPointEnabled=function(e){var t=this._labelPointOpts[e];if(void 0===t)throw new Error("FdLabelPointsManager.isLabelPointEnabled error");return t.enabled},e.prototype.hasLabelPoint=function(e){return void 0!==this._labelPointOpts[e]},e.prototype._removeLabelPoint=function(e){var t=this._labelPoints[e].point;this._pointCollection.remove(t),this._enableLabelPoint(e,!1);var i=this._labelPoints[e].labelStatus;this._freeLabelStatusCollection.push(i),delete this._labelPoints[e],delete this._labelPointOpts[e]},e.prototype.removeLabelPoint=function(e){return void 0===this._labelPointOpts[e]?(alert("sceneObjectID: "+e+" 已不存在！"),!1):(this._removeLabelPoint(e),this._event.raiseEvent("Changed"),!0)},e.prototype.removeAllLabelPoints=function(){for(var e in this._labelPoints)this._removeLabelPoint(e);this._event.raiseEvent("Changed")},e.prototype.getLabelPointOptions=function(e,t){var i=this._labelPointOpts[e];if(void 0===i)throw new Error("FdLabelPointsManager.getLabelPointOptions: cannot get property!");return void 0===t&&(t={}),Object.assign(t,i),t},e.prototype.setLabelPointOptions=function(e,t){var i=this._labelPointOpts[e];if(void 0===i)throw new Error("FdLabelPointsManager.setLabelOptions: cannot get property!");if(!_.isEqual(i,t)){if(void 0!==t.position){var o=this._labelPoints[e].point,r=t.position;o.position=Freedo.Cartesian3.fromDegrees(r[0],r[1],r[2])}if(void 0!==t.color){var n=t.color;o.color=new Freedo.Color(n[0],n[1],n[2],n[3])}void 0!==t.pixelSize&&(o.pixelSize=t.pixelSize),Object.assign(i,t),this._addChangedLabelPoint(e),this._event.raiseEvent("Changed",e)}},e.prototype.getLabelPointPosition=function(e,t){var i=this._labelPointOpts[e];if(void 0===i)throw new Error("FdLabelPointsManager.getLabelOption: cannot get property!");return void 0===t&&(t=[]),t[0]=i.position[0],t[1]=i.position[1],t[2]=i.position[2],t},e.prototype.setLabelPointPosition=function(e,t){var i=this._labelPointOpts[e];if(void 0===i)throw new Error("FdLabelPointsManager.setPosition got error!");if(void 0===t)throw new Error("FdLabelPointsManager.setPosition got error!");if(!_.isEqual(i.position,t)){var o=this._labelPoints[e].point,r=t;o.position=Cartesian3.fromDegrees(r[0],r[1],r[2]),this._addChangedLabelPoint(e),this._event.raiseEvent("Changed",e)}},e.prototype._addChangedLabelPoint=function(e){-1===this._changedLabelPointIDs.indexOf(e)&&(this._changedLabelPointIDs.push(e),this._updateLabelDivsByChangedInfoThrottle())},e.prototype._dirtyAllLabelPoints=function(e){if("Changed"===e&&0!==this._labelPoints.length){this._changedLabelPointIDs.splice(0,this._changedLabelPointIDs.length);for(var t in this._labelPoints)this._changedLabelPointIDs.push(t);this._updateLabelDivsByChangedInfoThrottle()}},e.prototype.getLabelPointStatus=function(t,i){var o=this._labelPoints[t].point;if(void 0===o)throw new Error("FdLabelPointsManager.isLabelPointOccluded got error");var r=this._labelPointOpts[t];if(void 0===r)throw new Error("FdLabelPointsManager.setPosition got error!");void 0===i?0!==this._freeLabelStatusCollection.length?(i=this._freeLabelStatusCollection[this._freeLabelStatusCollection.length-1],this._freeLabelStatusCollection.pop()):i=Freedo.clone(e.defaultLabelPointStatus,!0):e.copyLabelPointStatus(e.defaultLabelPointStatus,i);do{var n=this._viewer,s=n.container.offsetWidth,a=n.container.offsetHeight;o.computeScreenSpacePosition(n.scene,i.screenPos);var h=i.screenPos;if(!(h.x>=0&&h.x<s&&h.y>=0&&h.y<a)){i.isInWindow=!1;break}i.isInWindow=!0,i.cameraDistanceSquared=Freedo.Cartesian3.distanceSquared(n.camera.positionWC,o.position);var l=r.distanceDisplayCondition;if(!(i.cameraDistanceSquared>=l[0]*l[0]&&i.cameraDistanceSquared<=l[1]*l[1])){i.isInDistanceRange=!1;break}if(i.isInDistanceRange=!0,r.occuludedDisabled)i.isOcculuded=!1;else{var c=n.scene.pick(h);Freedo.defined(c)&&c.primitive===o?i.isOcculuded=!1:i.isOcculuded=!0}}while(!1)},e.prototype.getLabelPointStatusCollection=function(t,i){void 0===i&&(i=[]);for(var o=t.length,r=0;r<o;++r){var n=t[r];void 0!==n&&(void 0===i[r]&&(i[r]=Freedo.clone(e.defaultLabelPointStatus,!0)),this.getLabelPointStatus(n,i[r]))}},e.prototype._updateAllLabelDivsByStatus=function(){for(var e in this._labelPoints)if(this._labelPointOpts[e].enabled){var t=this._labelPoints[e].labelDiv,i=this._labelPoints[e].labelStatus,o=this._labelPointOpts[e];void 0!==t&&void 0!==i&&(i.isInWindow&&i.isInDistanceRange&&!i.isOcculuded?this._showLabelDivFunc(t,i,o,e):this._hideLabelDivFunc(t,o,e))}},e.prototype._hideLabelDivImmediately=function(e){if(void 0!==this._labelPoints[e]){var t=this._labelPoints[e].labelDiv,i=this._labelPointOpts[e];void 0!==t&&this._hideLabelDivFunc(t,i,e)}},e.prototype._updateLabelsDivsByChangedInfo=function(){var t=this._changedLabelPointIDs,i=this._changedLabelPointStatusCollection;this.getLabelPointStatusCollection(t,i);for(var o,r,n=0;n<t.length;++n)if(o=t[n],this._labelPointOpts[o].enabled){r=i[n],void 0===this._labelPoints[o].labelStatus&&(this._labelPoints[o].labelStatus=Freedo.clone(e.defaultLabelPointStatus,!0));var s=this._labelPoints[o].labelStatus,a=s.screenPos,h=r.screenPos,l=!Freedo.Math.equalsEpsilon(a.x,h.x,.001)||!Freedo.Math.equalsEpsilon(a.y,h.y,.001);this._labelPoints[o].labelDiv,r.isInWindow&&r.isInDistanceRange&&!r.isOcculuded&&!l||this._hideLabelDivImmediately(o),e.copyLabelPointStatus(r,s),this._updateAllLabelDivsByStatusDebounce()}t.splice(0,t.length)},e.prototype.getAllTags=function(e){void 0===e&&(e=[]),e.splice(0,e.length);var t=this._labelPointOpts;for(var i in t)for(var o=t[i],r=o.tags.length,n=0;n<r;++n){var s=o.tags[n];-1===e.indexOf(o.tags[n])&&e.push(s)}return e},e.prototype.getLabelPointIDsByTags=function(e,t){void 0===t&&(t=[]),t.splice(0,t.length);var i=this._labelPointOpts;for(var o in i)for(var r=i[o],n=0;n<e.length;++n){var s=e[n];if(-1!==r.tags.indexOf(s)){t.push(o);break}}return t},e.prototype.enableLabelPointsByTagsAndDisableOthers=function(e){var t,i,o,r=this._labelPointOpts,n=!1;for(var s in r){i=r[s],t=!1;for(var a=0;a<e.length;++a)if(o=e[a],-1!==i.tags.indexOf(o)){t=!0;break}this._enableLabelPoint(s,t)&&(this._addChangedLabelPoint(s),n=!0)}n&&this._event.raiseEvent("Changed")},e.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},e.prototype.getAllLabelPointIDs=function(e){void 0===e&&(e=[]),e.splice(0,e.length);for(var t in this._labelPointOpts)e.push(t);return e},e.prototype.reset=function(){this.removeAllLabelPoints()},e.prototype.dispose=function(){this._project._viewer.scene.primitives.remove(this._pointCollection),this.reset(),this._eventHelper.removeAll()},e}.call(t,i,t,e))&&(e.exports=o)},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"FdPModelSet",function(){return s});var r=i(5),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),s=function(){function e(t){o(this,e),this._json=t,this._pModelsByIdentifier={},this._offsetModelMatrix=Freedo.Matrix4.clone(Freedo.Matrix4.IDENTITY);for(var i=0;i<this._json.PModels.length;++i){var n=this._json.PModels[i],s=new r.FdPModel(this,n);this._pModelsByIdentifier[n.Identifier]=s}}return n(e,[{key:"getPModelIDs",value:function(){return Object.keys(this._pModelsByIdentifier)}},{key:"getPModel",value:function(e){return this._pModelsByIdentifier[e]}},{key:"LayerIdentifier",get:function(){return this._json.LayerIdentifier}},{key:"position",get:function(){for(var e in this._pModelsByIdentifier)return this._pModelsByIdentifier[e].position}},{key:"offsetModelMatrix",get:function(){return this._offsetModelMatrix},set:function(e){this._offsetModelMatrix=e}}]),e}()},function(e,t,i){var o,r;o=[i(0),i(3),i(16),i(18),i(8),i(29),i(15),i(11),i(17),i(34),i(12),i(36),i(37),i(25),i(31),i(32),i(1),i(27),i(33),i(2),i(9),i(30)],void 0!==(r=function(e,t,i,o,r,n,s,a,h,l,c,d,p,u,v,f,g,y,m,C,F,w){"use strict";function b(e){this._viewer=e,this._camera=new t(e),this._options={},this._options.projectInfo=Freedo.clone(b.defaultProjectOptions.projectInfo,!0),this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper,this._sceneManager=new i(this),this._viewpointsManager=new o(this),this._remoteCollaboration=new s(this),this._transform=new d(this),this._transformHelper=new p(this),this._3DModelViewer=new u(this),this._clipPlane=new n(this),this._analysisManager=new r(this),this._imageryLayersManager=new a(this),this._labelPointsManager=new c(this),this._fdVR=new h(this),this._fdTerrain=new l(this),this._eraseGround=new v(this),this._kb=new f(this),this._pathAnimator=new g(this),this._pathsManager=new m(this),this._ple=new C(this),this._dr=new F(this),this._drm=new w(this),this._cameraManipulator=new y(this),this._cameraManipulator.enable(),this._imageryLayersManager.removeAll(),this._addBaseDefualtImageryLayer()}return b.defaultProjectOptions={projectInfo:{name:void 0,owner:void 0,initialCameraInfo:{manualSet:!1}},sceneObjects:{},viewpoints:{},labels:{},paths:{}},Object.defineProperties(b.prototype,{name:{get:function(){return this._options.projectInfo.name},set:function(e){this._options.projectInfo.name!==e&&(this._options.projectInfo.name=e,this._event.raiseEvent("projectInfoChanged"))}},owner:{get:function(){return this._options.projectInfo.owner},set:function(e){this._options.projectInfo.owner!==e&&(this._options.projectInfo.owner=e,this._event.raiseEvent("projectInfoChanged"))}},public:{get:function(){return this._options.projectInfo.public},set:function(e){this._options.projectInfo.public!==e&&(this._options.projectInfo.public=e,this._event.raiseEvent("projectInfoChanged"))}},initialCameraInfo:{get:function(){return Freedo.clone(this._options.projectInfo.initialCameraInfo,!0)},set:function(e){_.isEqual(this._options.projectInfo.initialCameraInfo,e)||(this._options.projectInfo.initialCameraInfo=_.clone(e,!0),this._event.raiseEvent("projectInfoChanged"))}},projectInfo:{get:function(){return Freedo.clone(this._options.projectInfo,!0)},set:function(e){_.isEqual(e,this._options.projectInfo)||(this._options.projectInfo=Freedo.clone(e,!0),this._event.raiseEvent("projectInfoChanged"))}}}),b.prototype._addBaseDefualtImageryLayer=function(){var e={name:"NaturalEarthII",type:"TileMapService",layerOption:{show:!0,alpha:.8},providerOptions:{url:"//res.gbim360.com/lib/freedo/rel/1.5.8/Freedo/Assets/Textures/NaturalEarthII"}};this.getImageryLayersManager().add(e)},b.prototype.getViewer=function(){return this._viewer},b.prototype.getCurrentCameraInfo=function(){return this._camera.getCurrentCameraInfo()},b.prototype.flytoByCameraInfo=function(e,t){return this._camera.flytoByCameraInfo(e,t)},b.prototype.getCamera=function(){return this._camera},b.prototype.getOptions=function(){return Freedo.clone(this._options,!0)},b.prototype.open=function(e){this._options.projectInfo=Freedo.clone(e.projectInfo,!0),this._options.terrain=Freedo.clone(e.terrain,!0);var t=this._options.terrain;void 0!==t?(this._fdTerrain.setTerrain(t.url,t.type),this._fdTerrain.showTerrain(t.show)):(this._options.terrain={},this._options.terrain.type="STK",this._options.terrain.url="//terrain.gbim360.com/",this._options.terrain.show=!1),this._event.raiseEvent("projectOpened"),this._event.raiseEvent("projectInfoChanged");var i=e.sceneObjects;if(void 0!==i)for(var o in i){var r=i[o];this._sceneManager.addSceneObject(r.name,r.type,r.options)}var n=e.viewpoints;if(void 0!==n)for(var s in n){var a=n[s];if(this._viewpointsManager.createGroup(a.name,s),void 0!==a.list)for(var h=a.list,l=0;l<h.length;++l)this._viewpointsManager.appendViewpoint(s,h[l])}var c=e.paths;if(void 0!==c)for(var d in c){var p=c[d];if(this._pathsManager.createGroup(p.name,d),void 0!==p.list)for(var _=p.list,l=0;l<_.length;++l)this._pathsManager.appendPathPoint(d,_[l])}var u=e.imageryLayers;if(void 0!==u){this._imageryLayersManager.removeAll();for(var l=0;l<u.length;++l)this._imageryLayersManager.add(u[l])}var v=e.labelPoints;if(void 0!==v){this._labelPointsManager.removeAllLabelPoints();for(var f in v)this._labelPointsManager.addLabelPoint(v[f])}},b.prototype.reset=function(){this._options.projectInfo=Freedo.clone(b.defaultProjectOptions.projectInfo,!0),this._event.raiseEvent("projectInfoChanged"),this._event.raiseEvent("projectClosed"),this._remoteCollaboration.reset(),this._transform.reset(),this._3DModelViewer.reset(),this._sceneManager.reset(),this._viewpointsManager.reset(),this._pathsManager.reset(),this._analysisManager.reset(),this._imageryLayersManager.reset(),this._labelPointsManager.reset(),this._camera.reset(),this._addBaseDefualtImageryLayer(),this._fdTerrain.reset(),this._clipPlane.reset()},b.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},b.prototype.clearAllEventListeners=function(){this._eventHelper.removeAll()},b.prototype.dispose=function(){this._sceneManager.dispose(),this._viewpointsManager.dispose(),this._pathsManager.dispose(),this._remoteCollaboration.dispose(),this._transform.dispose(),this._3DModelViewer.dispose(),this._imageryLayersManager.dispose(),this._labelPointsManager.dispose(),this._eventHelper.removeAll(),this._camera.dispose(),this._fdTerrain.dispose(),this._viewer.destroy()},b.prototype.getSceneManager=function(){return this._sceneManager},b.prototype.getViewpointsManager=function(){return this._viewpointsManager},b.prototype.getRemoteCollaboration=function(){return this._remoteCollaboration},b.prototype.getTransform=function(){return this._transformHelper},b.prototype.getTransformHelper=function(){return this._transformHelper},b.prototype.getKeyboard=function(){return this._kb},b.prototype.get3DModelViewer=function(){return this._3DModelViewer},b.prototype.getAnalysisManager=function(){return this._analysisManager},b.prototype.getImageryLayersManager=function(){return this._imageryLayersManager},b.prototype.getLabelPointsManager=function(){return this._labelPointsManager},b.prototype.getPathAnimator=function(){return this._pathAnimator},b.prototype.getPathsManager=function(){return this._pathsManager},b.prototype.getPolylineEditor=function(){return this._ple},b.prototype.getDrawRoad=function(){return this._dr},b.prototype.getDrawRoadManager=function(){return this._drm},b.prototype.getVR=function(){return this._fdVR},b.prototype.getTerrain=function(){return this._fdTerrain},b.prototype.getEraseGround=function(){return this._eraseGround},b.prototype.getClipPlane=function(){return this._clipPlane},b.prototype.getCameraManipulator=function(){return this._cameraManipulator},b.staticTempPickCartographic=new Freedo.Cartographic,b.staticTempPickPosition=new Freedo.Cartesian3,b.prototype.pickPosition=function(e,t){void 0===t&&(t=[]);var i,o=this._viewer,r=this._viewer.scene;if(r.mode!==Freedo.SceneMode.MORPHING){var n=r.pick(e);i=r.pickPositionSupported&&Freedo.defined(n)?o.scene.pickPosition(e):o.camera.pickEllipsoid(e,r.globe.ellipsoid)}if(!Freedo.defined(i))return[0,0,0];var s=Freedo.Cartographic.fromCartesian(i,this._viewer.scene.globe.ellipsoid,b.staticTempPickCartographic),a=Freedo.Math.toDegrees;return t[0]=a(s.longitude),t[1]=a(s.latitude),t[2]=s.height,t},b}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o,r;o=[i(19),i(3)],void 0!==(r=function(e,t){"use strict";function i(e){this.number=0,this._viewer=e.getViewer(),this._project=e,this._nLastClickTime="",this._bActive=!1,this._bMouseDown=!1,this._bKeyDown=!1,this._nLastOPTime=0,this._nLastRenderTime=0,this._bInRun=!1,this._bOffline=!0,this._rtc=void 0,this._messageR="",this._messageS="",this._nConnectedPeers=0,this._event={}}return i.prototype.on=function(e,t){this._event[e]=this._event[e]||[],this._event[e].push(t)},i.prototype.emit=function(e,t){var i,o,r=this._event[e],n=Array.prototype.slice.call(arguments,1);if(r)for(i=0,o=r.length;i<o;i++)r[i].apply(null,n)},i.prototype.setCollaborationNumber=function(t){if(this.number=t,this.run(),0==this.number){if(this._bOffline)return;this.disconnect(),this._rtc=void 0,this._bOffline=!0}else{if(!this._bOffline)return;this._bOffline=!1,this._rtc=new e,this._rtc.on("connected",this.onConnected.bind(this)),this._rtc.on("data_channel_message",this.onMsgReceived.bind(this)),this._rtc.on("pc_add_data_channel",this.onNewPeerAdded.bind(this)),this._rtc.on("get_peers",this.onGetPeers.bind(this)),this._rtc.on("remove_peer",this.onPeerRemoved.bind(this)),this._rtc.on("socket_closed",this.onExit.bind(this)),this.connect()}},i.prototype.run=function(){this._bInRun||(this._bInRun=!0,this.addListeners(),this.setTimers())},i.prototype.sendView=function(){if(!this._bOffline){var e=this._viewer.camera.positionCartographic,t=this._viewer.camera.heading,i=this._viewer.camera.pitch,o=this._viewer.camera.roll,r=Freedo.Math.toDegrees(e.longitude)+", "+Freedo.Math.toDegrees(e.latitude)+", "+e.height+", "+Freedo.Math.toDegrees(t)+", "+Freedo.Math.toDegrees(i)+", "+Freedo.Math.toDegrees(o);return this._messageS!=r&&(this._rtc.broadcast(r),this._messageS=r),!0}},i.prototype.checkOp=function(){this._bActive=!0,this._nLastClickTime=(new Date).getTime()/1e3,this.sendView()},i.prototype.onKeyDown=function(){this._bKeyDown=!0},i.prototype.onKeyUp=function(){this._bKeyDown=!1},i.prototype.onMouseDown=function(){this._bMouseDown=!0},i.prototype.onMouseUp=function(){this._bMouseDown=!1},i.prototype.onMouseMove=function(){this._bMouseDown&&(new Date).getTime()-this._nLastOPTime>5&&(this.checkOp(),this._nLastOPTime=(new Date).getTime())},i.prototype.checkKey=function(){this._bKeyDown&&this.checkOp()},i.prototype.checkActive=function(){(new Date).getTime()/1e3-this._nLastClickTime>.5&&(this._bActive=!1)},i.prototype.onPostRender=function(){(new Date).getTime()-this._nLastRenderTime>50&&this._bActive&&(this.sendView(),this._nLastRenderTime=(new Date).getTime())},i.prototype.setView=function(e,t,i,o,r,n){this._viewer.camera.setView({destination:Freedo.Cartesian3.fromDegrees(e,t,i),orientation:{heading:Freedo.Math.toRadians(o),pitch:Freedo.Math.toRadians(r),roll:Freedo.Math.toRadians(n)}})},i.prototype.addListeners=function(){document.addEventListener("click",this.checkOp.bind(this)),document.addEventListener("touchstart",this.checkOp.bind(this),{passive:!0}),document.addEventListener("wheel",this.checkOp.bind(this),{passive:!0}),window.addEventListener("keydown",this.onKeyDown.bind(this)),window.addEventListener("keyup",this.onKeyUp.bind(this));var e=new Freedo.ScreenSpaceEventHandler(this._viewer.scene.canvas);e.setInputAction(this.onMouseDown.bind(this),Freedo.ScreenSpaceEventType.LEFT_DOWN),e.setInputAction(this.onMouseUp.bind(this),Freedo.ScreenSpaceEventType.LEFT_UP),e.setInputAction(this.onMouseDown.bind(this),Freedo.ScreenSpaceEventType.RIGHT_DOWN),e.setInputAction(this.onMouseUp.bind(this),Freedo.ScreenSpaceEventType.RIGHT_UP),e.setInputAction(this.onMouseMove.bind(this),Freedo.ScreenSpaceEventType.MOUSE_MOVE),this._viewer.scene._postRender.addEventListener(this.onPostRender.bind(this),null)},i.prototype.setTimers=function(){setInterval(this.checkActive.bind(this),1e3),setInterval(this.checkKey.bind(this),5)},i.prototype.onMsgReceived=function(e,t,i){if(this._messageR!=i){if(this._bOffline)return;if(!this._bActive){var o=i.split(",");this.setView(o[0],o[1],o[2],o[3],o[4],o[5])}this._messageR=i}},i.prototype.onConnected=function(){this.emit("Connected","已连接上服务器"),console.log("已连接上服务器"),this._rtc.ready()},i.prototype.onGetPeers=function(e){this.emit("GetPeers",e.length),this._nConnectedPeers=e.length-1,console.log("现有其他客户端： "+e.length)},i.prototype.onNewPeerAdded=function(e){this._nConnectedPeers++,this.emit("NewPeerAdded",this._nConnectedPeers,e),console.log("已连接客户端： "+this._nConnectedPeers+"/"+e)},i.prototype.onPeerRemoved=function(e){this._nConnectedPeers--,this.emit("PeerRemoved",this._nConnectedPeers,e),console.log("已连接客户端： "+this._nConnectedPeers+"/"+e)},i.prototype.onExit=function(e){this._nConnectedPeers--,this.emit("Exit",e),console.log("==================================本机已退出\n")},i.prototype.connect=function(){this._rtc.connect("ws://182.92.7.32:3000","room"+this.number)},i.prototype.disconnect=function(){this._rtc.exit()},i.prototype.dispose=function(){this._bOffline=!0},i.prototype.reset=function(){this._bOffline=!0},i}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void 0!==(o=function(){"use strict";function e(e){e._options.sceneObjects={},this._sceneObjectOpts=e._options.sceneObjects,this._labelOpts={},this._pModelMap={},this._labelMap={},this._pModelStyleMap={},this._baseColor=[255,255,255,1],this._project=e,this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper;var t=this;this.updatePModelStyleThrottle=_.throttle(t._updatePModelStyle,100)}var t=Freedo.defaultValue;return e.prototype.addI3SLayer=function(e,t){var i=Freedo.clone(t,!0);return i.url="//i3s.gbim360.cn/proxyi3s/("+i.url+")/",this.addSceneObject(e,"PModel",i)},e.prototype.addSceneObject=function(e,t,i){var o=Freedo.createGuid(),r=null;if("PModel"!==t){if("Model"===t)return null;throw new Error("FdSceneManager.addSceneObject: error")}r=this._project._viewer.scene.primitives.add(new Freedo.FreedoPModelset(i)),void 0!==i.initialMatrix&&(r.modelMatrix=Freedo.clone(i.initialMatrix,!0)),this._pModelMap[o]=r,this._pModelStyleMap[o]={};var n={name:e,type:t,options:Freedo.clone(i,!0)};this._sceneObjectOpts[o]=n,this._event.raiseEvent("Add",{id:o,opt:n});var s=new Freedo.PinBuilder,a=new Freedo.Cartesian3,h=0,l={position:a,billboard:{image:s.fromColor(Freedo.Color.CHOCOLATE,32).toDataURL(),distanceDisplayCondition:new Freedo.DistanceDisplayCondition(h),disableDepthTestDistance:Number.POSITIVE_INFINITY,horizontalOrigin:Freedo.HorizontalOrigin.CENTER,verticalOrigin:Freedo.VerticalOrigin.BOTTOM,show:!0}};this._labelOpts[o]=l;var c=this;return r.readyPromise.then(function(e){c._event.raiseEvent("Loaded",{id:o}),a.x=e.boundingSphere.center.x,a.y=e.boundingSphere.center.y,a.z=e.boundingSphere.center.z,h=15*e.boundingSphere.radius,l.position=a,l.billboard.distanceDisplayCondition=new Freedo.DistanceDisplayCondition(h),c._labelOpts[o]=l;var t=c._project._viewer.entities.add(l);c._labelMap[o]=t}),o},e.prototype.removeSceneObject=function(e){if(void 0===this._sceneObjectOpts[e])return alert("sceneObjectID: "+e+" 已不存在！"),!1;var t=this._sceneObjectOpts[e];if("PModel"!==t.type){if("Model"===t.type)return!1;throw new Error("FdSceneManager.removeSceneObject: cannot get sceneObject")}var i=this._pModelMap[e];this._project._viewer.scene.primitives.remove(i);var o=this._labelMap[e];return this._project._viewer.entities.remove(o),delete this._sceneObjectOpts[e],delete this._pModelMap[e],delete this._pModelStyleMap[e],delete this._labelMap[e],delete this._labelOpts[e],this._event.raiseEvent("Remove",e),!0},e.prototype.getSceneObject=function(e){var t=this._sceneObjectOpts[e];if(void 0===t)return null;if("PModel"===t.type)return this._pModelMap[e];if("Model"===t.type)return null;throw new Error("FdSceneManager.getSceneObject: cannot get sceneObject!")},e.prototype.getSceneObjectProperty=function(e,t){var i=this._sceneObjectOpts[e];if(void 0!==i){if(i.options&&void 0!==i.options[t])return Freedo.clone(i.options[t],!0);if("PModel"===i.type){var o=this._pModelMap[e];return o.ready&&r("undefined"!==o[t])?o[t]:void 0}return void i.type}},e.prototype.getLabelProperty=function(e,t){var i=this._labelOpts[e];if(void 0!==i){if(void 0!==i.billboard[t])return Freedo.clone(i.billboard[t],!0);if(void 0!==i[t])return Freedo.clone(i[t],!0);var o=this._labelMap[e];return r("undefined"!==o[t])?o[t]:void 0}},e.prototype.setSceneObjectProperty=function(e,t,i){var o=this._sceneObjectOpts[e];if(void 0===o)throw new Error("FdSceneManager.getSceneObjectProperty: cannot get property!");var n=this.getSceneObjectProperty(e,t);if(!_.isEqual(n,i)){if("PModel"!==o.type)throw o.type,new Error("FdSceneManager.getSceneObjectProperty: cannot get property!");var s=this._pModelMap[e];if(!r("undefined"!==s[t]))throw new Error("FdSceneManager.getSceneObjectProperty: cannot get property!");s[t]=i,o.options[t]=i,this._event.raiseEvent("Changed",e)}},e.prototype.setLabelProperty=function(e,t,i){var o=this._labelOpts[e];if(void 0===o)throw new Error("FdSceneManager.getLabelProperty : cannot get property!");var n=this.getLabelProperty(e,t);if(!_.isEqual(n,i)){var s=this._labelMap[e];if(!r("undefined"!==s[t]))throw new Error("FdSceneManager.getLabelProperty: cannot get property!");s[t]=i,o.hasOwnProperty(t)?o[t]=i:o.billboard.hasOwnProperty(t)&&(o.billboard[t]=i)}},e.prototype.resetAllSceneObjectsProperty=function(){for(var e in this._sceneObjectOpts){var t=this._sceneObjectOpts[e];for(var i in t.options){var o=this.getSceneObject(e)[i],r=t.options[i];if(!_.isEqual(o,r)){if("PModel"!==t.type)throw t.type,new Error("FdSceneManager.getSceneObjectProperty: cannot get property!");var n=this._pModelMap[e];if(void 0===n[i])throw new Error("FdSceneManager.getSceneObjectProperty: cannot get property!");n[i]=r,t.options[i]=r,this._event.raiseEvent("Changed",e)}}}},e.prototype.flyto=function(e,t,i){var o=this.getSceneObjectProperty(e,"boundingSphere");if(void 0!==o){var r,n;void 0!==t&&void 0!==t.duration&&(r=t.duration),n=void 0!==t&&void 0!==t.offset?t.offset:new Freedo.HeadingPitchRange(0,FreeDo.Math.toRadians(-90),5*o.radius);var s=this._project.getCamera();s.flyToBoundingSphere(o,{offset:n,duration:r}),!1!==i&&s.trackByBoundingSphere(o)}},e.prototype._findPModel=function(e){var t=e._content._tileset;for(var i in this._pModelMap)if(this._pModelMap[i]===t)return i},e.prototype.selectComponent=function(e,i,o){o=t(o,!1);var r=this._project.getViewer(),n=r.scene.pick(e);if(Freedo.defined(n)&&n instanceof Freedo.FreedoPModelFeature){var s=this._findPModel(n),a=n.getProperty("component");if(Freedo.defined(a,s)){var h=void 0;return o&&(h=n.getAncestors("component")),void i(a,s,h)}}i(void 0,void 0)},e.prototype._updatePModelStyle=function(){var e,t,i=[],o=[];for(var r in this._pModelMap)if(e=this._pModelMap[r],i.splice(0,i.length),o.splice(0,o.length),void 0!==(t=this._pModelStyleMap[r])){for(var n in t){var s=t[n];if(void 0!==s.color){var a=s.color,h="rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")";i.push(["${component} ~== '"+n+"'",h])}void 0!==s.show&&(s.show||o.push(["${component} ~== '"+n+"'","false"]))}var l=this._baseColor,c="rgba("+l[0]+","+l[1]+","+l[2]+","+l[3]+")";i.push(["true",c]),o.push(["true","true"]),e.style=new Freedo.FreedoPModelStyle({color:{conditions:i},show:{conditions:o}})}},e.prototype.setHighlightMode=function(e){this._project.getViewer().scene.context.uniformState.highlightModeRepalce=e},e.prototype.highlightComponent=function(e,t,i,o,r,n){var s=t;if(Freedo.defined(e)&&void 0!==this._pModelMap[s]){void 0===this._pModelStyleMap[s]&&(this._pModelStyleMap[s]={});var a=this._pModelStyleMap[s];return void 0===a[e]&&(a[e]={}),a[e].color=[i,o,r,n],this.updatePModelStyleThrottle(),!0}return!1},e.prototype.unhighlightAllComponents=function(){for(var e in this._pModelMap){var t=this._pModelStyleMap[e];for(var i in t)delete t[i].color}this.updatePModelStyleThrottle()},e.prototype.setBaseColor=function(e,t,i,o){this._baseColor=[e,t,i,o],this.updatePModelStyleThrottle()},e.prototype.showComponent=function(e,t,i){var o=t;if(Freedo.defined(e)){this._pModelMap[o];void 0===this._pModelStyleMap[o]&&(this._pModelStyleMap[o]={});var r=this._pModelStyleMap[o];void 0===r[e]&&(r[e]={}),r[e].show=i}this.updatePModelStyleThrottle()},e.prototype.showAllComponents=function(e){for(var t in this._pModelMap){var i=this._pModelStyleMap[t];for(var o in i)delete i[o].show}this.updatePModelStyleThrottle()},e.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},e.prototype.getAllSceneObjects=function(){return Freedo.clone(this._sceneObjectOpts,!0)},e.prototype.removeAllSceneObjects=function(){for(var e in this._pModelMap){var t=this._pModelMap[e];delete this._pModelMap[e];var i=this._project._viewer.scene.primitives.remove(t);if(!i)throw new Error("FdSceneManager.removeAllSceneObjects: error")}for(var e in this._pModelStyleMap)delete this._pModelStyleMap[e];for(var e in this._labelMap){var o=this._labelMap[e];delete this._labelMap[e];var i=this._project._viewer.entities.remove(o);if(!i)throw new Error("FdSceneManager.removeAllSceneObjects: error")}for(var r in this._sceneObjectOpts)delete this._sceneObjectOpts[r];for(var r in this._labelOpts)delete this._labelOpts[r];this._event.raiseEvent("sceneObjectsChanged")},e.prototype.reset=function(){this.removeAllSceneObjects()},e.prototype.clearAllEventListeners=function(){this._eventHelper.removeAll()},e.prototype.dispose=function(){this.reset(),this._eventHelper.removeAll()},e}.call(t,i,t,e))&&(e.exports=o)},function(e,t,i){var o;void 0!==(o=function(){"use strict";function e(e){this._project=e,this._viewer=e.getViewer(),this._scene=this._viewer.scene,this._inVr=!1,this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper}return e.prototype.enableVR=function(e){this._inVr&&0==e&&(this._scene.useWebVR=!1,this._inVr=!1,this._event.raiseEvent("StatusChanged",!1)),this._inVr||1!=e||(this._scene.useWebVR=!0,this._inVr=!0,this._event.raiseEvent("StatusChanged",!0))},e.prototype.enable=function(){this.enableVR(!0)},e.prototype.disable=function(){this.enableVR(!1)},e.prototype.getStatus=function(){return this._inVr},e.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},e.prototype.reset=function(){this.enableVR(!1)},e.prototype.dispose=function(){this.enableVR(!1)},e}.call(t,i,t,e))&&(e.exports=o)},function(e,t,i){var o,r;o=[i(10),i(1)],void 0!==(r=function(e,t){"use strict";function i(t){t._options.viewpoints={},this._viewpointOpts=t._options.viewpoints,this._project=t,this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper,this._flytoControl=new e(t.getCamera()),this._currentPlayingGroupID=void 0;var i=this;this._flytoControl.on(function(e,t){i.flyingtoEventCallback(e,t)})}return Object.defineProperties(i.prototype,{playingLoop:{get:function(){return this._flytoControl.loop},set:function(e){this._flytoControl.loop!==e&&(this._flytoControl.loop=e)}}}),i.prototype.flyingtoEventCallback=function(e,t){"CurrentIndexChanged"===e?this._event.raiseEvent("PlayingGroupCurrentIndexChanged",t):"StatusChanged"===e?this._event.raiseEvent("PlayingGroupStatusChanged",t):"PropertyChanged"===e&&this._event.raiseEvent("PlayingGroupPropertyChanged",t)},i.prototype.createGroup=function(e,t){return void 0===t&&(t=Freedo.createGuid()),this._viewpointOpts[t]={name:e,list:[]},this._event.raiseEvent("GroupsChanged"),t},i.prototype.removeGroup=function(e){return void 0!==this._viewpointOpts[e]&&(this._currentPlayingGroupID===e&&this._flytoControl.reset(),delete this._viewpointOpts[e],this._event.raiseEvent("GroupsChanged"),!0)},i.prototype.getGroupName=function(e){return void 0===this._viewpointOpts[e]?"":this._viewpointOpts[e].name},i.prototype.setGroupName=function(e,t){if(void 0===this._viewpointOpts[e])return"";this._viewpointOpts[e].name=t},i.prototype.getGroupOptions=function(e){if(void 0!==this._viewpointOpts[e]){return Freedo.clone(this._viewpointOpts[e],!0)}},i.prototype.removeAllGroups=function(){this._flytoControl.reset();for(var e in this._viewpointOpts)delete this._viewpointOpts[e];return this._currentPlayingGroupID=void 0,this._event.raiseEvent("GroupsChanged"),!0},i.prototype.getAllGroupIDs=function(){var e=[];for(var t in this._viewpointOpts)e.push(t);return e},i.prototype.appendViewpoint=function(e,t){if(void 0===this._viewpointOpts[e])return!1;var i=Freedo.clone(t,!0);return this._viewpointOpts[e].list.push(i),this._event.raiseEvent("GroupChanged",e),!0},i.prototype.insertViewpoint=function(e,t,i){if(void 0===this._viewpointOpts[e])return!1;var o=Freedo.clone(t,!0);return this._viewpointOpts[e].list.splice(i,0,o),this._event.raiseEvent("GroupChanged",e),!0},i.prototype.removeViewpoint=function(e,t){return void 0!==this._viewpointOpts[e]&&(void 0!==this._viewpointOpts[e].list[t]&&(this._viewpointOpts[e].list.splice(t,1),this._event.raiseEvent("GroupChanged",e),!0))},i.prototype.getViewpointsLength=function(e){if(void 0===this._viewpointOpts[e])throw new Error("getViewpointsLength error!");return this._viewpointOpts[e].list.length},i.prototype.setViewpoint=function(e,t,i){if(void 0===this._viewpointOpts[e])return!1;if(void 0===this._viewpointOpts[e].list[t])return!1;var o=Freedo.clone(i,!0);return this._viewpointOpts[e].list[t]=o,this._event.raiseEvent("ViewpointChanged",e),!0},i.prototype.getViewpoint=function(e,t){if(void 0===this._viewpointOpts[e])throw new Error("getViewpoint error");if(void 0===this._viewpointOpts[e].list[t])return new Error("getViewpoint error");var i=this._viewpointOpts[e].list[t];return Freedo.clone(i,!0)},i.prototype.flyto=function(e,t){if(void 0===this._viewpointOpts[e])return!1;if(void 0===this._viewpointOpts[e].list[t])return!1;var i=this._viewpointOpts[e].list[t];return void 0!==i.cameraInfo&&(this._project.getCamera().flytoByCameraInfo(i.cameraInfo),!0)},i.prototype.goto=function(e,t){if(void 0===this._viewpointOpts[e])return!1;if(void 0===this._viewpointOpts[e].list[t])return!1;var i=this._viewpointOpts[e].list[t];return void 0!==i.cameraInfo&&(this._project.getCamera().gotoByCameraInfo(i.cameraInfo),!0)},i.prototype.startOrResumeGroup=function(e,t){if(void 0===e){if(void 0===this._currentPlayingGroupID)throw new Error("FdViewpointsManager startOrResume should have argument!");e=this._currentPlayingGroupID}void 0!==this._currentPlayingGroupID?e!==this._currentPlayingGroupID?(this._flytoControl.stop(),this._flytoControl._setViewpoints(null),this._flytoControl._setViewpoints(this._viewpointOpts[e].list),this._currentPlayingGroupID=e,this._flytoControl.startOrResume()):this._flytoControl.startOrResume():(this._flytoControl._setViewpoints(this._viewpointOpts[e].list),this._currentPlayingGroupID=e,this._flytoControl.startOrResume())},i.prototype.pauseGroup=function(){this._flytoControl.pause()},i.prototype.stopGroup=function(){this._flytoControl.stop()},i.prototype.getGroupPlayingStatus=function(){return this._flytoControl.status},i.prototype.getGroupPlayingIndex=function(){return this._flytoControl.currentIndex},i.prototype.setGroupPlayingIndex=function(e){this._flytoControl.currentIndex=e},i.prototype.getGroupPlayingGroupID=function(){return this._currentPlayingGroupID},i.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},i.prototype.reset=function(){this.removeAllGroups(),this._flytoControl.reset()},i.prototype.dispose=function(){this.reset(),this._flytoControl.dispose(),this._eventHelper.removeAll()},i}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o,r;o=[],void 0!==(r=function(){"use strict";function e(){this.PeerConnection=window.PeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,this.URL=window.URL||window.webkitURL||window.msURL||window.oURL,this.nativeRTCIceCandidate=window.mozRTCIceCandidate||window.RTCIceCandidate,this.nativeRTCSessionDescription=window.mozRTCSessionDescription||window.RTCSessionDescription,this.iceServer={iceServers:[{url:"stun:stun.ideasip.com"},{url:"turn:182.92.7.32",username:"test",credential:"1234"}]},this.room="",this.socket=null,this.me=null,this.peerConnections={},this.connections=[],this.dataChannels={},this.events={}}return e.prototype.on=function(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)},e.prototype.emit=function(e,t){var i,o,r=this.events[e],n=Array.prototype.slice.call(arguments,1);if(r)for(i=0,o=r.length;i<o;i++)r[i].apply(null,n)},e.prototype.connect=function(e,t){var i,o=this;t=t||"",i=this.socket=new WebSocket(e),i.onopen=function(){i.send(JSON.stringify({eventName:"__join",data:{room:t}})),o.emit("socket_opened",i)},i.onmessage=function(e){var t=JSON.parse(e.data);t.eventName?o.emit(t.eventName,t.data):o.emit("socket_receive_message",i,t)},i.onerror=function(e){o.emit("socket_error",e,i)},i.onclose=function(e){o.peerConnections;for(var t in o.peerConnections)o.closePeerConnection(o.peerConnections[t]);o.peerConnections=[],o.dataChannels={},o.connections=[],o.emit("socket_closed",i)},this.on("_peers",function(e){o.connections=e.connections,o.me=e.you,o.emit("get_peers",o.connections),o.emit("connected",i)}),this.on("_ice_candidate",function(e){var t=new o.nativeRTCIceCandidate(e);o.peerConnections[e.socketId].addIceCandidate(t),o.emit("get_ice_candidate",t)}),this.on("_new_peer",function(e){console.log("--新增客户端--"),o.connections.push(e.socketId);var t=(o.createPeerConnection(e.socketId),0);for(var i in o.peerConnections)t++;o.emit("new_peer",t)}),this.on("_remove_peer",function(e){console.log("--客户端离开--");o.closePeerConnection(o.peerConnections[e.socketId]),delete o.peerConnections[e.socketId],delete o.dataChannels[e.socketId];var t=0;for(var i in o.peerConnections)t++;o.emit("remove_peer",t)}),this.on("_offer",function(e){o.receiveOffer(e.socketId,e.sdp),o.emit("get_offer",e)}),this.on("_answer",function(e){o.receiveAnswer(e.socketId,e.sdp),o.emit("get_answer",e)}),this.on("ready",function(){o.createPeerConnections(),o.addDataChannels(),o.sendOffers()})},e.prototype.sendOffers=function(){var e,t,i,o=this,r=function(e){console.log(e)};for(e=0,t=this.connections.length;e<t;e++)i=this.peerConnections[this.connections[e]],i.createOffer(function(e,t){return function(i){e.setLocalDescription(i),o.socket.send(JSON.stringify({eventName:"__offer",data:{sdp:i,socketId:t}}))}}(i,this.connections[e]),r)},e.prototype.receiveOffer=function(e,t){this.peerConnections[e];this.sendAnswer(e,t)},e.prototype.sendAnswer=function(e,t){var i=this.peerConnections[e],o=this;i.setRemoteDescription(new this.nativeRTCSessionDescription(t)),i.createAnswer(function(t){i.setLocalDescription(t),o.socket.send(JSON.stringify({eventName:"__answer",data:{socketId:e,sdp:t}}))},function(e){console.log(e)})},e.prototype.receiveAnswer=function(e,t){this.peerConnections[e].setRemoteDescription(new this.nativeRTCSessionDescription(t))},e.prototype.createPeerConnections=function(){var e,t;for(e=0,t=this.connections.length;e<t;e++)this.createPeerConnection(this.connections[e])},e.prototype.createPeerConnection=function(e){var t=this,i=new this.PeerConnection(this.iceServer);return this.peerConnections[e]=i,i.onicecandidate=function(o){o.candidate&&t.socket.send(JSON.stringify({eventName:"__ice_candidate",data:{label:o.candidate.sdpMLineIndex,candidate:o.candidate.candidate,socketId:e}})),t.emit("pc_get_ice_candidate",o.candidate,e,i)},i.onopen=function(){t.emit("pc_opened",e,i)},i.onerror=function(e){console.log(e)},i.oniceconnectionstatechange=function(e){var o=0;for(var r in t.peerConnections)o++;"connected"==i.iceConnectionState&&t.emit("pc_add_data_channel",o)},i.ondatachannel=function(i){t.addDataChannel(e,i.channel)},i},e.prototype.closePeerConnection=function(e){e&&e.close()},e.prototype.broadcast=function(e){var t;for(t in this.dataChannels)this.sendMessage(e,t)},e.prototype.sendMessage=function(e,t){"open"===this.dataChannels[t].readyState.toLowerCase()&&this.dataChannels[t].send(JSON.stringify({type:"__msg",data:e}))},e.prototype.addDataChannels=function(){var e;for(e in this.peerConnections)this.createDataChannel(e)},e.prototype.createDataChannel=function(e,t){var i,o;i=this.peerConnections[e],e||this.emit("data_channel_create_error",e,new Error("attempt to create data channel without socket id")),i instanceof this.PeerConnection||this.emit("data_channel_create_error",e,new Error("attempt to create data channel without peerConnection"));try{o=i.createDataChannel(t)}catch(t){this.emit("data_channel_create_error",e,t)}return this.addDataChannel(e,o)},e.prototype.addDataChannel=function(e,t){var i=this;return t.onopen=function(){i.emit("data_channel_opened",t,e)},t.onclose=function(o){delete i.dataChannels[e],i.emit("data_channel_closed",t,e)},t.onmessage=function(o){var r;r=JSON.parse(o.data),"__file"===r.type?i.parseFilePacket(r,e):i.emit("data_channel_message",t,e,r.data)},t.onerror=function(o){i.emit("data_channel_error",t,e,o)},this.dataChannels[e]=t,t},e.prototype.ready=function(){this.emit("ready")},e.prototype.exit=function(){this.socket.close()},e}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o,r;o=[i(20),i(0)],void 0!==(r=function(e,t){"use strict";function e(e){this._viewer=e.getViewer(),this._project=e,this._sceneMgr=e.getSceneManager(),this._bInTransform=!1,this._transType="MOVE",this._bInRun=!1,this._startPt=null,this._endPt=null,this._points2=null,this._xAxisPL=null,this._yAxisPL=null,this._zAxisPL=null,this._XYPlane=null,this._YZPlane=null,this._XZPlane=null,this._XYCircle=null,this._XZCircle=null,this._selectedAxis="",this._mouseDownPos=null,this._mouseDownXY=null,this._mouseDownStartXY=null,this._mouseDownEndXY=null,this._initSphere=null,this._useDepthPicking=!0,this._pickTranslucentDepth=!0,this._fixedAxis="",this._DISPERRAD=111e3,this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper,this._oldPt=null,this._started=!1,this._mouseDown=!1,this._lastDis=-1,this._alpha=.5,this._axisZoom=1,this.PositionType={NONE:0,ON_MODEL:1,ON_TERRAIN:2,ON_ELLIPSOID:3},this._t12=void 0,this._handler=void 0,this._xzOri=1,this._yzOri=1,this._oriObj={},this._m4=void 0}e.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},e.prototype.startClip=function(e){this._transType=e,this._bInTransform||(this._bInTransform=!0,this.addListeners(),this._bInRun=!0)},e.prototype.show=function(e){this._initSphere=FreeDo.clone(e,!0),this.calcAxisZoom(),this.clearAxis(),this.calcCallbackArgs(),this.showAxis()},e.prototype.updateMatrix4=function(e){this._m4=Freedo.clone(e,!0)},e.prototype.updateSceneSphere=function(e){this._initSphere=FreeDo.clone(e,!0)},e.prototype.addListeners=function(){this._handler=new Freedo.ScreenSpaceEventHandler(this._viewer.scene.canvas),this._handler.setInputAction(this.onLeftDown.bind(this),FreeDo.ScreenSpaceEventType.LEFT_DOWN),this._handler.setInputAction(this.onMouseMove.bind(this),FreeDo.ScreenSpaceEventType.MOUSE_MOVE),this._handler.setInputAction(this.onLeftUp.bind(this),FreeDo.ScreenSpaceEventType.LEFT_UP),this._handler.setInputAction(this.onWheel.bind(this),FreeDo.ScreenSpaceEventType.WHEEL);var e=this;this._project.getCamera().on(function(t,i){"Changed"==t&&e.onWheel()}),window.addEventListener("keydown",this.onKeyDown.bind(this))},e.prototype.calcFixedAxis=function(){if("X_AXIS"===this._selectedAxis)return void(this._fixedAxis="X");if("Y_AXIS"===this._selectedAxis)return void(this._fixedAxis="Y");if("Z_AXIS"===this._selectedAxis)return void(this._fixedAxis="Z");var e=2*this._initSphere.radius*.95*this._axisZoom,t=FreeDo.Cartographic.fromCartesian(this._initSphere.center);if(void 0!==t&&void 0!==this._mouseDownPos){if("XY"===this._selectedAxis){var i=FreeDo.clone(this._mouseDownPos,!0);i.longitude=t.longitude,i.height=t.height;var o=new Freedo.EllipsoidGeodesic(i,t).surfaceDistance;i=FreeDo.clone(this._mouseDownPos,!0),i.latitude=t.latitude,i.height=t.height;var r=new Freedo.EllipsoidGeodesic(i,t).surfaceDistance;o<r&&o/e<.2&&(this._fixedAxis="X"),o>r&&r/e<.2&&(this._fixedAxis="Y")}if("YZ"===this._selectedAxis){var i=FreeDo.clone(this._mouseDownPos,!0);i.height=t.height;var n=new Freedo.EllipsoidGeodesic(i,t).surfaceDistance;i=FreeDo.clone(this._mouseDownPos,!0);var r=Math.abs(i.height-t.height);r<n&&r/e<.2&&(this._fixedAxis="Y"),r>n&&n/e<.2&&(this._fixedAxis="Z")}if("XZ"===this._selectedAxis){var i=FreeDo.clone(this._mouseDownPos,!0);i.height=t.height;var n=new Freedo.EllipsoidGeodesic(i,t).surfaceDistance;i=FreeDo.clone(this._mouseDownPos,!0);var o=Math.abs(i.height-t.height);o<n&&o/e<.2&&(this._fixedAxis="X"),o>n&&n/e<.2&&(this._fixedAxis="Z")}}},e.prototype.calcAxisZoom=function(){if(!1===this._bInTransform)return void(this._axisZoom=1);var e=this._initSphere.center,t=this._project.getCamera()._camera.positionWC,i=1;i=Freedo.Cartesian3.distance(e,t)/6,this._project.getCamera()._camera.getPixelSize(this._initSphere,100,100),this._axisZoom=i,this._axisZoom>4e5&&(this._axisZoom=4e5),this._axisZoom<20&&(this._axisZoom=20)},e.prototype.onWheel=function(){!1!==this._bInTransform&&this.calcAxisZoom()},e.prototype.onKeyDown=function(){this._bInTransform},e.prototype.onMouseMove=function(e){if(this._bInTransform)return""!=this._selectedAxis?(this._event.raiseEvent("Transforming",{MouseDownStartXY:this._mouseDownStartXY,MouseDownEndXY:this._mouseDownEndXY,MouseDownXY:this._mouseDownXY,MouseMoveXY:e.endPosition,SelectedAxis:this._selectedAxis,Ori:this._oriObj}),this.regenPts(),void this.calcAxisZoom()):void 0},e.prototype.regenPts=function(){null===this._points2&&(this._points2=this._viewer.scene.primitives.add(new Freedo.PointPrimitiveCollection)),this._points2.length>0&&this._points2.removeAll();var e=Freedo.Cartesian3.fromDegreesArrayHeights([n,s,a,n,s,a+o]);void 0!==this._m4&&(e[0]=Freedo.Matrix4.multiplyByPoint(this._m4,e[0],new Freedo.Cartesian3),e[1]=Freedo.Matrix4.multiplyByPoint(this._m4,e[1],new Freedo.Cartesian3)),this._points2.add({position:e[0],pixelSize:10,show:!1,color:Freedo.Color.YELLOW}),this._points2.add({position:e[1],pixelSize:10,show:!1,color:Freedo.Color.YELLOW})},e.prototype.onLeftDown=function(e){if(this._bInTransform){this.regenPts(),this._mouseDown=!0,this._oldPt=null,this._started=!1,this._lastDis=-1;var t=this._viewer.scene.pick(e.position);if(!FreeDo.defined(t)||!FreeDo.defined(t.id)||!FreeDo.defined(t.id._name)){for(var i=this._viewer.scene.drillPick(e.position),o=0;o<i.length;o++)if(FreeDo.defined(i[o].id)&&FreeDo.defined(i[o].id._name)){t=i[o];break}if(!FreeDo.defined(t))return}if(FreeDo.defined(t.id)&&FreeDo.defined(t.id._name)){var r=t.id._name;if(("X_AXIS"===r||"Y_AXIS"===r||"Z_AXIS"===r)&&this._transType.indexOf("CLIP")>=0&&(t.id.polyline.material.color=new Freedo.Color(1,1,0,1)),"XY_CIRCLE"!==r&&"YZ_CIRCLE"!==r&&"XZ_CIRCLE"!==r||(t.id.polyline.material.color=new Freedo.Color(1,1,0,1)),"XY_CIRCLE"===r||"XZ_CIRCLE"===r||"YZ_CIRCLE"===r||"XY"===r||"XZ"===r||"YZ"===r||"X_AXIS"===r||"Y_AXIS"===r||"Z_AXIS"===r){this._selectedAxis=FreeDo.clone(r,!0),this._viewer.scene.screenSpaceCameraController.enableRotate=!1,this._viewer.scene.screenSpaceCameraController.enableLook=!1,this._mouseDownPos=null;var n=this._viewer.camera.getPickRay(e.position);this._oriObj.rayDirection=n.direction,this._event.raiseEvent("Transform",{})}}this._mouseDownXY=e.position;var s=this._points2.get(0),a=this._points2.get(1);this._mouseDownStartXY=s.computeScreenSpacePosition(this._viewer.scene,new Freedo.Cartesian2),this._mouseDownEndXY=a.computeScreenSpacePosition(this._viewer.scene,new Freedo.Cartesian2)}},e.prototype.backToEnableRotate=function(e){""===this._selectedAxis&&(this._viewer.scene.screenSpaceCameraController.enableRotate=!0,this._viewer.scene.screenSpaceCameraController.enableLook=!0)},e.prototype.onLeftUp=function(e){setTimeout(this.backToEnableRotate.bind(this),500),this._bInTransform&&(this._mouseDown=!1,"XY_CIRCLE"===this._selectedAxis&&(this._XYCircle.polyline.material.color=new Freedo.Color(0,0,1,this._alpha)),"XZ_CIRCLE"===this._selectedAxis&&(this._XZCircle.polyline.material.color=new Freedo.Color(0,1,0,this._alpha)),"YZ_CIRCLE"===this._selectedAxis&&(this._YZCircle.polyline.material.color=new Freedo.Color(1,0,0,this._alpha)),"X_AXIS"===this._selectedAxis&&(this._xAxisPL.polyline.material.color=FreeDo.Color.RED),"Y_AXIS"===this._selectedAxis&&(this._yAxisPL.polyline.material.color=FreeDo.Color.GREEN),"Z_AXIS"===this._selectedAxis&&(this._zAxisPL.polyline.material.color=FreeDo.Color.BLUE),""!==this._selectedAxis&&this._event.raiseEvent("Transformed",{}),this._selectedAxis="")},e.prototype.clearAxis=function(){null!=this._xAxisPL&&(this._viewer.entities.remove(this._xAxisPL),this._viewer.entities.remove(this._yAxisPL),this._viewer.entities.remove(this._zAxisPL),this._viewer.scene.primitives.remove(this._points2),this._points2=null,this._viewer.entities.remove(this._XZPlane),this._viewer.entities.remove(this._YZPlane),this._viewer.entities.remove(this._XYPlane),this._viewer.entities.remove(this._XYCircle),this._viewer.entities.remove(this._XZCircle),this._viewer.entities.remove(this._YZCircle)),this._selectedAxis=""};var i=null,o=null,r=null,n=null,s=null,a=null;return e.prototype.calcCallbackArgs=function(){i=this._initSphere.center,o=4*this._initSphere.radius,o>160&&(o=160),r=Freedo.Cartographic.fromCartesian(i),n=Freedo.Math.toDegrees(r.longitude),s=Freedo.Math.toDegrees(r.latitude),a=r.height,o=this._axisZoom},e.prototype.pickPositionOnEllipsoid=function(e){var t=Freedo.Cartographic.fromCartesian(this._initSphere.center),i=Freedo.clone(Freedo.Ellipsoid.WGS84,!0);i.radii.x+=t.height,i.radii.y+=t.height,i.radii.z+=t.height;var o=new Freedo.Ellipsoid(i.radii.x,i.radii.y,i.radii.z),r=this._viewer.camera.pickEllipsoid(e,o,new Freedo.Cartesian3);if(void 0!==r){return Freedo.Cartographic.fromCartesian(r)}},e.prototype.pickPositionOnPlane=function(e,t){this.calcCallbackArgs();var i=1e-5*this._axisZoom,n=Freedo.Cartesian3.fromRadians(r.longitude-i,r.latitude,-5e3),s=Freedo.Cartesian3.fromRadians(r.longitude,r.latitude,r.height+.95*o+1e3),a=Freedo.Cartesian3.fromRadians(r.longitude+i,r.latitude,-5e3);"YZ"===t&&(n=Freedo.Cartesian3.fromRadians(r.longitude,r.latitude-i,-5e3),s=Freedo.Cartesian3.fromRadians(r.longitude,r.latitude,r.height+.95*o+1e3),a=Freedo.Cartesian3.fromRadians(r.longitude,r.latitude+i,-5e3));var h=[n,s,a],l=this._viewer.camera.getPickRay(e),c=0,d=0,p=Freedo.Cartographic.fromCartesian(this._initSphere.center);c=Math.cos(p.longitude),d=Math.sin(p.longitude);var _=(new Freedo.Plane.fromPointNormal(new Freedo.Cartesian3(0,0,0),new Freedo.Cartesian3(c,d,0)),{});_.x=l.origin.x+1e6*l.direction.x,_.y=l.origin.y+1e6*l.direction.y,_.z=l.origin.z+1e6*l.direction.z;var u=Freedo.IntersectionTests.lineSegmentTriangle(l.origin,_,h[0],h[1],h[2]);if(void 0!==u){return Freedo.Cartographic.fromCartesian(u)}},e.prototype.callbackXYHalfCircle=function(e,i){this.calcCallbackArgs();for(var h=(this._DISPERRAD,[]),l=t.getLongAndLatRatio(r),c=FreeDo.Math.toDegrees(.9*o*l[0]),d=FreeDo.Math.toDegrees(.9*o*l[1]),p=0;p<=Math.PI/2;p+=.1){var _=n+c*Math.cos(p),u=s+d*Math.sin(p),v=Freedo.Cartesian3.fromDegrees(_,u,a);h.push(v)}return h},e.prototype.callbackXZHalfCircle=function(e,i){this.calcCallbackArgs();var h=t.getLongAndLatRatio(r),l=FreeDo.Math.toDegrees(.9*o*h[0]),c=(FreeDo.Math.toDegrees(.9*o*h[1]),[]),d=Math.PI/2+.3,p=Math.PI/2-.3;"XZ_CIRCLE"==this._selectedAxis&&(d=2*Math.PI,p=0);for(var _=d;_>=p;_-=.001){var u=n+l*Math.cos(_),v=s,f=a+.9*o*Math.sin(_),g=Freedo.Cartesian3.fromDegrees(u,v,f);c.push(g)}return i=c,this.reCalcPos(i),i},e.prototype.callbackYZHalfCircle=function(e,i){this.calcCallbackArgs();var h=t.getLongAndLatRatio(r),l=(FreeDo.Math.toDegrees(.9*o*h[0]),FreeDo.Math.toDegrees(.9*o*h[1])),c=[],d=Math.PI/2+.3,p=Math.PI/2-.3;"YZ_CIRCLE"==this._selectedAxis&&(d=2*Math.PI,p=0);for(var _=d;_>=p;_-=.001){var u=n,v=s+l*Math.cos(_),f=a+.9*o*Math.sin(_),g=Freedo.Cartesian3.fromDegrees(u,v,f);c.push(g)}return i=c,this.reCalcPos(i),i},e.prototype.callbackXYCCBPMin=function(e,t){return this.calcCallbackArgs(),this._mouseDown&&"XY_CIRCLE"==this._selectedAxis?.75*o:.5*o*2},e.prototype.callbackXY=function(e,i){this.calcCallbackArgs();var h=t.getLongAndLatRatio(r),l=FreeDo.Math.toDegrees(1.2*o*h[0]),c=FreeDo.Math.toDegrees(1.2*o*h[1]);return i=Freedo.Cartesian3.fromDegreesArrayHeights([n+l,s+c,a,n-l,s+c,a,n-l,s-c,a,n+l,s-c,a,n+l,s+c,a]),this.reCalcPos(i),i},e.prototype.callbackXYShow=function(e,t){return this.calcCallbackArgs(),t=!0,"XY_CIRCLE"==this._selectedAxis&&(t=!1),t},e.prototype.callbackXYH=function(e,t){return a+.1},e.prototype.callbackXZ=function(e,i){this.calcCallbackArgs();var h=t.getLongAndLatRatio(r),l=FreeDo.Math.toDegrees(1*o*h[0]);FreeDo.Math.toDegrees(1*o*h[1]);return Freedo.Cartesian3.fromDegreesArrayHeights([n+l,s,a-o,n+l,s,a+o,n-l,s,a+o,n-l,s,a-o,n+l,s,a-o])},e.prototype.callbackXZMinimumHeights=function(e,t){return this.calcCallbackArgs(),[a,a]},e.prototype.callbackXZMaximumHeights=function(e,t){return this.calcCallbackArgs(),[a+.5*o,a+.5*o]},e.prototype.callbackYZ=function(e,i){this.calcCallbackArgs();var h=t.getLongAndLatRatio(r),l=(FreeDo.Math.toDegrees(1*o*h[0]),FreeDo.Math.toDegrees(1*o*h[1]));return Freedo.Cartesian3.fromDegreesArrayHeights([n,s+l,a-o,n,s+l,a+o,n,s-l,a+o,n,s-l,a-o,n,s+l,a-o])},e.prototype.callbackXYCCBP=function(e,t){return this.calcCallbackArgs(),Freedo.Cartesian3.fromDegrees(n,s)},e.prototype.callbackX=function(e,i){this.calcCallbackArgs();var h=t.getLongAndLatRatio(r),l=FreeDo.Math.toDegrees(o*h[0]);return i=Freedo.Cartesian3.fromDegreesArrayHeights([n,s,a,n+l,s,a]),void 0!==this._m4&&(i[0]=Freedo.Matrix4.multiplyByPoint(this._m4,i[0],new Freedo.Cartesian3),i[1]=Freedo.Matrix4.multiplyByPoint(this._m4,i[1],new Freedo.Cartesian3)),this._oriObj.xAxis=i,i},e.prototype.callbackY=function(e,t){return this.calcCallbackArgs(),t=Freedo.Cartesian3.fromDegreesArrayHeights([n,s,a,n,s+o/this._DISPERRAD,a]),void 0!==this._m4&&(t[0]=Freedo.Matrix4.multiplyByPoint(this._m4,t[0],new Freedo.Cartesian3),t[1]=Freedo.Matrix4.multiplyByPoint(this._m4,t[1],new Freedo.Cartesian3)),this._oriObj.yAxis=t,t},e.prototype.callbackZ=function(e,t){return this.calcCallbackArgs(),t=Freedo.Cartesian3.fromDegreesArrayHeights([n,s,a-.2*o,n,s,a+o]),void 0!==this._m4&&(t[0]=Freedo.Matrix4.multiplyByPoint(this._m4,t[0],new Freedo.Cartesian3),t[1]=Freedo.Matrix4.multiplyByPoint(this._m4,t[1],new Freedo.Cartesian3)),t},e.prototype.callbackStart=function(e,t){return this.calcCallbackArgs(),t=Freedo.Cartesian3.fromDegreesArrayHeights([n,s,a]),void 0!==this._m4&&(t[0]=Freedo.Matrix4.multiplyByPoint(this._m4,t[0],new Freedo.Cartesian3)),t},e.prototype.callbackH=function(e,t){return this.calcCallbackArgs(),a},e.prototype.reCalcPos=function(e){if(void 0!==this._m4)for(var t in e)e[t]=Freedo.Matrix4.multiplyByPoint(this._m4,e[t],new Freedo.Cartesian3)},e.prototype.showAxis=function(){var e=new Freedo.CallbackProperty(this.callbackXY.bind(this),!1),t=new Freedo.CallbackProperty(this.callbackXYHalfCircle.bind(this),!1),i=new Freedo.CallbackProperty(this.callbackXZHalfCircle.bind(this),!1),o=new Freedo.CallbackProperty(this.callbackYZHalfCircle.bind(this),!1),r=new Freedo.CallbackProperty(this.callbackXYCCBPMin.bind(this),!1),n=(new Freedo.CallbackProperty(this.callbackXYShow.bind(this),!1),new Freedo.CallbackProperty(this.callbackXYH.bind(this),!1),new Freedo.CallbackProperty(this.callbackXZ.bind(this),!1)),s=(new Freedo.CallbackProperty(this.callbackXZMaximumHeights.bind(this),!1),new Freedo.CallbackProperty(this.callbackXZMinimumHeights.bind(this),!1),new Freedo.CallbackProperty(this.callbackYZ.bind(this),!1)),a=new Freedo.CallbackProperty(this.callbackXYCCBP.bind(this),!1),h=new Freedo.CallbackProperty(this.callbackX.bind(this),!1),l=new Freedo.CallbackProperty(this.callbackY.bind(this),!1),c=new Freedo.CallbackProperty(this.callbackZ.bind(this),!1),d=new Freedo.CallbackProperty(this.callbackH.bind(this),!1);new Freedo.CallbackProperty(this.callbackStart.bind(this),!1);this._xAxisPL=this._viewer.entities.add({name:"X_AXIS",polyline:{positions:h,width:0,show:"CLIPXY"==this._transType,followSurface:!1,material:new Freedo.PolylineArrowMaterialProperty(Freedo.Color.RED)}}),this._yAxisPL=this._viewer.entities.add({name:"Y_AXIS",polyline:{positions:l,width:0,show:"CLIPXY"==this._transType,followSurface:!1,material:new Freedo.PolylineArrowMaterialProperty(Freedo.Color.GREEN)}}),this._zAxisPL=this._viewer.entities.add({name:"Z_AXIS",polyline:{positions:c,width:8,show:"CLIPXY"==this._transType,followSurface:!1,material:new Freedo.PolylineArrowMaterialProperty(Freedo.Color.BLUE)}}),this._transType.indexOf("CLIP")>=0&&(this._YZPlane=this._viewer.entities.add({name:"YZ",polyline:{positions:s,width:2,show:"CLIPYZ"==this._transType,followSurface:!1,material:new Freedo.Color(1,0,0,this._alpha)}})),this._transType.indexOf("CLIP")>=0&&(this._XYPlane=this._viewer.entities.add({name:"XY_RECT",polyline:{positions:e,width:.8,show:"CLIPXY"==this._transType,followSurface:!1,material:new Freedo.Color(0,0,1,this._alpha)}})),this._transType.indexOf("CLIP")>=0&&(this._XZPlane=this._viewer.entities.add({name:"XZ",polyline:{positions:n,width:2,show:"CLIPXZ"==this._transType,followSurface:!1,material:new Freedo.Color(0,1,0,this._alpha)}})),this._XYCircle=this._viewer.entities.add({name:"XY_NONE_CIRCLE",position:a,ellipse:{semiMinorAxis:r,semiMajorAxis:r,height:d,show:!1,material:new Freedo.Color(1,1,0,.2)}}),(this._transType.indexOf("ROTATE")>=0||this._transType.indexOf("SCALE")>=0)&&(this._XYCircle=this._viewer.entities.add({name:"XY_CIRCLE",polyline:{positions:t,width:4,show:!0,material:new Freedo.Color(0,0,1,this._alpha)}})),this._transType.indexOf("CLIPXY")>=0&&(this._XZCircle=this._viewer.entities.add({name:"XZ_CIRCLE",polyline:{positions:i,width:4,show:!0,material:new Freedo.Color(0,1,0,this._alpha)}}),this._YZCircle=this._viewer.entities.add({name:"YZ_CIRCLE",polyline:{positions:o,width:4,show:!0,material:new Freedo.Color(1,0,0,this._alpha)}})),this.regenPts()},e.prototype.reset=function(){this._handler=this._handler&&this._handler.destroy(),this._bInTransform=!1,this.clearAxis(),this._mouseDownPos=null,this._initSphere=null,this._fixedAxis=""},e.prototype.dispose=function(){this.reset()},e}.apply(t,o))&&(e.exports=r)},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}i.d(t,"a",function(){return r});var r=function e(){o(this,e)},n=function(e){var t=[];for(var i in e)t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.push(("v="+Math.random()).replace(".","")),t.join("&")},s=function(e){e=e||{},e.type=(e.type||"GET").toUpperCase(),e.dataType=e.dataType||"json",e.async=e.async;var t=n(e.data);if(window.XMLHttpRequest)var i=new XMLHttpRequest;else var i=new ActiveXObject("Microsoft.XMLHTTP");i.onreadystatechange=function(){if(4===i.readyState){var t=i.status;t>=200&&t<300?e.success&&e.success(i.responseText,i.responseXML):e.fail&&e.fail(t)}},"GET"===e.type?(i.open("GET",e.url+"?"+t,e.async),i.send(null)):"POST"===e.type&&(i.open("POST",e.url,e.async),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),void 0!==e.token&&i.setRequestHeader("Authorization",e.token),i.send(t))};r.fd_ajax=s},function(e,t,i){var o,r;o=[i(14),i(0)],void 0!==(r=function(e,t){"use strict";function i(){}function o(){}return i.prototype.geocode=function(e){var t="format=json&q="+e,i="//nominatim.openstreetmap.org/search?"+t;return Freedo.loadJson(i).then(function(e){var t;return e.map(function(e){return t=e.boundingbox,{displayName:e.display_name,destination:Freedo.Rectangle.fromDegrees(t[2],t[0],t[3],t[1])}})})},window.mobilecheck=function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},o.defaultViewerOptions={imageryProvider:Freedo.createTileMapServiceImageryProvider({url:Freedo.buildModuleUrl("Assets/Textures/NaturalEarthII")}),baseLayerPicker:!1,geocoder:!1,timeline:!1,animation:!1,vrButton:!1,navigationHelpButton:!1,sceneModePicker:!1,fullscreenButton:!1,homeButton:!1,selectionIndicator:!1,infoBox:!1,contextOptions:{webgl:{antialias:!mobilecheck()}}},Freedo.Camera.DEFAULT_VIEW_RECTANGLE=Freedo.Rectangle.fromDegrees(80,5,135,55),Freedo.BingMapsApi.defaultKey="AsosOjY68GIcKsRMisb8KcmGD266hYjtDHD5-EC-YTJUHi1Cxj1K3zWhLcp-SPNZ",o.createProject=function(i,r,n){void 0===r&&(r={}),void 0===n&&(n={});var s=Freedo.defaultValue(n.defaultImageryLayer,!0),a=Freedo.defaultValue(n.defaultSkyBox,!0),h=Freedo.defaultValue(n.provinceBoundaries,!1);_.assign(r,o.defaultViewerOptions);var l=new Freedo.Viewer(i,r);if(l._cesiumWidget._creditContainer.style.display="none",h){var c=new Freedo.GeoJsonDataSource;c.load("//ftp.gbim360.com/ccm/171124_china_quhua/china.topojson",{stroke:Freedo.Color.YELLOW,fill:new Freedo.Color(0,0,0,0),strokeWidth:5,markerSymbol:"?"}).then(function(e){var t=e._entityCollection,i=t.values;t.suspendEvents();for(var o=0;o<i.length;o++){i[o].polygon.distanceDisplayCondition=new Freedo.DistanceDisplayCondition(5,2e8)}t.resumeEvents()}),l.dataSources.add(c)}if(l.scene.globe.depthTestAgainstTerrain=!0,l.scene.pickTranslucentDepth=!0,l.scene.moon.show=!1,l.scene.sun.show=!1,l.extend(Freedo.viewerFreedoPModelInspectorMixin),l.cesium3DTilesInspector.setVisibility(!1),l._cesiumWidget._supportsImageRenderingPixelated=Freedo.FeatureDetection.supportsImageRenderingPixelated(),l._cesiumWidget._forceResize=!0,Freedo.FeatureDetection.supportsImageRenderingPixelated()){for(var d=window.devicePixelRatio;d>=2;)d/=2;l.resolutionScale=d}var p=new e(l);if(l.scene.screenSpaceCameraController.enableCollisionDetection=!1,s){p.getImageryLayersManager().addDefaultImageryLayer()}var u=t.getFreedoXPath();if(a){var l=p.getViewer();l.scene.skyboxOnGround=new Freedo.SkyBox({sources:{positiveX:u+"../Viewer/images/skybox/rightav9.jpg",negativeX:u+"../Viewer/images/skybox/leftav9.jpg",positiveY:u+"../Viewer/images/skybox/frontav9.jpg",negativeY:u+"../Viewer/images/skybox/backav9.jpg",positiveZ:u+"../Viewer/images/skybox/topav9.jpg",negativeZ:u+"../Viewer/images/skybox/bottomav9.jpg"}})}return l.canvas.addEventListener("keydown",function(e){187===(e.keyCode?e.keyCode:e.which)&&("hidden"===l.cesium3DTilesInspector._container.style.visibility?l.cesium3DTilesInspector.setVisibility(!0):l.cesium3DTilesInspector.setVisibility(!1))}),p},o.destroyProject=function(e){e.dispose()},o}.apply(t,o))&&(e.exports=r)},function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e){for(var t=[],i=[],o=e.documentElement,r=o.getElementsByTagName("Layer"),n=o.getElementsByTagName("TileMatrixSet"),s=0;s<n.length;s++){var a=n[s],h={},l=a.getElementsByTagName("Matrix");h.id=a.getElementsByTagNameNS("http://www.opengis.net/ows/1.1","Identifier")[0].childNodes[0].textContent,h.uid=a.getElementsByTagName("uid")[0].childNodes[0].textContent,h.PModels=[];for(var c=0;c<l.length;c++){var d={},p=l[c].getElementsByTagName("Metadata");if(p[0]){d.id=l[c].getElementsByTagName("Identifier")[0].childNodes[0].textContent,d.name=l[c].getElementsByTagName("Title")[0].childNodes[0].textContent,d.Identifier=d.id,d.position=p[0].getElementsByTagName("Position")[0].childNodes[0].textContent.split(","),d.position=d.position.map(function(e){return parseFloat(e)});var _=d.position[0];d.position[0]=d.position[1],d.position[1]=_,l[c].getElementsByTagName("Uid")[0]&&l[c].getElementsByTagName("Uid")[0].childNodes[0]?(d.uid=l[c].getElementsByTagName("Uid")[0].childNodes[0].textContent,h.PModels.push(d)):(d.uid="",h.PModels.push(d))}}i.push(h)}for(var s=0;s<r.length;s++)for(var u=r[s].getElementsByTagName("TileMatrixSetLink")[0].getElementsByTagName("PModelTileSet")[0].childNodes[0].textContent,c=0;c<i.length;c++)if(i[c].id==u){var h={};h.uid=i[c].uid,h.PModels=i[c].PModels,h.LayerName=r[s].getElementsByTagNameNS("http://www.opengis.net/ows/1.1","Title")[0].childNodes[0].textContent,h.LayerIdentifier=r[s].getElementsByTagNameNS("http://www.opengis.net/ows/1.1","Identifier")[0].childNodes[0].textContent,h.TileMatrixSetIdentifier=i[c].id,h.templateStr=r[s].getElementsByTagName("ResourceURL")[0].getAttribute("template").split("uid")[0],t.push(h);break}return t}Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"FdPModelDataManager",function(){return l});var n=i(4),s=(i(5),i(13)),a=i(21),h=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),l=function(){function e(t){o(this,e),this._pModelsetCollection={},this._model=t,this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper}return h(e,[{key:"on",value:function(e,t){return this._eventHelper.add(this._event,e,t)}},{key:"addPModelSet",value:function(e,t){void 0===t&&(t=Freedo.createGuid());var i=new s.FdPModelSet(e);return this._pModelsetCollection[t]=i,this._event.raiseEvent("PModelSetAdded",i,t),t}},{key:"deletePModelSet",value:function(e){var t=this._pModelsetCollection[e];delete this._pModelsetCollection[e],this._event.raiseEvent("PModelSetDeleted",t,e)}},{key:"getPModelSetIDs",value:function(){return Object.keys(this._pModelsetCollection)}},{key:"getPModelSet",value:function(e){return this._pModelsetCollection[e]}},{key:"getPModelSetID",value:function(e){for(var t in this._pModelsetCollection)if(this._pModelsetCollection[t]===e)return t}},{key:"getBoundingSphere",value:function(e,t,i){do{var o=this.getPModelSet(e);if(!o)break;new n.FdPMComponent(o,t).getBoundingSphere(i)}while(!1)}}]),e}(),c=a.a.fd_ajax;l.getPMTSinfo=function(e){var t="//dev.gbim360.com/resource/pmts/metadata",i="",o={},n=void 0;return"string"==typeof e?(t=e,n="GET"):(i=e.token,o.url=e.url,o.layername=e.name,n="POST"),new Promise(function(e,s){c({async:!0,url:t,type:n,token:i,data:o,dataType:"xml",success:function(t,i){try{var o=r(i);e(o)}catch(e){s(e)}},fail:function(e){s(e)}})})}},function(e,t,i){var o,r;o=[i(7),i(8),i(22),i(3),i(10),i(11),i(0),i(14),i(15),i(16),i(18),i(12),i(19),i(17),i(1),i(4),i(5),i(13),i(23),i(9)],void 0!==(r=function(e,t,i,o,r,n,s,a,h,l,c,d,p,_,u,v,f,g,y,m){"use strict";var C="undefined"!=typeof window?window:"undefined"!=typeof self?self:{};C.Freedo=C.Freedo;var F=C.Freedo;return F.FdAnalysisLineDistance=e,F.FdAnalysisManager=t,F.FdApp=i,F.FdCamera=o,F.FdFlytoController=r,F.FdImageryLayersManager=n,F.FdMisc=s,F.FdProject=a,F.FdRemoteCollaboration=h,F.FdSceneManager=l,F.FdViewpointsManager=c,F.FdLabelPointsManager=d,F.FdWebRTC=p,F.FdPathAnimator=u,F.FdDrawRoad=m,F.FdPMComponent=v.FdPMComponent,F.FdPModel=f.FdPModel,F.FdPModelSet=g.FdPModelSet,F.FdPModelDataManager=y.FdPModelDataManager,F}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o;void 0!==(o=function(){"use strict";function e(e){this._viewer=e.getViewer(),this._camera=e.getCamera(),this._project=e,this._sceneMgr=e.getSceneManager(),this._tempBall=null,this._spSize=0,this._oldType="",this._projectMoni=void 0,this._event=new FreeDo.Event,this._eventHelper=new FreeDo.EventHelper}return e.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},e.prototype.checkModelExist=function(){for(var e in this._sceneMgr._pModelMap)return!0;return!1},e.prototype.getMode=function(){return this._oldType},e.prototype.start=function(e){var t=this;if(void 0===this._projectMoni&&(this._projectMoni=this._project.on(function(e,i){"projectClosed"==e&&t.cancel()})),this._camera.cancelFlight(),this._viewer.scene.noSphereMode=!0,"MODEL_VIEW"===e){this._viewer.scene.skyAtmosphere.show=!1,this._viewer.scene.fog.enabled=!1,this._viewer.scene.globe.show=!1;for(var i=0;i<this._viewer.dataSources.length;i++){var o=this._viewer.dataSources.get(i);o.show=!1}setTimeout(this.gotoModel.bind(this),500)}if("COLUMBUS_VIEW"===e){this._viewer.scene.mode=Freedo.SceneMode.COLUMBUS_VIEW,"MODEL_VIEW"==this._oldType&&(this._viewer.terrainProvider=new Freedo.EllipsoidTerrainProvider);for(var i=0;i<this._viewer.dataSources.length;i++){var o=this._viewer.dataSources.get(i);o.show=!0}this._viewer.scene.globe.show=!0,setTimeout(this.gotoModel.bind(this),2800)}if("2D"===e){null==this._tempBall&&(this._viewer.entities.remove(this._tempBall),this._tempBall=null),this._viewer.scene.morphTo2D(.02),this._viewer.terrainProvider=new Freedo.EllipsoidTerrainProvider;for(var i=0;i<this._viewer.dataSources.length;i++){var o=this._viewer.dataSources.get(i);o.show=!0}this._viewer.trackedEntity=void 0}"NORMAL_VIEW"===e&&this.cancel(),this._oldType=e,this._event.raiseEvent("Start",{mode:this._oldType})},e.prototype.gotoModel=function(){return},e.prototype.morphTo3D=function(){this._viewer.scene.mode=Freedo.SceneMode.SCENE3D},e.prototype.cancel=function(){this.checkModelExist(),this._oldType,this._viewer.scene.globe.show=!0,this._viewer.scene.skyAtmosphere.show=!0,this._viewer.scene.fog.enabled=!0,this._viewer.scene.noSphereMode=!1,setTimeout(this.morphTo3D.bind(this),500);for(var e=0;e<this._viewer.dataSources.length;e++){this._viewer.dataSources.get(e).show=!0}null!=this._tempBall&&(this._viewer.entities.remove(this._tempBall),this._tempBall=null),setTimeout(this.gotoModel.bind(this),3500),this._event.raiseEvent("Cancel",{mode:this._oldType}),this._oldType="NORMAL_VIEW"},e.prototype.reset=function(){this.cancel()},e.prototype.dispose=function(){this.reset()},e}.call(t,i,t,e))&&(e.exports=o)},function(e,t,i){var o,r;o=[i(0)],void 0!==(r=function(e){"use strict";function t(e){this._project=e,this._viewer=this._project.getViewer(),this._tempPoint=void 0,this._bInSurvey=!1,this._event=new FreeDo.Event,this._eventHelper=new FreeDo.EventHelper,this._tmpPoint=void 0}return t.prototype.pickPosition=function(t){var i=e.pickPositionG(this._viewer,t);if(i){var o=e.tc(i);this._tmpPoint&&this._viewer.entities.remove(this._tmpPoint),this._tmpPoint=this._viewer.entities.add({position:o,point:{color:Freedo.Color.YELLOW,pixelSize:5,disableDepthTestDistance:Number.POSITIVE_INFINITY,show:!0}})}this._event.raiseEvent("Point",{point:i})},t.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},t.prototype.handleLeftClick=function(e){0!=this._bInSurvey&&this.pickPosition(e.position)},t.prototype.run=function(e){this._hanlder=new Freedo.ScreenSpaceEventHandler(this._project.getViewer().scene.canvas),this._hanlder.setInputAction(this.handleLeftClick.bind(this),Freedo.ScreenSpaceEventType.LEFT_CLICK),this._bInSurvey=!0},t.prototype.reset=function(){this._bInSurvey=!1,this._tmpPoint&&this._viewer.entities.remove(this._tmpPoint),this._hanlder.removeInputAction(Freedo.ScreenSpaceEventType.LEFT_CLICK)},t}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o,r;o=[i(0)],void 0!==(r=function(e){"use strict";function t(e){this._viewer=e.getViewer(),this._camera=e.getCamera(),this._divID=e.getViewer()._container.id,this._bActive=!1,this._bRun=!1,this._lowSpeed=1/30,this._speed=5/3,this._highspeed=3.3,this._currentSpeed=0,this._kb=e.getKeyboard(),this._kbCallback=void 0,this.addKBLsnr(),this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper}return t.prototype.enable=function(){this._bActive=!0,this._event.raiseEvent("StatusChanged",this._bActive)},t.prototype.disable=function(){this._bActive=!1,this._event.raiseEvent("StatusChanged",this._bActive)},t.prototype.getStatus=function(){return this._bActive},t.prototype.setLowVelocity=function(e){this._lowSpeed=e/30},t.prototype.setMediumVelocity=function(e){this._speed=e/30},t.prototype.getCurrentVelocity=function(){return 30*this._currentSpeed},t.prototype.setHighVelocity=function(e){this._highSpeed=e/30},t.prototype.addKBLsnr=function(){var e=this;this._kbCallback=this._kb.on(function(t,i){"timer"===t&&e.onKeyboard(i.metaData)}),this._kb.enable()},t.prototype.onKeyboard=function(e){if(this._bActive){var t=this;for(var i in e){var o=t._speed;e[16]&&(o=t._lowSpeed),Math.abs(o-this._currentSpeed)>1e-4&&(this._currentSpeed=o,this._event.raiseEvent("SpeedChanged",30*this._currentSpeed)),87==i&&e[i]&&t._camera.moveForward(this._currentSpeed),65==i&&e[i]&&t._camera.moveLeft(this._currentSpeed),83==i&&e[i]&&t._camera.moveBackward(this._currentSpeed),68==i&&e[i]&&t._camera.moveRight(this._currentSpeed),38==i&&e[i]&&t._camera.lookUp(1),37==i&&e[i]&&t._camera.lookLeft(1),40==i&&e[i]&&t._camera.lookDown(1),39==i&&e[i]&&t._camera.lookRight(1)}}},t.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},t.prototype.reset=function(){this._bActive=!1},t.prototype.dispose=function(){this.reset()},t}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o;void 0!==(o=function(){function e(e){this._viewer=e,this._camera=e.camera;var i=document.createElement("canvas");i.width=t,i.height=t,this._smallCanvas=i,this._smallCanvasContext2D=this._smallCanvas.getContext("2d")}var t=128;return e.prototype._captureScene=function(){var e,i,o,r,n=this._viewer,s=n.scene._canvas,a=s.width,h=s.height;return a>=h?(e=.5*(a-h),i=0,o=r=h):(e=0,i=.5*(h-a),o=r=a),this._smallCanvasContext2D.drawImage(s,e,i,o,r,0,0,t,t),this._smallCanvas.toDataURL("image/jpeg")},e.prototype.capture=function(e){var t=this,i=this._viewer.scene._postRender.addEventListener(function(){var o=t._captureScene();e(o),i()},null)},e}.call(t,i,t,e))&&(e.exports=o)},function(e,t,i){var o,r;o=[i(20),i(0)],void 0!==(r=function(e,t){function i(t){this._project=t,this._viewer=t.getViewer(),this._sceneMgr=t.getSceneManager(),this._viewer.scene.context.uniformState.clipPlane=new Freedo.Cartesian4,this._viewer.scene.context.uniformState.clipPlaneEnable=!1,this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper,this._aSceneObjectId=[],this._mani=new e(t),this._selectedAxis="",this._transType="CLIP",this._mouseDown12Arg={},this._axisZoom=1,this._t12={TMoveX:0,TMoveY:0,TMoveZ:0,THeading:0,TPitch:0,TRoll:0,TPitchTotal:0,TRollTotal:0,TScaleX:1,TScaleY:1,TScaleZ:1,TBaseX:0,TBaseY:0,TBaseZ:0},this._q4=new Freedo.Quaternion(0,0,0,1),this._lsner=void 0}return i.prototype.setSceneObjectIDs=function(e){this._aSceneObjectId=FreeDo.clone(e,!0)},i.prototype.calcSceneBS=function(){var e=[];for(var t in this._aSceneObjectId){var i=this._sceneMgr._pModelMap[this._aSceneObjectId[t]];if(void 0===i)return;e.push(i.boundingSphere)}this._sceneSphere=FreeDo.BoundingSphere.fromBoundingSpheres(e,new FreeDo.BoundingSphere)},i.prototype.getType=function(){return this._transType},i.prototype.start=function(e){this.startClip(e)},i.prototype.startClip=function(e){if(0!=this._aSceneObjectId.length){this._transType=e,this._bInClip=!0,this.enableClipPlane(!0),this.calcSceneBS();var t=this;this._lsner&&(this._lsner(),this._lsner=void 0,this._q4=new Freedo.Quaternion(0,0,0,1)),this._lsner=this._mani.on(function(e,i){"Transform"==e&&t.onTransform(),"Transformed"==e&&t.onTransformed(),"Transforming"==e&&t.onTransforming(i)}),this._mani.startClip("CLIPXY"),"CLIPXY"!=e&&"CLIPXYNEG"!=e||(this._selectedAxis="Z_AXIS"),"CLIPYZ"==e&&(this._selectedAxis="Z_AXIS"),"CLIPXZ"==e&&(this._selectedAxis="Z_AXIS"),this.reset12Args(),"CLIPYZ"==e&&(this._t12.TPitch=90),"CLIPXZ"==e&&(this._t12.TRoll=90),"CLIPXYNEG"==e&&(this._t12.TPitch=180),this.onTransform();var i=Freedo.clone(this._mouseDown12Arg,!0);if(i.TMoveX=0,i.TMoveY=0,i.TMoveZ=0,this.updatePlane(i),"CLIPYZ"==e||"CLIPXZ"==e||"CLIPXYNEG"==e){var o=Freedo.Cartographic.fromCartesian(this._sceneSphere.center),r=o.longitude,n=o.latitude,s=o.height;"CLIPXYNEG"!=e&&"CLIPYZ"!=e||(this._selectedAxis="XZ_CIRCLE"),"CLIPXZ"==e&&(this._selectedAxis="YZ_CIRCLE");var a=new Freedo.Matrix3,h=new Freedo.Quaternion,l=new Freedo.Matrix4;this.getMatrix(this._q4,this._t12.TMoveX,this._t12.TMoveY,this._t12.TMoveZ,this._t12.THeading,this._t12.TPitch,this._t12.TRoll,r,n,s,a,h,l);Freedo.Quaternion.multiply(this._q4,h,this._q4)}"CLIPYZ"==e&&(this._t12.TPitch=0,this._t12.TPitchTotal=90),"CLIPXZ"==e&&(this._t12.TRoll=0,this._t12.TRollTotal=90),"CLIPXYNEG"==e&&(this._t12.TPitch=0,this._t12.TPitchTotal=180),this._mani.show(this._sceneSphere),this._event.raiseEvent("Start",{})}},i.prototype.getMatrix=function(e,i,o,r,n,s,a,h,l,c,d,p,_){var u=Freedo.Cartesian3.fromRadians(h,l,c),v=Freedo.Cartesian3.fromRadians(h+i,l+o,c+r),f=Freedo.clone(e,!0);n=Freedo.Math.toRadians(n),s=Freedo.Math.toRadians(s),a=Freedo.Math.toRadians(a);var g,y,m;if("XZ_CIRCLE"==this._selectedAxis){var C=Freedo.Quaternion.fromAxisAngle(new FreeDo.Cartesian3(1,0,0),a,new Freedo.Quaternion);g=Freedo.Matrix4.fromTranslationQuaternionRotationScale(new Freedo.Cartesian3,C,new Freedo.Cartesian3(1,1,1));var F=Freedo.Matrix4.getRotation(g,new Freedo.Matrix3),w=Freedo.Matrix3.multiplyByVector(F,new FreeDo.Cartesian3(0,-1,0),new Freedo.Cartesian3);w=new FreeDo.Cartesian3(0,-1,0),m=Freedo.Quaternion.fromAxisAngle(w,s,new Freedo.Quaternion)}else{var C=Freedo.Quaternion.fromAxisAngle(new FreeDo.Cartesian3(0,-1,0),s,new Freedo.Quaternion);g=Freedo.Matrix4.fromTranslationQuaternionRotationScale(new Freedo.Cartesian3,C,new Freedo.Cartesian3(1,1,1));var F=Freedo.Matrix4.getRotation(g,new Freedo.Matrix3),w=Freedo.Matrix3.multiplyByVector(F,new FreeDo.Cartesian3(1,0,0),new Freedo.Cartesian3);w=new FreeDo.Cartesian3(1,0,0),m=Freedo.Quaternion.fromAxisAngle(w,a,new Freedo.Quaternion)}Freedo.Quaternion.multiply(f,m,f);for(key in m)p[key]=m[key];y=Freedo.Matrix4.fromTranslationQuaternionRotationScale(new Freedo.Cartesian3(0,0,0),f,new Freedo.Cartesian3(1,1,1));var b=Freedo.Cartographic.fromCartesian(this._sceneSphere.center),P=t.getLongAndLatRatio(b);tMatrix4Out=Freedo.Matrix4.fromTranslationQuaternionRotationScale(new Freedo.Cartesian3(i/P[0],o/P[1],r),f,new Freedo.Cartesian3(1,1,1));for(key in tMatrix4Out)_[key]=tMatrix4Out[key];var T=Freedo.Transforms.eastNorthUpToFixedFrame(u),M=Freedo.Matrix4.inverse(T,new Freedo.Matrix4),S=Freedo.Transforms.eastNorthUpToFixedFrame(v),D=Freedo.Matrix4.multiply(g,M,new Freedo.Matrix4),x=Freedo.Matrix4.multiply(y,D,new Freedo.Matrix4),E=Freedo.Matrix4.multiply(S,x,new Freedo.Matrix4),I=Freedo.Matrix4.getRotation(E,new Freedo.Matrix3);for(key in I)d[key]=I[key];return E},i.prototype.calcAxisZoom=function(){if(!1===this._bInClip)return void(this._axisZoom=1);var e=this._sceneSphere.center,t=this._project.getCamera()._camera.positionWC,i=1;i=Freedo.Cartesian3.distance(e,t)/6,this._project.getCamera()._camera.getPixelSize(this._sceneSphere,100,100),this._axisZoom=i,this._axisZoom>4e5&&(this._axisZoom=4e5),this._axisZoom<20&&(this._axisZoom=20)},i.prototype.onTransforming=function(e){var i=e.SelectedAxis;this._selectedAxis=i;var o=[0,0,0],r=0,n=0;this.calcAxisZoom();var s=Freedo.clone(this._mouseDown12Arg,!0),a=t.calcAngle(e.MouseDownStartXY,e.MouseDownXY,e.MouseDownStartXY,e.MouseMoveXY);if("Z_AXIS"===i){var h=Math.sqrt(Math.pow(e.MouseDownXY.y-e.MouseMoveXY.y,2)+Math.pow(e.MouseDownXY.x-e.MouseMoveXY.x,2))*this._axisZoom/200;if(0==h)return;var l=[e.MouseDownEndXY.x-e.MouseDownStartXY.x,e.MouseDownEndXY.y-e.MouseDownStartXY.y],c=[e.MouseMoveXY.x-e.MouseDownXY.x,e.MouseMoveXY.y-e.MouseDownXY.y],d=(l[0]*c[0]+l[1]*c[1])/(Math.sqrt(Math.pow(l[0],2)+Math.pow(l[1],2))*Math.sqrt(Math.pow(c[0],2)+Math.pow(c[1],2))),p=Math.acos(d),_=Freedo.Cartographic.fromCartesian(this._sceneSphere.center),u=FreeDo.Cartesian3.fromRadians(_.longitude,_.latitude,_.height+1),v=FreeDo.Cartesian3.subtract(u,this._sceneSphere.center,new FreeDo.Cartesian3),f=new Freedo.Matrix3,g=new Freedo.Quaternion,y=new Freedo.Matrix4;this.getMatrix(this._q4,this._t12.TMoveX,this._t12.TMoveY,this._t12.TMoveZ,this._t12.THeading,this._t12.TPitch,this._t12.TRoll,_.longitude,_.latitude,_.height,f,g,y);var m=Freedo.Matrix3.multiplyByVector(f,v,new Freedo.Cartesian3),C=Freedo.Transforms.eastNorthUpToFixedFrame(this._sceneSphere.center),F=Freedo.Matrix4.inverse(C,new Freedo.Matrix4);f=Freedo.Matrix4.getRotation(F,new Freedo.Matrix3);var w=Freedo.Matrix3.multiplyByVector(f,m,new Freedo.Cartesian3),b=t.getLongAndLatRatio(_);o[0]=b[1]*h*w.x*Math.cos(p),o[1]=b[0]*h*w.y*Math.cos(p),o[2]=h*w.z*Math.cos(p)}if("XZ_CIRCLE"===i){var P=FreeDo.Cartesian3.subtract(e.Ori.yAxis[1],e.Ori.yAxis[0],new FreeDo.Cartesian3),T=Freedo.Math.toDegrees(FreeDo.Cartesian3.angleBetween(P,e.Ori.rayDirection));r=T>90?a:-1*a}if("YZ_CIRCLE"===i){var M=FreeDo.Cartesian3.subtract(e.Ori.xAxis[1],e.Ori.xAxis[0],new FreeDo.Cartesian3),T=Freedo.Math.toDegrees(FreeDo.Cartesian3.angleBetween(M,e.Ori.rayDirection));n=T>90?-1*a:a}var S={TMoveX:o[0],TMoveY:o[1],TMoveZ:o[2],THeading:0,TPitch:r,TRoll:n,TScaleX:1,TScaleY:1,TScaleZ:1};s.TMoveX+=S.TMoveX,s.TMoveY+=S.TMoveY,s.TMoveZ+=S.TMoveZ,s.THeading=S.THeading,s.TRoll=S.TRoll,s.TPitch=S.TPitch,s.TScaleX*=S.TScaleX,s.TScaleY*=S.TScaleY,s.TScaleZ*=S.TScaleZ,this._t12.TMoveX=s.TMoveX,this._t12.TMoveY=s.TMoveY,this._t12.TMoveZ=s.TMoveZ,this._t12.THeading=s.THeading,this._t12.TPitch=s.TPitch,this._t12.TRoll=s.TRoll,this._t12.TScaleX=s.TScaleX,this._t12.TScaleY=s.TScaleY,this._t12.TScaleZ=s.TScaleZ,this.refineArgs(),this._event.raiseEvent("Cliping",FreeDo.clone(this._t12,!0)),this.updatePlane(this._t12)},i.prototype.getNewPlane=function(e){var t=Freedo.Transforms.eastNorthUpToFixedFrame(this._sceneSphere.center),i=new Freedo.Plane(new Freedo.Cartesian3(0,0,1),0),o=Freedo.Transforms.eastNorthUpToFixedFrame(this._sceneSphere.center),r=Freedo.Math.toRadians,n=new Freedo.HeadingPitchRoll(0,r(e.TPitch+e.TPitchTotal),r(e.TRoll+e.TRollTotal)),s=Freedo.Quaternion.fromHeadingPitchRoll(n),a=Freedo.Matrix4.fromTranslationQuaternionRotationScale(new Freedo.Cartesian3(e.TMoveX,e.TMoveY,e.TMoveZ),s,new Freedo.Cartesian3(1,1,1));Freedo.Matrix4.multiply(o,a,o);var h=new Freedo.Matrix4;return Freedo.Matrix4.inverse(t,h),Freedo.Matrix4.multiply(h,o,o),Freedo.Plane.transform(i,o,i),i},i.prototype.updatePlane=function(e){var t,i,o,r=Freedo.Cartographic.fromCartesian(this._sceneSphere.center);t=r.longitude,i=r.latitude,o=r.height,this._mani.updateSceneSphere(this._sceneSphere);var n=void 0,s=void 0,a=new Freedo.Matrix3,h=new Freedo.Matrix4,l=new Freedo.Quaternion,c=new Freedo.Matrix4;if("Z_AXIS"===this._selectedAxis||"XZ_CIRCLE"===this._selectedAxis||"YZ_CIRCLE"===this._selectedAxis){var d=this._viewer.scene.globe.ellipsoid.cartesianToCartographic(this._sceneSphere.center);d.height-=1;var p=this._viewer.scene.globe.ellipsoid.cartographicToCartesian(d),_=FreeDo.Cartesian3.subtract(p,this._sceneSphere.center,new FreeDo.Cartesian3);h=this.getMatrix(this._q4,e.TMoveX,e.TMoveY,e.TMoveZ,e.THeading,e.TPitch,e.TRoll,t,i,o,a,l,c);var u=Freedo.Matrix3.multiplyByVector(a,_,new Freedo.Cartesian3);if(isNaN(u.x))return void console.log("出现异常v2");n=Freedo.Cartesian3.normalize(u,new Freedo.Cartesian3)}if("X_AXIS"===this._selectedAxis){var d=this._viewer.scene.globe.ellipsoid.cartesianToCartographic(this._sceneSphere.center);d.longitude+=.001*Math.cos(Freedo.Math.toRadians(e.TPitch)),d.height+=.001*Math.sin(Freedo.Math.toRadians(e.TPitch));var p=this._viewer.scene.globe.ellipsoid.cartographicToCartesian(d),_=FreeDo.Cartesian3.subtract(p,this._sceneSphere.center,new FreeDo.Cartesian3);n=Freedo.Cartesian3.normalize(_,new Freedo.Cartesian3)}if("Y_AXIS"===this._selectedAxis){var d=this._viewer.scene.globe.ellipsoid.cartesianToCartographic(this._sceneSphere.center);d.latitude+=.001;var p=this._viewer.scene.globe.ellipsoid.cartographicToCartesian(d),_=FreeDo.Cartesian3.subtract(p,this._sceneSphere.center,new FreeDo.Cartesian3);n=Freedo.Cartesian3.normalize(_,new Freedo.Cartesian3)}if(void 0!==n){var v=Freedo.Matrix4.multiplyByPoint(h,this._sceneSphere.center,new Freedo.Cartesian3);s=Freedo.Plane.fromPointNormal(v,n),s=this.getNewPlane(e);var f=[s];for(var g in this._aSceneObjectId){this._sceneMgr._pModelMap[this._aSceneObjectId[g]].clippingPlanes=new Freedo.ClippingPlaneCollection({planes:f,edgeWidth:1,useGltfModelMatrix:!0})}}this._mani.updateMatrix4(h)},i.prototype.refineArgs=function(){for(var e in this._aSceneObjectId){var i=this._sceneMgr._pModelMap[this._aSceneObjectId[e]],o=FreeDo.Matrix4.getScale(i.modelMatrix,new FreeDo.Cartesian3);this._t12.THeading>360&&(this._t12.THeading-=360),this._t12.THeading<-360&&(this._t12.THeading+=360),this._t12.TPitchTotal>360&&(this._t12.TPitchTotal-=360),this._t12.TPitchTotal<-360&&(this._t12.TPitchTotal+=360),this._t12.TPitchTotal>180&&(this._t12.TPitchTotal=this._t12.TPitchTotal-360),this._t12.TPitchTotal<-180&&(this._t12.TPitchTotal=this._t12.TPitchTotal+360),this._t12.TRollTotal>360&&(this._t12.TRollTotal-=360),this._t12.TRollTotal<-360&&(this._t12.TRollTotal+=360),this._t12.TRollTotal>180&&(this._t12.TRollTotal=this._t12.TRollTotal-360),this._t12.TRollTotal<-180&&(this._t12.TRollTotal=this._t12.TRollTotal+360),this._t12.TMoveX=t.round(this._t12.TMoveX,8),this._t12.TMoveY=t.round(this._t12.TMoveY,8),this._t12.TMoveZ=t.round(this._t12.TMoveZ,6),this._t12.THeading=t.round(this._t12.THeading,4),this._t12.TPitch=t.round(this._t12.TPitch,4),this._t12.TRoll=t.round(this._t12.TRoll,4),this._t12.TScaleX=t.round(o.x,4),this._t12.TScaleY=t.round(o.y,4),this._t12.TScaleZ=t.round(o.z,4)}},i.prototype.reset12Args=function(){var e=void 0;for(var t in this._aSceneObjectId){var i=this._sceneMgr._pModelMap[this._aSceneObjectId[t]];if(Freedo.defined(i)){var o=Freedo.clone(i._root.transform,!0),r=FreeDo.Matrix4.getTranslation(o,new FreeDo.Cartesian3);e=Freedo.Cartographic.fromCartesian(r);break}}void 0!==e&&(this._t12.TMoveX=0,this._t12.TMoveY=0,this._t12.TMoveZ=0,this._t12.THeading=0,this._t12.TPitch=0,this._t12.TRoll=0,this._t12.TPitchTotal=0,this._t12.TRollTotal=0,this._t12.TScaleX=1,this._t12.TScaleY=1,this._t12.TScaleZ=1,this.refineArgs())},i.prototype.onTransform=function(e){this._event.raiseEvent("Clip",{}),this.refineArgs(),this._mouseDown12Arg=Freedo.clone(this._t12,!0)},i.prototype.onTransformed=function(e){var t=Freedo.Cartographic.fromCartesian(this._sceneSphere.center),i=t.longitude,o=t.latitude,r=t.height,n=new Freedo.Matrix3,s=new Freedo.Quaternion,a=new Freedo.Matrix4;this.getMatrix(this._q4,this._t12.TMoveX,this._t12.TMoveY,this._t12.TMoveZ,this._t12.THeading,this._t12.TPitch,this._t12.TRoll,i,o,r,n,s,a);Freedo.Quaternion.multiply(this._q4,s,this._q4),this._t12.TPitchTotal+=this._t12.TPitch,this._t12.TRollTotal+=this._t12.TRoll,this.refineArgs(),this._event.raiseEvent("Cliped",FreeDo.clone(this._t12,!0))},i.prototype.setClipPlane=function(e){for(var t in this._aSceneObjectId){this._sceneMgr._pModelMap[this._aSceneObjectId[t]]}},i.prototype.getClipPlane=function(e){return this._viewer.scene.context.uniformState.clipPlane},i.prototype.enableClipPlane=function(e){this._viewer.scene.context.uniformState.clipPlaneEnable=e},i.prototype.isClipPlaneEnabled=function(e){return this._viewer.scene.context.uniformState.clipPlaneEnable},i.prototype.backToOriginPlane=function(){this.reset12Args(),this.calcSceneBS(),this._bInClip&&this._mani.show(this._sceneSphere),this._event.raiseEvent("ClipReset",FreeDo.clone(this._t12,!0))},i.prototype.cancelClip=function(){this.reset(),this._event.raiseEvent("Cancel",{})},i.prototype.cancel=function(){this.cancelClip()},i.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},i.prototype.reset=function(){this._viewer.scene.context.uniformState.clipPlane=new Freedo.Cartesian4,this._viewer.scene.context.uniformState.clipPlaneEnable=!1,this._bInClip=!1,this._sceneSphere=null,this.backToOriginPlane(),this._mani.reset(),this._lsner&&this._lsner(),this._lsner=void 0,this._q4=new Freedo.Quaternion(0,0,0,1),this._aSceneObjectId=[]},i.prototype.dispose=function(){this.reset()},i}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o,r,n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};o=[i(0),i(2),i(6)],void 0!==(r=function(e,t,i){"use strict";function o(e){e._options.roads={},this._viewer=e.getViewer(),this._scene=this._viewer.scene,this._roadsOpts=e._options.roads,this._project=e,this._ple=new t(e),this._ple.setAutoLoop(!1),this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper,this._currentGroupID=void 0;this._roadGeos={}}Object.defineProperties(o.prototype,{}),o.prototype.createGroup=function(e,t,i){return void 0===t&&(t=Freedo.createGuid()),this._roadsOpts[t]={name:e,show:!0,height:3,width:5,smooth:5,level:1,list:[]},i&&(this._roadsOpts[t]=i),this._event.raiseEvent("GroupsChanged"),t},o.prototype.removeGroup=function(e){return void 0!==this._roadsOpts[e]&&(this._currentGroupID===e&&(this._currentGroupID=void 0),this._roadGeos[e]&&this._roadGeos[e].primitive&&(this._viewer.scene.primitives.remove(this._roadGeos[e].primitive),delete this._roadGeos[e]),delete this._roadsOpts[e],this._event.raiseEvent("GroupsChanged"),!0)},o.prototype.getGroupName=function(e){return void 0===this._roadsOpts[e]?"":this._roadsOpts[e].name},o.prototype.setGroupName=function(e,t){if(void 0===this._roadsOpts[e])return"";this._roadsOpts[e].name=t},o.prototype.getRoadSmooth=function(e){return void 0===this._roadsOpts[e]?-1:void 0===n(this._roadsOpts[e].smooth)?5:this._roadsOpts[e].smooth},o.prototype.getRoadShow=function(e){return void 0===this._roadsOpts[e]?-1:void 0===n(this._roadsOpts[e].show)||this._roadsOpts[e].show},o.prototype.getRoadLevel=function(e){return void 0===this._roadsOpts[e]?-1:void 0===n(this._roadsOpts[e].level)||this._roadsOpts[e].level},o.prototype.getAllGroupIDs=function(){var e=[];for(var t in this._roadsOpts)e.push(t);return e},o.prototype.preAppendRoadPoint=function(){var t=this._roadsOpts[this._currentGroupID].list;if(t&&t.length>=1){var i=t[t.length-1];this._ple.setStartPt(e.tc(i.position))}this._ple.run(),this._lsner&&(this._lsner(),this._lsner=void 0);var o=this;this._lsner=this._ple.on(function(e,t){"PointAdded"==e&&o.appendRoadPoint(o._currentGroupID,t),"PLAdd"==e&&(o._ple.cancel(),o._event.raiseEvent("PLAddEnd",t),o.reDrawRoad())})},o.prototype.endAppendRoadPoint=function(){this._ple.cancel(),this._lsner&&(this._lsner(),this._lsner=void 0)},o.prototype.appendRoadPoint=function(e,t){if(void 0===this._roadsOpts[e])return!1;var i=Freedo.clone(t,!0);return this._roadsOpts[e].list.push(i),this._event.raiseEvent("GroupChanged",e),!0},o.prototype.insertRoadPoint=function(e,t,i){if(void 0===this._roadsOpts[e])return!1;var o=Freedo.clone(t,!0);return this._roadsOpts[e].list.splice(i,0,o),this._event.raiseEvent("GroupChanged",e),!0},o.prototype.removeRoadPoint=function(e,t){return void 0!==this._roadsOpts[e]&&(void 0!==this._roadsOpts[e].list[t]&&(this._roadsOpts[e].list.splice(t,1),this._event.raiseEvent("GroupChanged",e),this.reDrawRoad(e),!0))},o.prototype.getRoadsLength=function(e){if(void 0===this._roadsOpts[e])throw new Error("getRoadsLength error!");return this._roadsOpts[e].list.length},o.prototype.setRoadPoint=function(e,t,i){if(void 0===this._roadsOpts[e])return!1;if(void 0===this._roadsOpts[e].list[t])return!1;var o=Freedo.clone(i,!0);return this._roadsOpts[e].list[t]=o,this._event.raiseEvent("RoadChanged",e),!0},o.prototype.getRoadPoint=function(e,t){if(void 0===this._roadsOpts[e])throw new Error("getRoadPoint error");if(void 0===this._roadsOpts[e].list[t])return new Error("getRoadPoint error");var i=this._roadsOpts[e].list[t];return Freedo.clone(i,!0)},o.prototype.flyto=function(t,i){if(void 0===this._roadsOpts[t])return!1;if(void 0===this._roadsOpts[t].list[i])return!1;var o=this._roadsOpts[t].list[i],r=new Freedo.BoundingSphere(e.tc(o.position),50);return this._project.getCamera().flyToBoundingSphere(r),!0},o.prototype.setCurrentGroupID=function(e){this._currentGroupID=e},o.prototype.TransfPointToCartesian3=function(e){for(var t=[],i=0;i<e.length;i++)t[i]=FreeDo.Cartesian3.fromDegrees(e[i].lon,e[i].lat,e[i].height);return t};var r=new FreeDo.Cartesian3;return o.prototype.TransfCartesian3ToSelf=function(e){for(var t=[],i=0;i<e.length;i++)t[i]=new Freedo.Cartesian3(e[i].x-r.x,e[i].y-r.y,e[i].z-r.z);return t},o.prototype.getPointArray=function(e,t,i){var o=new FreeDo.Cartesian3,r=new FreeDo.Cartesian3,n=new FreeDo.Cartesian3,s=new FreeDo.Cartesian3,a=new FreeDo.Cartesian3,h=new FreeDo.Cartesian3,l=new FreeDo.Cartesian3,c=(new FreeDo.Cartesian3,new FreeDo.Cartesian3),d=new FreeDo.Cartesian3,p=null,_=null,u=[];switch(t.length){case 0:case 1:break;case 2:FreeDo.Cartesian3.subtract(t[1],t[0],o),FreeDo.Cartesian3.cross(e[0],o,n),FreeDo.Cartesian3.cross(o,e[0],s),FreeDo.Cartesian3.normalize(n,a),FreeDo.Cartesian3.normalize(s,h),a.x=a.x*i,a.y=a.y*i,a.z=a.z*i,h.x=h.x*i,h.y=h.y*i,h.z=h.z*i,FreeDo.Cartesian3.add(t[0],a,c),FreeDo.Cartesian3.add(t[0],h,d),u.push(new FreeDo.Cartesian3(c.x,c.y,c.z)),u.push(new FreeDo.Cartesian3(d.x,d.y,d.z)),FreeDo.Cartesian3.add(t[1],a,c),FreeDo.Cartesian3.add(t[1],h,d),u.push(new FreeDo.Cartesian3(c.x,c.y,c.z)),u.push(new FreeDo.Cartesian3(d.x,d.y,d.z));break;default:for(var v=1;v<t.length-1;v++)FreeDo.Cartesian3.subtract(t[v],t[v-1],o),FreeDo.Cartesian3.subtract(t[v+1],t[v],r),0==FreeDo.Cartesian3.angleBetween(o,r)&&t.splice(v--,1);for(var f=0;f<t.length;f++)0==f?(FreeDo.Cartesian3.subtract(t[f+1],t[f],o),FreeDo.Cartesian3.cross(e[f],o,n),FreeDo.Cartesian3.cross(o,e[f],s),FreeDo.Cartesian3.normalize(n,a),FreeDo.Cartesian3.normalize(s,h),a.x=a.x*i,a.y=a.y*i,a.z=a.z*i,h.x=h.x*i,h.y=h.y*i,h.z=h.z*i,FreeDo.Cartesian3.add(t[f],a,c),FreeDo.Cartesian3.add(t[f],h,d),u.push(new FreeDo.Cartesian3(c.x,c.y,c.z)),u.push(new FreeDo.Cartesian3(d.x,d.y,d.z))):f==t.length-1?(FreeDo.Cartesian3.subtract(t[f],t[f-1],o),FreeDo.Cartesian3.cross(e[f],o,n),FreeDo.Cartesian3.cross(o,e[f],s),FreeDo.Cartesian3.normalize(n,a),FreeDo.Cartesian3.normalize(s,h),a.x=a.x*i,a.y=a.y*i,a.z=a.z*i,h.x=h.x*i,h.y=h.y*i,h.z=h.z*i,FreeDo.Cartesian3.add(t[f],a,c),FreeDo.Cartesian3.add(t[f],h,d),u.push(new FreeDo.Cartesian3(c.x,c.y,c.z)),u.push(new FreeDo.Cartesian3(d.x,d.y,d.z))):(FreeDo.Cartesian3.subtract(t[f-1],t[f],o),FreeDo.Cartesian3.subtract(t[f+1],t[f],r),_=FreeDo.Cartesian3.angleBetween(o,r)/2,p=i/Math.sin(_),FreeDo.Cartesian3.subtract(t[f+1],t[f],o),FreeDo.Cartesian3.subtract(t[f],t[f-1],r),FreeDo.Cartesian3.normalize(o,o),FreeDo.Cartesian3.normalize(r,r),FreeDo.Cartesian3.add(o,r,l),FreeDo.Cartesian3.cross(e[f],l,n),FreeDo.Cartesian3.normalize(n,a),a.x=a.x*p,a.y=a.y*p,a.z=a.z*p,FreeDo.Cartesian3.add(t[f],a,c),FreeDo.Cartesian3.cross(l,e[f],s),FreeDo.Cartesian3.normalize(s,h),h.x=h.x*p,h.y=h.y*p,h.z=h.z*p,FreeDo.Cartesian3.add(t[f],h,d),u.push(new FreeDo.Cartesian3(c.x,c.y,c.z)),u.push(new FreeDo.Cartesian3(d.x,d.y,d.z)))}return u},o.prototype.getRoadUrlByLevel=function(t){return"1"==t?e.getFreedoXPath()+"static/img/road/road1.jpg":"2"==t?e.getFreedoXPath()+"static/img/road/road2.jpg":"3"==t?e.getFreedoXPath()+"static/img/road/road3.jpg":null},o.prototype.calcCP=function(e,t,i){var o,r,n;o=e.position,r=t.position,n=i.position;var s=FreeDo.Cartesian3.subtract(o,r,new FreeDo.Cartesian3),a=FreeDo.Cartesian3.subtract(n,r,new FreeDo.Cartesian3),h=FreeDo.Cartesian3.cross(s,a,new FreeDo.Cartesian3),l=FreeDo.Cartesian3.normalize(s,new FreeDo.Cartesian3),c=FreeDo.Cartesian3.normalize(a,new FreeDo.Cartesian3),d=FreeDo.Cartesian3.add(l,c,new FreeDo.Cartesian3),p=Freedo.Quaternion.fromAxisAngle(h,Freedo.Math.PI_OVER_TWO,new Freedo.Quaternion),_=Freedo.Quaternion.fromAxisAngle(h,-1*Freedo.Math.PI_OVER_TWO,new Freedo.Quaternion),u=Freedo.Matrix3.fromQuaternion(p,new Freedo.Matrix3),v=Freedo.Matrix3.fromQuaternion(_,new Freedo.Matrix3),f=Freedo.Matrix3.multiplyByVector(u,d,new Freedo.Cartesian3),g=Freedo.Matrix3.multiplyByVector(v,d,new Freedo.Cartesian3),y=FreeDo.Cartesian3.normalize(f,new FreeDo.Cartesian3),m=FreeDo.Cartesian3.normalize(g,new FreeDo.Cartesian3),C=FreeDo.Cartesian3.distance(o,r),F=FreeDo.Cartesian3.distance(n,r),w=1;w=C<F?C/4:F/4,y=FreeDo.Cartesian3.multiplyByScalar(y,w,new FreeDo.Cartesian3),m=FreeDo.Cartesian3.multiplyByScalar(m,w,new FreeDo.Cartesian3);var b=FreeDo.Cartesian3.add(r,y,new FreeDo.Cartesian3),P=FreeDo.Cartesian3.add(r,m,new FreeDo.Cartesian3);return FreeDo.Cartesian3.distance(o,b)<FreeDo.Cartesian3.distance(o,P)?[b,P]:[P,b]},o.prototype.smoothPolyline=function(e,t){var o=[];if(e.length<3)for(var r=0;r<e.length;r++)o.push(e[r].position);else for(var r=0;r<=e.length-2;r++){var n={},s={},a={},h={};0==r?(n=e[0],s.position=this.calcCP(e[0],e[1],e[2])[0],a=e[0],h=e[1]):r==e.length-2?(n.position=this.calcCP(e[r-1],e[r],e[r+1])[1],s=e[r+1],a=e[r],h=e[r+1]):(n.position=this.calcCP(e[r-1],e[r],e[r+1])[1],s.position=this.calcCP(e[r],e[r+1],e[r+2])[0],a=e[r],h=e[r+1]);var l=new i(a,h,n,s),c=l.getVertexForCurve(t);o=o.concat(c)}for(var d=[],r=0;r<o.length;r++){var p={};if(p=o[r],d.length>0){FreeDo.Cartesian3.distance(d[d.length-1],p)>1e-4&&d.push(p)}else d.push(p)}return d},o.prototype.drawRoad=function(e,t,i,o){for(var n=this.TransfPointToCartesian3(e),s=[],a=0;a<n.length;a++)s[a]={position:n[a]};n=this.smoothPolyline(s,o),r.x=n[0].x,r.y=n[0].y,r.z=n[0].z;for(var h=this.TransfCartesian3ToSelf(n),l=this.getPointArray(n,h,t),c=l,d=[],p=0;p<e.length;p++)d[p]={lon:e[p].lon,lat:e[p].lat,height:e[p].height-3};var _=t+4,u=this.TransfPointToCartesian3(d);s=[];for(var v=0;v<u.length;v++)s[v]={position:u[v]};u=this.smoothPolyline(s,o);for(var f=this.TransfCartesian3ToSelf(u),g=this.getPointArray(u,f,_),y=g,m=[],C=0;C<y.length;C++)C%2==0?(m.push(y[C].x),m.push(y[C].y),m.push(y[C].z),m.push(c[C].x),m.push(c[C].y),m.push(c[C].z)):(m.push(c[C].x),m.push(c[C].y),m.push(c[C].z),m.push(y[C].x),m.push(y[C].y),m.push(y[C].z));var F=new Float64Array(m),w=[],b=null,P=null,T=null,M=0;w.push(M,0),w.push(M,.1),w.push(M,.9),w.push(M,.99);for(var S=l.length/2-1,D=2*t+2*Math.sqrt(25),x=0;x<S;x++)b=FreeDo.Cartesian3.distance(c[2*x+2],c[2*x])/D,P=FreeDo.Cartesian3.distance(c[2*x+3],c[2*x+1])/D,T=(b+P)/2,M+=T,w.push(M,0),w.push(M,.1),w.push(M,.9),w.push(M,.99);for(var E=new Float32Array(w),I=[],A=4*(l.length/2-2)+2,L=0;L<=A;L++)(L-3)%4!=0&&(I.push(L+0),I.push(L+4),I.push(L+5),I.push(L+5),I.push(L+1),I.push(L+0));for(var O=new Uint16Array(I),k=[],R=0;R<n.length;R++)k.push(n[R].x),k.push(n[R].y),k.push(n[R].z);var X=FreeDo.BoundingSphere.fromVertices(k),Y=new FreeDo.Geometry({attributes:{position:new FreeDo.GeometryAttribute({componentDatatype:FreeDo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:F}),st:new FreeDo.GeometryAttribute({componentDatatype:FreeDo.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:E})},indices:O,primitiveType:FreeDo.PrimitiveType.TRIANGLES,boundingSphere:FreeDo.BoundingSphere.fromVertices(F)}),Z=new FreeDo.GeometryInstance({geometry:Y,modelMatrix:new FreeDo.Matrix4(1,0,0,r.x,0,1,0,r.y,0,0,1,r.z,0,0,0,1),attributes:{color:FreeDo.ColorGeometryInstanceAttribute.fromColor(FreeDo.Color.RED)},id:"trangle"});return{primitive:this._viewer.scene.primitives.add(new FreeDo.Primitive({geometryInstances:Z,appearance:new FreeDo.MaterialAppearance({material:new FreeDo.Material({fabric:{type:"Image",uniforms:{image:i}}})})})),boundingsphere:X}},o.prototype.loadAllRoad=function(){for(var e in this._roadsOpts)this.reDrawRoad(e)},o.prototype.reDrawRoad=function(e){e||(e=this._currentGroupID);var t=this._roadsOpts[e];if(void 0===t)throw new Error("reDrawRoad error");if(void 0===t.list)return new Error("reDrawRoad error");this._roadGeos[e]&&this._roadGeos[e].primitive&&this._viewer.scene.primitives.remove(this._roadGeos[e].primitive);for(var i=this.getRoadUrlByLevel(t.level),o=[],r=t.list,n=(Freedo.Math.toDegrees,0);n<r.length;n++){var s=r[n].position;o.push({lon:s[0],lat:s[1],height:s[2]+this.getRoadHeight(e)})}t.show&&t.list.length>=2&&(this._roadGeos[e]=this.drawRoad(o,t.width,i,t.smooth))},o.prototype.setRoadShow=function(e,t){if(void 0===this._roadsOpts[e])throw new Error("setRoadSmooth error");this._roadsOpts[e].show=t,this.reDrawRoad()},o.prototype.setRoadSmooth=function(e,t){if(void 0===this._roadsOpts[e])throw new Error("setRoadSmooth error");this._roadsOpts[e].smooth=t,this.reDrawRoad()},o.prototype.setRoadLevel=function(e,t){if(void 0===this._roadsOpts[e])throw new Error("setRoadSmooth error");this._roadsOpts[e].level=t,this.reDrawRoad()},o.prototype.setRoadWidth=function(e,t){if(void 0===this._roadsOpts[e])throw new Error("setRoadSmooth error");this._roadsOpts[e].width=t,this.reDrawRoad()},o.prototype.getRoadWidth=function(e){if(void 0===this._roadsOpts[e])throw new Error("getRoadWidth error");return void 0===n(this._roadsOpts[e].width)?15:this._roadsOpts[e].width},o.prototype.getRoadHeight=function(e){if(void 0===this._roadsOpts[e])throw new Error("getRoadHeight error");return void 0===n(this._roadsOpts[e].height)?5:this._roadsOpts[e].height},o.prototype.setRoadHeight=function(e,t){if(void 0===this._roadsOpts[e])throw new Error("setRoadHeight error");this._roadsOpts[e].height=t,this.reDrawRoad()},o.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},o.prototype.removeAllGroups=function(){for(var e in this._roadsOpts)this.removeGroup(e);for(var t in this._roadGeos)this._roadGeos[t].primitive&&this._viewer.scene.primitives.remove(this._roadGeos[t].primitive);return this._roadGeos={},!0},o.prototype.reset=function(){this.removeAllGroups(),this._pa.reset()},o.prototype.dispose=function(){this.reset(),this._eventHelper.removeAll()},o}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o,r;o=[i(2)],void 0!==(r=function(e){"use strict";function t(t){this._project=t,this._viewer=t.getViewer(),this._scene=this._viewer.scene,this._polylines={},this._egs=[],this._lsner=void 0,this._ple=new e(t),this.oldV=void 0,this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper}return t.prototype.start=function(){this.oldV=this._scene.globe.depthTestAgainstTerrain,this._ple.run(),this._lsner&&(this._lsner(),this._lsner=void 0);var e=this;this._lsner=this._ple.on(function(t,i){"PLAdd"==t&&e.onPLAdd(i)}),this._event.raiseEvent("Start",{})},t.prototype.onPLAdd=function(e){if(e.polyline){if(2==e.polyline.pts.length)return void this._ple.delResult();var t=new Freedo.GroundErasePrimitive({geometryInstances:new Freedo.GeometryInstance({geometry:new Freedo.PolygonGeometry({polygonHierarchy:new Freedo.PolygonHierarchy(e.polyline.pts)}),attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(new Freedo.Color(157/255,226/255,53/255,1))}}),classificationType:Freedo.ClassificationType.TERRAIN,debugShowShadowVolume:!1}),i=this._scene.groundPrimitives.add(t);this._egs.push(i)}},t.prototype.cancel=function(){this._ple.cancel(),this._polylines={};for(var e in this._egs)this._scene.groundPrimitives.remove(this._egs[e]);this._event.raiseEvent("Cancel",{})},t.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},t.prototype.reset=function(){this._lsner&&this._lsner(),this._lsner=void 0},t.prototype.dispose=function(){},t}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o,r;o=[i(0)],void 0!==(r=function(e){"use strict";function t(e){this._viewer=e.getViewer(),this._camera=e.getCamera(),this._event=new FreeDo.Event,this._eventHelper=new FreeDo.EventHelper,this._divID=e.getViewer()._container.id,this._bActive=!1,this._bRun=!1,this._windowTimer=null,this._metaData=[]}return t.prototype.enable=function(){this._bActive=!0,this.setFocus(),this.addEventLsnr(),this._event.raiseEvent("StatusChanged",{status:this._bActive})},t.prototype.disable=function(){this._bActive=!1,this._event.raiseEvent("StatusChanged",{status:this._bActive})},t.prototype.setFocus=function(){var e=document.getElementById(this._divID);e.setAttribute("tabindex",1),e.focus()},t.prototype.getStatus=function(){return this._bActive},t.prototype.prevent=function(e){var t=e.keyCode||e.which;38!=t&&40!=t&&37!=t&&39!=t&&87!=t&&65!=t&&83!=t&&68!=t||(e.stopPropagation(),e.preventDefault())},t.prototype.onKeyDown=function(e){if(this._bActive){e=window.event||e;e.keyCode||e.which;this._metaData[e.keyCode]=!0,this.startTimer(),this.prevent(e)}},t.prototype.onKeyUp=function(e){if(this._bActive){e=window.event||e;e.keyCode||e.which;this._metaData[e.keyCode]=!1,this.stopTimer(),this.prevent(e)}},t.prototype.startTimer=function(e){var t=this;null==this._windowTimer&&(this._windowTimer=window.setInterval(function(){t._event.raiseEvent("timer",{metaData:t._metaData}),t._event.raiseEvent("KeyPressed",{metaData:t._metaData})},33))},t.prototype.stopTimer=function(e){if(null!=this._windowTimer){var t=!0;for(var i in this._metaData)if(this._metaData[i]){t=!1;break}t&&(window.clearInterval(this._windowTimer),this._windowTimer=null)}},t.prototype.addEventLsnr=function(){var e=this;if(!this._bRun){this._bRun=!0;var t=this._viewer.canvas;t.addEventListener("click",function(e){e.target===t&&(this.setAttribute("tabindex",1),this.focus())}),t.onkeydown=function(i){i.target===t&&e.onKeyDown(i)},t.onkeyup=function(i){i.target===t&&e.onKeyUp(i)}}},t.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},t.prototype.reset=function(){this._bActive=!1},t.prototype.dispose=function(){this.reset()},t}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o,r;o=[i(0),i(1),i(2)],void 0!==(r=function(e,t,i){"use strict";function o(e){var o=this;e._options.paths={},this._pathsOpts=e._options.paths,this._project=e,this._pa=new t(e),this._pa.on(function(e,t){o.pathAnimatorEventCallback(e,t)}),this._ple=new i(e),this._ple.setAutoLoop(!1),this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper,this._currentPlayingGroupID=void 0,this._currentGroupID=void 0}return Object.defineProperties(o.prototype,{playingLoop:{get:function(){return this._loop},set:function(e){this._loop!==e&&(this._loop=e)}}}),o.prototype.pathAnimatorEventCallback=function(e,t){this._event.raiseEvent(e,t)},o.prototype.createGroup=function(e,t){return void 0===t&&(t=Freedo.createGuid()),this._pathsOpts[t]={name:e,smooth:5,list:[]},this._event.raiseEvent("GroupsChanged"),t},o.prototype.removeGroup=function(e){return void 0!==this._pathsOpts[e]&&(this._currentGroupID===e&&(this._pa.reset(),this._currentGroupID=void 0),this._currentPlayingGroupID,delete this._pathsOpts[e],this._event.raiseEvent("GroupsChanged"),!0)},o.prototype.getGroupName=function(e){return void 0===this._pathsOpts[e]?"":this._pathsOpts[e].name},o.prototype.setGroupName=function(e,t){if(void 0===this._pathsOpts[e])return"";this._pathsOpts[e].name=t},o.prototype.getGroupSmooth=function(e){return void 0===this._pathsOpts[e]?-1:this._pathsOpts[e].smooth?this._pathsOpts[e].smooth:5},o.prototype.setGroupSmooth=function(e,t){return void 0!==this._pathsOpts[e]&&(this._pathsOpts[e].smooth=t,this._pa.setSmoothRate(t),!0)},o.prototype.getGroupOptions=function(e){if(void 0!==this._pathsOpts[e]){return Freedo.clone(this._pathsOpts[e],!0)}},o.prototype.removeAllGroups=function(){for(var e in this._pathsOpts)delete this._pathsOpts[e];return this._currentPlayingGroupID=void 0,this._event.raiseEvent("GroupsChanged"),!0},o.prototype.getAllGroupIDs=function(){var e=[];for(var t in this._pathsOpts)e.push(t);return e},o.prototype.preAppendPathPoint=function(){var t=this._pathsOpts[this._currentGroupID].list;if(t&&t.length>=1){var i=t[t.length-1];this._ple.setStartPt(e.tc(i.position))}this._ple.run(),this._lsner&&(this._lsner(),this._lsner=void 0);var o=this;this._lsner=this._ple.on(function(e,t){"PointAdded"==e&&o.appendPathPoint(o._currentGroupID,t),"PLAdd"==e&&(o._ple.cancel(),o._event.raiseEvent("PLAddEnd",t),o.reloadPA())})},o.prototype.endAppendPathPoint=function(){this._ple.cancel(),this._lsner&&(this._lsner(),this._lsner=void 0)},o.prototype.appendPathPoint=function(e,t){if(void 0===this._pathsOpts[e])return!1;var i=Freedo.clone(t,!0);return this._pathsOpts[e].list.push(i),this._event.raiseEvent("GroupChanged",e),!0},o.prototype.insertPathPoint=function(e,t,i){if(void 0===this._pathsOpts[e])return!1;var o=Freedo.clone(t,!0);return this._pathsOpts[e].list.splice(i,0,o),this._event.raiseEvent("GroupChanged",e),!0},o.prototype.removePathPoint=function(e,t){return void 0!==this._pathsOpts[e]&&(void 0!==this._pathsOpts[e].list[t]&&(this._pathsOpts[e].list.splice(t,1),this._event.raiseEvent("GroupChanged",e),this.reloadPA(e),!0))},o.prototype.getPathsLength=function(e){if(void 0===this._pathsOpts[e])throw new Error("getPathsLength error!");return this._pathsOpts[e].list.length},o.prototype.setPathPoint=function(e,t,i){if(void 0===this._pathsOpts[e])return!1;if(void 0===this._pathsOpts[e].list[t])return!1;var o=Freedo.clone(i,!0);return this._pathsOpts[e].list[t]=o,this._event.raiseEvent("PathChanged",e),!0},o.prototype.getPathPoint=function(e,t){if(void 0===this._pathsOpts[e])throw new Error("getPath error");if(void 0===this._pathsOpts[e].list[t])return new Error("getPath error");var i=this._pathsOpts[e].list[t];return Freedo.clone(i,!0)},o.prototype.flyto=function(t,i){if(void 0===this._pathsOpts[t])return!1;if(void 0===this._pathsOpts[t].list[i])return!1;var o=this._pathsOpts[t].list[i],r=this._pa.getTotalLength(),n=new Freedo.BoundingSphere(e.tc(o.position),r/400);return this._project.getCamera().flyToBoundingSphere(n),!0},o.prototype.goto=function(e,t){return void 0!==this._pathsOpts[e]&&(void 0!==this._pathsOpts[e].list[t]&&void 0!==this._pathsOpts[e].list[t].cameraInfo)},o.prototype.start=function(){this._pa.start()},o.prototype.pause=function(){this._pa.pause()},o.prototype.stop=function(){this._pa.stop()},o.prototype.getGroupPlayingStatus=function(){},o.prototype.getGroupPlayingGroupID=function(){return this._currentPlayingGroupID},o.prototype.setCurrentGroupID=function(e){this._currentGroupID=e,this.reloadPA(e)},o.prototype.reloadPA=function(e){e||(e=this._currentGroupID);var t=this._pathsOpts[e];if(void 0===t)throw new Error("getPath error");if(void 0===t.list)return new Error("getPath error");var i=[];for(var o in t.list)i.push(t.list[o].position);this._pa.setPoints(i)},o.prototype.setPathShow=function(e){this._pa.setPathShow(e)},o.prototype.setLoop=function(e){this._pa.setLoop(e)},o.prototype.setEnableKB=function(e){e?this._pa.enable():this._pa.disable()},o.prototype.getPitch=function(){return this._pa.getPitch()},o.prototype.setPitch=function(e){this._pa.setPitch(e)},o.prototype.setPathViewMode=function(e){this._pa.setPathViewMode(e)},o.prototype.getSpeed=function(){this._pa.getSpeed()},o.prototype.setSpeed=function(e){this._pa.setSpeed(e)},o.prototype.setSmoothRate=function(e){this._pa.setSmoothRate(e)},o.prototype.getHeight=function(){return this._pa.getHeight()},o.prototype.setHeight=function(e){this._pa.setHeight(e)},o.prototype.setHeading=function(e){this._pa.setHeading(e)},o.prototype.setOffsetH=function(e){this._pa.setOffsetH(e)},o.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},o.prototype.reset=function(){this.removeAllGroups(),this._pa.reset()},o.prototype.dispose=function(){this.reset(),this._eventHelper.removeAll()},o}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o,r;o=[i(39)],void 0!==(r=function(e){"use strict";function t(e){this._project=e,this._viewer=e.getViewer(),this._scene=this._viewer.scene,this._showTerrain=!1,this._terrain=void 0,this._terrain=new Freedo.CesiumTerrainProvider({url:"//terrain.gbim360.com",requestWaterMask:!1}),this._event=new FreeDo.Event,this._eventHelper=new FreeDo.EventHelper,this._defaultTerrain=new Freedo.EllipsoidTerrainProvider}return t.prototype.setTerrain=function(t,i){"HM"==i&&(this._terrain=new Freedo.CesiumTerrainProvider({url:t,requestWaterMask:!1})),"STK"==i&&(this._terrain=new Freedo.CesiumTerrainProvider({url:t,requestWaterMask:!1})),"WETS"==i&&(this._terrain=new e({url:t})),this._project._options.terrain&&(this._project._options.terrain.type=i,this._project._options.terrain.url=t,this._event.raiseEvent("TypeChanged",{type:i}))},t.prototype.getTerrain=function(){return this._terrain},t.prototype.getTerrainType=function(){return this._project._options.terrain.type},t.prototype.showTerrain=function(e){this._showTerrain&&0==e?(this._viewer.terrainProvider=this._defaultTerrain,this._showTerrain=!1):this._showTerrain||1!=e?this._showTerrain&&1==e&&(this._viewer.terrainProvider=this._terrain,this._showTerrain=!0):(this._viewer.terrainProvider=this._terrain,this._showTerrain=!0),this._project._options.terrain&&(this._project._options.terrain.show=e,this._event.raiseEvent("StatusChanged",{status:e}))},t.prototype.show=function(e){this.showTerrain(e)},t.prototype.getVisible=function(){return this._showTerrain},t.prototype.setDepthTest=function(e){this._viewer.scene.globe.depthTestAgainstTerrain=e},t.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},t.prototype.reset=function(){this.showTerrain(!1)},t.prototype.dispose=function(){},t}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o,r;o=[i(0)],void 0!==(r=function(e){"use strict";function t(e){this._viewer=e.getViewer(),this._project=e,this._sceneMgr=e.getSceneManager(),this._bInTransform=!1,this._transType="MOVE",this._bInRun=!1,this._xAxisPL=null,this._yAxisPL=null,this._zAxisPL=null,this._XYPlane=null,this._YZPlane=null,this._XZPlane=null,this._XYCircle=null,this._XZCircle=null,this._YZCircle=null,this._selectedAxis="",this._mouseDownPos=null,this._initSphere=null,this._useDepthPicking=!0,this._pickTranslucentDepth=!0,this._fixedAxis="",this._DISPERRAD=111e3,this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper,this._oldPt=null,this._started=!1,this._mouseDown=!1,this._lastDis=-1,this._alpha=.5,this._axisZoom=1,this.PositionType={NONE:0,ON_MODEL:1,ON_TERRAIN:2,ON_ELLIPSOID:3},this._handler=void 0,this._mouseDownXY=null}t.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},t.prototype.startTransform=function(e){this._transType=e,this._bInTransform||(this._bInTransform=!0,this.addListeners(),this._bInRun=!0)},t.prototype.update=function(e){this._initSphere=FreeDo.clone(e,!0),this.calcAxisZoom(),this.clearAxis(),this.showAxis()},t.prototype.cancelTransform=function(){this.reset()},t.prototype.updateSceneSphere=function(e){this._initSphere=FreeDo.clone(e,!0)},t.prototype.addListeners=function(){this._handler=new Freedo.ScreenSpaceEventHandler(this._viewer.scene.canvas),this._handler.setInputAction(this.onLeftDown.bind(this),FreeDo.ScreenSpaceEventType.LEFT_DOWN),this._handler.setInputAction(this.onMouseMove.bind(this),FreeDo.ScreenSpaceEventType.MOUSE_MOVE),this._handler.setInputAction(this.onLeftUp.bind(this),FreeDo.ScreenSpaceEventType.LEFT_UP),this._handler.setInputAction(this.onWheel.bind(this),FreeDo.ScreenSpaceEventType.WHEEL),this._handler.setInputAction(this.onClick.bind(this),FreeDo.ScreenSpaceEventType.LEFT_CLICK);var e=this;this._project.getCamera().on(function(t,i){"Changed"==t&&e.onWheel()}),window.addEventListener("keydown",this.onKeyDown.bind(this))},t.prototype.calcFixedAxis=function(){if("X_AXIS"===this._selectedAxis)return void(this._fixedAxis="X");if("Y_AXIS"===this._selectedAxis)return void(this._fixedAxis="Y");if("Z_AXIS"===this._selectedAxis)return void(this._fixedAxis="Z");var e=2*this._initSphere.radius*.95*this._axisZoom,t=FreeDo.Cartographic.fromCartesian(this._initSphere.center);if(void 0!==t&&void 0!==this._mouseDownPos){if("XY"===this._selectedAxis){var i=FreeDo.clone(this._mouseDownPos,!0);i.longitude=t.longitude,i.height=t.height;var o=new Freedo.EllipsoidGeodesic(i,t).surfaceDistance;i=FreeDo.clone(this._mouseDownPos,!0),i.latitude=t.latitude,i.height=t.height;var r=new Freedo.EllipsoidGeodesic(i,t).surfaceDistance;o<r&&o/e<.2&&(this._fixedAxis="X"),o>r&&r/e<.2&&(this._fixedAxis="Y")}if("YZ"===this._selectedAxis){var i=FreeDo.clone(this._mouseDownPos,!0);i.height=t.height;var n=new Freedo.EllipsoidGeodesic(i,t).surfaceDistance;i=FreeDo.clone(this._mouseDownPos,!0);var r=Math.abs(i.height-t.height);r<n&&r/e<.2&&(this._fixedAxis="Y"),r>n&&n/e<.2&&(this._fixedAxis="Z")}if("XZ"===this._selectedAxis){var i=FreeDo.clone(this._mouseDownPos,!0);i.height=t.height;var n=new Freedo.EllipsoidGeodesic(i,t).surfaceDistance;i=FreeDo.clone(this._mouseDownPos,!0);var o=Math.abs(i.height-t.height);o<n&&o/e<.2&&(this._fixedAxis="X"),o>n&&n/e<.2&&(this._fixedAxis="Z")}}},t.prototype.calcAxisZoom=function(){if(!1===this._bInTransform)return void(this._axisZoom=1);var e=this._initSphere.center,t=this._project.getCamera()._camera.positionWC,i=1,i=Freedo.Cartesian3.distance(e,t)/6;this._axisZoom=i,this._viewer.scene._mode===Freedo.SceneMode.COLUMBUS_VIEW&&(this._axisZoom=this._project.getCamera()._camera.positionWC.x/3),this._axisZoom>4e5&&(this._axisZoom=4e5)},t.prototype.onWheel=function(){!1!==this._bInTransform&&this.calcAxisZoom()},t.prototype.onKeyDown=function(){!1!==this._bInTransform&&27===window.event.keyCode&&""!==this._selectedAxis&&(this._event.raiseEvent("OnKeyDown",{keyCode:window.event.keyCode}),this._selectedAxis="",this.onLeftUp())},t.prototype.onMouseMove=function(e){if(""!=this._selectedAxis){var t=null;return"XY"!==this._selectedAxis&&"XY_CIRCLE"!==this._selectedAxis&&"X_AXIS"!==this._selectedAxis&&"Y_AXIS"!==this._selectedAxis&&"Z_AXIS"!==this._selectedAxis||(t=this.pickPositionOnEllipsoid(e.endPosition)),"YZ"!==this._selectedAxis&&"YZ_CIRCLE"!==this._selectedAxis||(t=this.pickPositionOnPlane(e.endPosition,"YZ")),"XZ"!==this._selectedAxis&&"XZ_CIRCLE"!==this._selectedAxis||(t=this.pickPositionOnPlane(e.endPosition,"XZ")),void this._event.raiseEvent("Transforming",{MouseDownPos:this._mouseDownPos,MouseMovePos:t,MouseDownXY:this._mouseDownXY,MouseMoveXY:e.endPosition,SelectedAxis:this._selectedAxis,FixedAxis:this._fixedAxis})}},t.prototype.onClick=function(e){var t=this.pickPosition(e.position);this._event.raiseEvent("GotoPoint",t)},t.prototype.onLeftDown=function(e){if(this._bInTransform){this._mouseDown=!0,this._oldPt=null,this._started=!1,this._lastDis=-1;var t=this._viewer.scene.pick(e.position);if(FreeDo.defined(t)){if(FreeDo.defined(t.id)&&FreeDo.defined(t.id._name)){var i=t.id._name;("X_AXIS"===i||"Y_AXIS"===i||"Z_AXIS"===i)&&this._transType.indexOf("MOVE")>=0&&(t.id.polyline.material.color=new Freedo.Color(1,1,0,1)),"YZ"!==i&&"XZ"!==i||(t.id.wall.material.color=new Freedo.Color(1,0,0,.2)),"XY"===i&&(t.id.polygon.material.color=new Freedo.Color(1,0,0,.2)),"XY_CIRCLE"!==i&&"YZ_CIRCLE"!==i&&"XZ_CIRCLE"!==i||(t.id.polyline.material.color=new Freedo.Color(1,1,0,1)),"XY_CIRCLE"!==i&&"XZ_CIRCLE"!==i&&"YZ_CIRCLE"!==i&&"XY"!==i&&"XZ"!==i&&"YZ"!==i&&"X_AXIS"!==i&&"Y_AXIS"!==i&&"Z_AXIS"!==i||(this._selectedAxis=FreeDo.clone(i,!0),this._viewer.scene.screenSpaceCameraController.enableRotate=!1,this._viewer.scene.screenSpaceCameraController.enableLook=!1,this._mouseDownPos=null,this._event.raiseEvent("Transform",{}))}"XY"!==this._selectedAxis&&"XY_CIRCLE"!==this._selectedAxis&&"X_AXIS"!==this._selectedAxis&&"Y_AXIS"!==this._selectedAxis||(this._mouseDownPos=this.pickPositionOnEllipsoid(e.position),this._transType.indexOf("MOVE")>=0&&this.calcFixedAxis()),"YZ"!==this._selectedAxis&&"YZ_CIRCLE"!==this._selectedAxis||(this._mouseDownPos=this.pickPositionOnPlane(e.position,"YZ"),this._transType.indexOf("MOVE")>=0&&this.calcFixedAxis()),"XZ"!==this._selectedAxis&&"Z_AXIS"!==this._selectedAxis&&"XZ_CIRCLE"!==this._selectedAxis||(this._mouseDownPos=this.pickPositionOnPlane(e.position,"XZ"),this._transType.indexOf("MOVE")>=0&&this.calcFixedAxis()),"X"===this._fixedAxis&&(this._xAxisPL.polyline.material.color=FreeDo.Color.YELLOW),"Y"===this._fixedAxis&&(this._yAxisPL.polyline.material.color=FreeDo.Color.YELLOW),"Z"===this._fixedAxis&&(this._zAxisPL.polyline.material.color=FreeDo.Color.YELLOW),this._mouseDownXY=e.position}}},t.prototype.backToEnableRotate=function(e){""===this._selectedAxis&&(this._viewer.scene.screenSpaceCameraController.enableRotate=!0,this._viewer.scene.screenSpaceCameraController.enableLook=!0)},t.prototype.onLeftUp=function(e){setTimeout(this.backToEnableRotate.bind(this),500),this._mouseDownPos=null,this._mouseDown=!1,"XY"===this._selectedAxis&&(this._XYPlane.polygon.material.color=new Freedo.Color(1,1,0,this._alpha)),"XZ"===this._selectedAxis&&(this._XZPlane.wall.material.color=new Freedo.Color(1,0,1,this._alpha)),"YZ"===this._selectedAxis&&(this._YZPlane.wall.material.color=new Freedo.Color(0,1,1,this._alpha)),"XY_CIRCLE"===this._selectedAxis&&(this._XYCircle.polyline.material.color=new Freedo.Color(0,0,1,this._alpha)),"XZ_CIRCLE"===this._selectedAxis&&(this._XZCircle.polyline.material.color=new Freedo.Color(0,1,0,this._alpha)),"YZ_CIRCLE"===this._selectedAxis&&(this._YZCircle.polyline.material.color=new Freedo.Color(1,0,0,this._alpha)),"X"===this._fixedAxis&&(this._xAxisPL.polyline.material.color=FreeDo.Color.RED),"Y"===this._fixedAxis&&(this._yAxisPL.polyline.material.color=FreeDo.Color.GREEN),"Z"===this._fixedAxis&&(this._zAxisPL.polyline.material.color=FreeDo.Color.BLUE),""!==this._selectedAxis&&this._event.raiseEvent("Transformed",{}),this.calcAxisZoom(),this._selectedAxis="",this._fixedAxis=""},t.prototype.clearAxis=function(){null!=this._xAxisPL&&(this._viewer.entities.remove(this._xAxisPL),this._viewer.entities.remove(this._yAxisPL),this._viewer.entities.remove(this._zAxisPL),this._viewer.entities.remove(this._XZPlane),this._viewer.entities.remove(this._YZPlane),this._viewer.entities.remove(this._XYPlane),this._viewer.entities.remove(this._XYCircle),this._viewer.entities.remove(this._XZCircle),this._viewer.entities.remove(this._YZCircle)),this._selectedAxis=""};var i=null,o=null,r=null,n=null,s=null,a=null;return t.prototype.calcCallbackArgs=function(){i=this._initSphere.center,o=4*this._initSphere.radius,o>160&&(o=160),r=Freedo.Cartographic.fromCartesian(i),n=Freedo.Math.toDegrees(r.longitude),s=Freedo.Math.toDegrees(r.latitude),a=r.height,o=this._axisZoom},t.prototype.pickPositionOnEllipsoid=function(e){var t=Freedo.Cartographic.fromCartesian(this._initSphere.center),i=Freedo.clone(Freedo.Ellipsoid.WGS84,!0);i.radii.x+=t.height,i.radii.y+=t.height,i.radii.z+=t.height;var o=new Freedo.Ellipsoid(i.radii.x,i.radii.y,i.radii.z),r=this._viewer.camera.pickEllipsoid(e,o,new Freedo.Cartesian3);if(void 0!==r){return Freedo.Cartographic.fromCartesian(r)}},t.prototype.pickPositionOnPlane=function(e,t){this.calcCallbackArgs();var i=1e-5*this._axisZoom,n=Freedo.Cartesian3.fromRadians(r.longitude-i,r.latitude,-2e3),s=Freedo.Cartesian3.fromRadians(r.longitude,r.latitude,r.height+.95*o+1e3),a=Freedo.Cartesian3.fromRadians(r.longitude+i,r.latitude,-2e3);"YZ"===t&&(n=Freedo.Cartesian3.fromRadians(r.longitude,r.latitude-i,-2e3),s=Freedo.Cartesian3.fromRadians(r.longitude,r.latitude,r.height+.95*o+1e3),a=Freedo.Cartesian3.fromRadians(r.longitude,r.latitude+i,-2e3));var h=this._viewer.camera.getPickRay(e),l=0,c=0,d=Freedo.Cartographic.fromCartesian(this._initSphere.center);l=Math.cos(d.longitude),c=Math.sin(d.longitude);var p=(new Freedo.Plane.fromPointNormal(new Freedo.Cartesian3(0,0,0),new Freedo.Cartesian3(l,c,0)),{});p.x=h.origin.x+1e6*h.direction.x,p.y=h.origin.y+1e6*h.direction.y,p.z=h.origin.z+1e6*h.direction.z;var _=Freedo.IntersectionTests.lineSegmentTriangle(h.origin,p,n,s,a);if(void 0!==_){return Freedo.Cartographic.fromCartesian(_)}},t.prototype.pickPosition=function(e){var t,i,o=this.PositionType.NONE;if(this._viewer.scene.pickPositionSupported){var i=this._viewer.scene.drillPick(e);if(Freedo.defined(i)&&i.length>0)for(var r=0;r<i.length;++r)if(i[r]instanceof Freedo.FreedoPModelFeature&&(t=this._viewer.scene.pickPosition(e),Freedo.defined(t))){o=this.PositionType.ON_MODEL;break}}if(o===this.PositionType.NONE){if(this._useDepthPicking=FreeDo.clone(this._viewer.scene.useDepthPicking,!0),this._pickTranslucentDepth=FreeDo.clone(this._viewer.scene.pickTranslucentDepth,!0),this._viewer.scene.pickPositionSupported){t=this._viewer.scene.pickPosition(e,new Freedo.Cartesian3);Freedo.Cartographic.fromCartesian(t);Freedo.defined(t)&&(o=this.PositionType.ON_TERRAIN)}this._viewer.scene.useDepthPicking=FreeDo.clone(this._useDepthPicking,!0),this._viewer.scene.pickTranslucentDepth=FreeDo.clone(this._pickTranslucentDepth,!0)}return o===this.PositionType.NONE&&(t=this._viewer.camera.pickEllipsoid(e,this._viewer.scene.globe.ellipsoid),Freedo.defined(t)&&(o=this.PositionType.ON_ELLIPSOID)),{type:o,position:t}},t.prototype.callbackXY=function(t,i){this.calcCallbackArgs();var a=e.getLongAndLatRatio(r),h=FreeDo.Math.toDegrees(.5*o*a[0]),l=FreeDo.Math.toDegrees(.5*o*a[1]);return Freedo.Cartesian3.fromDegreesArray([n,s,n+h,s,n+h,s+l,n,s+l,n,s])},t.prototype.callbackXYHalfCircle=function(t,i){this.calcCallbackArgs();for(var h=(this._DISPERRAD,[]),l=e.getLongAndLatRatio(r),c=FreeDo.Math.toDegrees(.65*o*l[0]),d=FreeDo.Math.toDegrees(.65*o*l[1]),p=0;p<=Math.PI/2;p+=.001){var _=n+c*Math.cos(p),u=s+d*Math.sin(p),v=Freedo.Cartesian3.fromDegrees(_,u,a);h.push(v)}return h},t.prototype.callbackXZHalfCircle=function(t,i){this.calcCallbackArgs();for(var h=e.getLongAndLatRatio(r),l=FreeDo.Math.toDegrees(.65*o*h[0]),c=(FreeDo.Math.toDegrees(.65*o*h[1]),[]),d=Math.PI/2;d>=0;d-=.001){var p=n+l*Math.cos(d),_=s,u=a+.65*o*Math.sin(d),v=Freedo.Cartesian3.fromDegrees(p,_,u);c.push(v)}return c},t.prototype.callbackYZHalfCircle=function(t,i){this.calcCallbackArgs();for(var h=e.getLongAndLatRatio(r),l=(FreeDo.Math.toDegrees(.65*o*h[0]),FreeDo.Math.toDegrees(.65*o*h[1])),c=[],d=Math.PI/2;d>=0;d-=.001){var p=n,_=s+l*Math.cos(d),u=a+.65*o*Math.sin(d),v=Freedo.Cartesian3.fromDegrees(p,_,u);c.push(v)}return c},t.prototype.callbackXYShow=function(e,t){return this.calcCallbackArgs(),t=!0,"XY_CIRCLE"==this._selectedAxis&&(t=!1),t},t.prototype.callbackXYH=function(e,t){return a+.1},t.prototype.callbackXZ=function(t,i){this.calcCallbackArgs();var a=e.getLongAndLatRatio(r),h=FreeDo.Math.toDegrees(.5*o*a[0]);return Freedo.Cartesian3.fromDegreesArray([n,s,n+h,s])},t.prototype.callbackXZMinimumHeights=function(e,t){return this.calcCallbackArgs(),[a,a]},t.prototype.callbackXZMaximumHeights=function(e,t){return this.calcCallbackArgs(),[a+.5*o,a+.5*o]},t.prototype.callbackYZ=function(e,t){return this.calcCallbackArgs(),Freedo.Cartesian3.fromDegreesArray([n,s,n,s+.5*o/this._DISPERRAD])},t.prototype.callbackXYCCBP=function(e,t){return this.calcCallbackArgs(),Freedo.Cartesian3.fromDegrees(n,s)},t.prototype.callbackX=function(t,i){this.calcCallbackArgs();var h=e.getLongAndLatRatio(r),l=FreeDo.Math.toDegrees(o*h[0]);return Freedo.Cartesian3.fromDegreesArrayHeights([n,s,a,n+l,s,a])},t.prototype.callbackY=function(e,t){return this.calcCallbackArgs(),Freedo.Cartesian3.fromDegreesArrayHeights([n,s,a,n,s+o/this._DISPERRAD,a])},t.prototype.callbackZ=function(e,t){return this.calcCallbackArgs(),Freedo.Cartesian3.fromDegreesArrayHeights([n,s,a,n,s,a+o])},t.prototype.callbackH=function(e,t){return this.calcCallbackArgs(),a},t.prototype.showAxis=function(){var e=(new Freedo.CallbackProperty(this.callbackXY.bind(this),!1),new Freedo.CallbackProperty(this.callbackXYHalfCircle.bind(this),!1)),t=new Freedo.CallbackProperty(this.callbackXZHalfCircle.bind(this),!1),i=new Freedo.CallbackProperty(this.callbackYZHalfCircle.bind(this),!1),o=(new Freedo.CallbackProperty(this.callbackXYShow.bind(this),!1),new Freedo.CallbackProperty(this.callbackXYH.bind(this),!1),new Freedo.CallbackProperty(this.callbackXZ.bind(this),!1),new Freedo.CallbackProperty(this.callbackXZMaximumHeights.bind(this),!1),new Freedo.CallbackProperty(this.callbackXZMinimumHeights.bind(this),!1),new Freedo.CallbackProperty(this.callbackYZ.bind(this),!1),new Freedo.CallbackProperty(this.callbackXYCCBP.bind(this),!1),new Freedo.CallbackProperty(this.callbackX.bind(this),!1)),r=new Freedo.CallbackProperty(this.callbackY.bind(this),!1),n=new Freedo.CallbackProperty(this.callbackZ.bind(this),!1);new Freedo.CallbackProperty(this.callbackH.bind(this),!1);this._xAxisPL=this._viewer.entities.add({name:"X_AXIS",polyline:{positions:o,width:16,followSurface:!1,material:new Freedo.PolylineArrowMaterialProperty(Freedo.Color.RED)}}),this._yAxisPL=this._viewer.entities.add({name:"Y_AXIS",polyline:{positions:r,width:16,followSurface:!1,material:new Freedo.PolylineArrowMaterialProperty(Freedo.Color.GREEN)}}),this._zAxisPL=this._viewer.entities.add({name:"Z_AXIS",polyline:{positions:n,width:16,show:!0,followSurface:!1,material:new Freedo.PolylineArrowMaterialProperty(Freedo.Color.BLUE)}}),(this._transType.indexOf("ROTATE")>=0||this._transType.indexOf("SCALE")>=0)&&(this._XYCircle=this._viewer.entities.add({name:"XY_CIRCLE",polyline:{positions:e,width:4,show:!0,material:new Freedo.Color(0,0,1,this._alpha)}})),this._transType.indexOf("ROTATE")>=0&&(this._XZCircle=this._viewer.entities.add({name:"XZ_CIRCLE",polyline:{positions:t,width:4,show:!0,material:new Freedo.Color(0,1,0,this._alpha)}}),this._YZCircle=this._viewer.entities.add({name:"YZ_CIRCLE",polyline:{positions:i,width:4,show:!0,material:new Freedo.Color(1,0,0,this._alpha)}}))},t.prototype.reset=function(){void 0===this._handler||this._handler.isDestroyed()||this._handler.destroy(),this._bInTransform=!1,this.clearAxis(),this._mouseDownPos=null,this._initSphere=null,this._fixedAxis=""},t.prototype.dispose=function(){this.reset()},t}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o,r;o=[i(35),i(0)],void 0!==(r=function(e,t){"use strict";function i(t){this._viewer=t.getViewer(),this._project=t,this._sceneMgr=t.getSceneManager(),this._bInTransform=!1,this._transType="MOVE",this._sceneSphere=null,this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper,this._t12={TMoveX:0,TMoveY:0,TMoveZ:0,THeading:0,TPitch:0,TRoll:0,TScaleX:1,TScaleY:1,TScaleZ:1,TBaseX:0,TBaseY:0,TBaseZ:0},this._aSceneObjectId=[],this._mani=new e(t),this._mouseDownMat=[],this._mouseDown12Arg={},this._selectedAxis="",this._basePt=void 0,this._centerDis={},this._inMoveTo=!1,this.PositionType={NONE:0,ON_MODEL:1,ON_TERRAIN:2,ON_ELLIPSOID:3},this._axisZoom=1}return i.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},i.prototype.startTransform=function(e){if(this._bInTransform=!0,this._transType=e,!this.checkConflict()){this._basePt=void 0,this.calcSceneBS();for(var t in this._aSceneObjectId){var i=this._sceneMgr._pModelMap[this._aSceneObjectId[t]];this._mouseDownMat=FreeDo.clone(i.modelMatrix,!0)}var o=this;this._mani.on(function(e,t){if("OnKeyDown"==e&&27===t.keyCode){for(var i in o._aSceneObjectId){o._sceneMgr._pModelMap[o._aSceneObjectId[i]].modelMatrix=o._mouseDownMat}this._mani.update(this._sceneSphere)}"Transform"==e&&o.onTransform(),"Transformed"==e&&o.onTransformed(),"GotoPoint"==e&&o.onGotoPoint(t),"Transforming"==e&&o.onTransforming(t)}),this._transType.indexOf("MOVETO")>=0&&(this._inMoveTo=!0),this._mani.startTransform(this._transType),this._mani.update(this._sceneSphere)}},i.prototype.setSceneObjectIDs=function(e){this._aSceneObjectId=FreeDo.clone(e,!0)},i.prototype.checkConflict=function(){var e=0,t=0;for(var i in this._aSceneObjectId){var o=(this._sceneMgr._pModelMap[this._aSceneObjectId[i]],this._sceneMgr.getSceneObjectProperty(this._aSceneObjectId[i],"transformTime"));if(0==t)e=void 0===o?void 0:Freedo.clone(o,!0);else if(o!==e)return alert("编辑状态存在冲突无法继续！"),this.cancelTransform(),!0;t++}return!1},i.prototype.initTransform=function(){var e=0,t=0;for(var i in this._aSceneObjectId){var o=(this._sceneMgr._pModelMap[this._aSceneObjectId[i]],this._sceneMgr.getSceneObjectProperty(this._aSceneObjectId[i],"transformTime"));0==t?e=void 0===o?void 0:Freedo.clone(o,!0):o!==e&&console.log("部分模型存在变换，部分没有，请注意"),t++}for(var i in this._aSceneObjectId){var e=(this._sceneMgr._pModelMap[this._aSceneObjectId[i]],this._sceneMgr.getSceneObjectProperty(this._aSceneObjectId[i],"transformTime"));void 0!==e&&0!=e||this.resetTransform();var o=this._sceneMgr.getSceneObjectProperty(this._aSceneObjectId[i],"transformMatrix");void 0!==o&&(this._t12=FreeDo.clone(o,!0)),this._event.raiseEvent("InitTransform",FreeDo.clone(this._t12,!0))}this.cancelTransform()},i.prototype.calcSceneBS=function(){var e=[];for(var t in this._aSceneObjectId){var i=this._sceneMgr._pModelMap[this._aSceneObjectId[t]];void 0===i&&console.log("FdTransform：无效数据"),e.push(i.boundingSphere),void 0===this._basePt&&(this._basePt=this._sceneMgr.getSceneObjectProperty(this._aSceneObjectId[t],"basePoint"))}this._sceneSphere=FreeDo.BoundingSphere.fromBoundingSpheres(e,new FreeDo.BoundingSphere),void 0===this._basePt&&(this._basePt=Freedo.Cartographic.fromCartesian(this._sceneSphere.center),this._basePt.longitude=Freedo.Math.toDegrees(this._basePt.longitude),this._basePt.latitude=Freedo.Math.toDegrees(this._basePt.latitude))},i.prototype.calcXYZDist=function(e,t,i,o,r,n){return[o-e,r-t,n-i]},i.prototype.calcAxisZoom=function(){if(!1===this._bInClip)return void(this._axisZoom=1);var e=this._sceneSphere.center,t=this._project.getCamera()._camera.positionWC,i=1;i=Freedo.Cartesian3.distance(e,t)/6,this._project.getCamera()._camera.getPixelSize(this._sceneSphere,10,10),this._axisZoom=i,this._viewer.scene._mode===Freedo.SceneMode.COLUMBUS_VIEW&&(this._axisZoom=this._project.getCamera()._camera.positionWC.x/6),this._axisZoom>4e5&&(this._axisZoom=4e5),this._axisZoom<20&&(this._axisZoom=20)},i.prototype.onTransforming=function(e){var t=e.MouseDownPos,i=e.MouseMovePos,o=e.SelectedAxis,r=e.FixedAxis;this._selectedAxis=o;var n=[0,0,0],s=1,a=1,h=1,l=0,c=0,d=0;this.calcAxisZoom();var p=void 0;Freedo.defined(t)&&(p=Freedo.Cartesian3.fromRadians(t.longitude,t.latitude,t.height));var _=void 0;Freedo.defined(i)&&(_=Freedo.Cartesian3.fromRadians(i.longitude,i.latitude,i.height));var p=Freedo.Cartesian3.fromRadians(t.longitude,t.latitude,t.height),_=Freedo.Cartesian3.fromRadians(i.longitude,i.latitude,i.height),u=Freedo.Cartesian3.distance(p,this._sceneSphere.center),v=Freedo.Cartesian3.distance(_,this._sceneSphere.center);this.calcSceneBS();var f=Freedo.clone(this._mouseDown12Arg,!0),g=void 0;for(var y in this._aSceneObjectId){this._sceneMgr._pModelMap[this._aSceneObjectId[y]];if("XY"===o&&(n=this.calcXYZDist(t.longitude,t.latitude,t.height,i.longitude,i.latitude,t.height)),"YZ"===o&&(n=this.calcXYZDist(t.longitude,t.latitude,t.height,t.longitude,i.latitude,i.height)),"XZ"===o&&(n=this.calcXYZDist(t.longitude,t.latitude,t.height,i.longitude,t.latitude,i.height)),"X"===r&&(n=this.calcXYZDist(t.longitude,t.latitude,t.height,i.longitude,t.latitude,t.height)),"Y"===r&&(n=this.calcXYZDist(t.longitude,t.latitude,t.height,t.longitude,i.latitude,t.height)),"Z"===r&&(n[0]=0,n[1]=0,n[2]=-1*(e.MouseMoveXY.y-e.MouseDownXY.y)*this._axisZoom/100),this._transType.indexOf("SCALE")>=0&&"XY_CIRCLE"===o){var m=v/u;s=m,a=m,h=m}var g;if(this._transType.indexOf("ROTATE")>=0&&"XY_CIRCLE"===o){g=Freedo.Cartographic.fromCartesian(this._sceneSphere.center);var C=FreeDo.Cartesian3.fromRadians(g.longitude+.01,g.latitude,g.height),F=FreeDo.Cartesian3.subtract(C,this._sceneSphere.center,new FreeDo.Cartesian3),w=FreeDo.Cartesian3.subtract(p,this._sceneSphere.center,new FreeDo.Cartesian3),b=FreeDo.Cartesian3.subtract(_,this._sceneSphere.center,new FreeDo.Cartesian3),P=Freedo.Math.toDegrees(FreeDo.Cartesian3.angleBetween(b,F)),T=Freedo.Math.toDegrees(FreeDo.Cartesian3.angleBetween(w,F));t.latitude<g.latitude&&(T=360-T),i.latitude<g.latitude&&(P=360-P),l=T-P}if(this._transType.indexOf("ROTATE")>=0&&"XZ_CIRCLE"===o){if(!Freedo.defined(p))return;g=Freedo.Cartographic.fromCartesian(this._sceneSphere.center);var C=FreeDo.Cartesian3.fromRadians(g.longitude+.01,g.latitude,g.height),F=FreeDo.Cartesian3.subtract(C,this._sceneSphere.center,new FreeDo.Cartesian3),w=FreeDo.Cartesian3.subtract(p,this._sceneSphere.center,new FreeDo.Cartesian3),b=FreeDo.Cartesian3.subtract(_,this._sceneSphere.center,new FreeDo.Cartesian3),P=Freedo.Math.toDegrees(FreeDo.Cartesian3.angleBetween(b,F)),T=Freedo.Math.toDegrees(FreeDo.Cartesian3.angleBetween(w,F));t.height<g.height&&(T=360-T),i.height<g.height&&(P=360-P),c=P-T}if(this._transType.indexOf("ROTATE")>=0&&"YZ_CIRCLE"===o){if(!Freedo.defined(p))return;g=Freedo.Cartographic.fromCartesian(this._sceneSphere.center);var C=FreeDo.Cartesian3.fromRadians(g.longitude,g.latitude+.01,g.height),F=FreeDo.Cartesian3.subtract(C,this._sceneSphere.center,new FreeDo.Cartesian3),w=FreeDo.Cartesian3.subtract(p,this._sceneSphere.center,new FreeDo.Cartesian3),b=FreeDo.Cartesian3.subtract(_,this._sceneSphere.center,new FreeDo.Cartesian3),P=Freedo.Math.toDegrees(FreeDo.Cartesian3.angleBetween(b,F)),T=Freedo.Math.toDegrees(FreeDo.Cartesian3.angleBetween(w,F));t.height<g.height&&(T=360-T),i.height<g.height&&(P=360-P),d=P-T}var M={TMoveX:n[0],TMoveY:n[1],TMoveZ:n[2],THeading:l,TPitch:c,TRoll:d,TScaleX:s,TScaleY:a,TScaleZ:h};f.TMoveX+=Freedo.Math.toDegrees(M.TMoveX),f.TMoveY+=Freedo.Math.toDegrees(M.TMoveY),f.TMoveZ+=M.TMoveZ,f.THeading+=M.THeading,f.TPitch+=M.TPitch,f.TRoll+=M.TRoll,f.TScaleX*=M.TScaleX,f.TScaleY*=M.TScaleY,f.TScaleZ*=M.TScaleZ,g=this.getTilesetBasePt(this._aSceneObjectId[y]),f.TMoveX=Freedo.Math.toRadians(f.TMoveX)-g.longitude,f.TMoveY=Freedo.Math.toRadians(f.TMoveY)-g.latitude,f.TMoveZ=f.TMoveZ-g.height;break}for(var y in this._aSceneObjectId){this._sceneMgr._pModelMap[this._aSceneObjectId[y]];this.applyTransformToTileset(this._aSceneObjectId[y],f.TMoveX,f.TMoveY,f.TMoveZ,f.THeading,f.TPitch,f.TRoll,f.TScaleX,f.TScaleY,f.TScaleZ,Freedo.Math.toRadians(this._basePt.longitude),Freedo.Math.toRadians(this._basePt.latitude),this._basePt.height)}this._t12.TMoveX=Freedo.Math.toDegrees(g.longitude+f.TMoveX),this._t12.TMoveY=Freedo.Math.toDegrees(g.latitude+f.TMoveY),this._t12.TMoveZ=g.height+f.TMoveZ,this._t12.THeading=f.THeading,this._t12.TPitch=f.TPitch,this._t12.TRoll=f.TRoll,this._t12.TScaleX=f.TScaleX,this._t12.TScaleY=f.TScaleY,this._t12.TScaleZ=f.TScaleZ,this.refineArgs(),this._event.raiseEvent("Transforming",FreeDo.clone(this._t12,!0)),this.calcSceneBS(),this._mani.updateSceneSphere(this._sceneSphere)},i.prototype.refineArgs=function(){for(var e in this._aSceneObjectId){var i=this._sceneMgr._pModelMap[this._aSceneObjectId[e]],o=FreeDo.Matrix4.getScale(i.modelMatrix,new FreeDo.Cartesian3);this._t12.THeading>360&&(this._t12.THeading-=360),this._t12.THeading<-360&&(this._t12.THeading+=360),this._t12.TPitch>360&&(this._t12.TPitch-=360),this._t12.TPitch<-360&&(this._t12.TPitch+=360),this._t12.TRoll>360&&(this._t12.TRoll-=360),this._t12.TRoll<-360&&(this._t12.TRoll+=360),this._t12.TMoveX=t.round(this._t12.TMoveX,8),this._t12.TMoveY=t.round(this._t12.TMoveY,8),this._t12.TMoveZ=t.round(this._t12.TMoveZ,6),this._t12.THeading=t.round(this._t12.THeading,4),this._t12.TPitch=t.round(this._t12.TPitch,4),this._t12.TRoll=t.round(this._t12.TRoll,4),this._t12.TScaleX=t.round(o.x,4),this._t12.TScaleY=t.round(o.y,4),this._t12.TScaleZ=t.round(o.z,4)}},i.prototype.onGotoPoint=function(e){if(e.type!=this.PositionType.NONE&&this._inMoveTo){var t=Freedo.Cartographic.fromCartesian(e.position);if(void 0!==t){var i=FreeDo.clone(this._t12,!0);i.TMoveX=t.longitude,i.TMoveY=t.latitude;for(var o in this._aSceneObjectId){var r=this.getTilesetBasePt(this._aSceneObjectId[o]),n=i.TMoveX-r.longitude,s=i.TMoveY-r.latitude,a=i.TMoveZ-r.height;this.applyTransformToTileset(this._aSceneObjectId[o],parseFloat(n),parseFloat(s),parseFloat(a),parseFloat(i.THeading),parseFloat(i.TPitch),parseFloat(i.TRoll),parseFloat(i.TScaleX),parseFloat(i.TScaleY),parseFloat(i.TScaleZ),Freedo.Math.toRadians(this._basePt.longitude),Freedo.Math.toRadians(this._basePt.latitude),this._basePt.height)}i.TMoveX=Freedo.Math.toDegrees(i.TMoveX),i.TMoveY=Freedo.Math.toDegrees(i.TMoveY),i.TMoveZ=i.TMoveZ,this._t12=FreeDo.clone(i,!0),this.refineArgs(),""!==this._transType&&(this.calcSceneBS(),this._mani.update(this._sceneSphere)),this._event.raiseEvent("Transformed",FreeDo.clone(this._t12,!0))}this._inMoveTo=!1}},i.prototype.onTransform=function(e){this._event.raiseEvent("Transform",{}),this.refineArgs(),this._mouseDown12Arg=Freedo.clone(this._t12,!0)},i.prototype.onTransformed=function(e){this.saveTransform(),this.calcSceneBS(),this._mani.update(this._sceneSphere),this.refineArgs(),this._event.raiseEvent("Transformed",FreeDo.clone(this._t12,!0))},i.prototype.applyTransformToTileset=function(e,t,i,o,r,n,s,a,h,l,c,d,p){this._sceneMgr.getSceneObject(e).modelMatrix=this.getMatrix(e,t,i,o,r,n,s,a,h,l,c,d,p)},i.prototype.getMatrix=function(e,t,i,o,r,n,s,a,h,l,c,d,p){if(void 0!==this._sceneMgr.getSceneObject(e)){if(void 0===c){var _=this.getTilesetBasePt(e);c=_.longitude,d=_.latitude,p=_.height}var u=Freedo.Cartesian3.fromRadians(c,d,p),v=Freedo.Cartesian3.fromRadians(c+t,d+i,p+o);r=Freedo.Math.toRadians(r),n=Freedo.Math.toRadians(n),s=Freedo.Math.toRadians(s);var f=Freedo.Quaternion.fromHeadingPitchRoll(new Freedo.HeadingPitchRoll(r,n,s)),g=new Freedo.Cartesian3(a,h,l),y=Freedo.Matrix4.fromTranslationQuaternionRotationScale(new Freedo.Cartesian3,f,g),m=Freedo.Transforms.eastNorthUpToFixedFrame(u),C=Freedo.Matrix4.inverse(m,new Freedo.Matrix4),F=Freedo.Transforms.eastNorthUpToFixedFrame(v),w=Freedo.Matrix4.multiply(y,C,new Freedo.Matrix4),b=Freedo.Matrix4.multiply(F,w,new Freedo.Matrix4);return Freedo.clone(b,!0)}},i.prototype.getTilesetBasePt=function(e){var t=this._sceneMgr.getSceneObject(e);if(void 0!==t){var i=Freedo.clone(t._root.transform,!0),o=FreeDo.Matrix4.getTranslation(i,new FreeDo.Cartesian3);return Freedo.Cartographic.fromCartesian(o)}},i.prototype.applyTransform=function(e,t,i,o,r,n,s,a,h){if(!this.checkConflict()){this.calcSceneBS();try{e=parseFloat(e),t=parseFloat(t),i=parseFloat(i),o=parseFloat(o),r=parseFloat(r),n=parseFloat(n),s=parseFloat(s),a=parseFloat(a),h=parseFloat(h)}catch(e){return}if(!(isNaN(e)||isNaN(t)||isNaN(i)||isNaN(o)||isNaN(r)||isNaN(n)||isNaN(s)||isNaN(a)||isNaN(h))){for(var l in this._aSceneObjectId){var c=this.getTilesetBasePt(this._aSceneObjectId[l]),d=Freedo.Math.toRadians(e)-c.longitude,p=Freedo.Math.toRadians(t)-c.latitude,_=i-c.height;this.applyTransformToTileset(this._aSceneObjectId[l],parseFloat(d),parseFloat(p),parseFloat(_),parseFloat(o),parseFloat(r),parseFloat(n),parseFloat(s),parseFloat(a),parseFloat(h),Freedo.Math.toRadians(this._basePt.longitude),Freedo.Math.toRadians(this._basePt.latitude),this._basePt.height)}this._t12.TMoveX=e,this._t12.TMoveY=t,this._t12.TMoveZ=i,this._t12.THeading=o,this._t12.TPitch=r,this._t12.TRoll=n,this._t12.TScaleX=s,this._t12.TScaleY=a,this._t12.TScaleZ=h,this.refineArgs(),""!==this._transType&&(this.calcSceneBS(),this._mani.update(this._sceneSphere)),this._event.raiseEvent("Transformed",FreeDo.clone(this._t12,!0))}}},i.prototype.reset12Args=function(){if(!this.checkConflict()){var e=void 0;for(var t in this._aSceneObjectId){var e=this.getTilesetBasePt(this._aSceneObjectId[t]);break}void 0===e&&console.log("reset12Args: 出错"),this._t12.TMoveX=Freedo.Math.toDegrees(e.longitude),this._t12.TMoveY=Freedo.Math.toDegrees(e.latitude),this._t12.TMoveZ=e.height,this._t12.THeading=0,this._t12.TPitch=0,this._t12.TRoll=0,this._t12.TScaleX=1,this._t12.TScaleY=1,this._t12.TScaleZ=1,this.refineArgs(),this._basePt=void 0}},i.prototype.resetTransform=function(){this.reset12Args();for(var e in this._aSceneObjectId){var t=this._sceneMgr._pModelMap[this._aSceneObjectId[e]];this._sceneMgr.setSceneObjectProperty(this._aSceneObjectId[e],"initialMatrix",FreeDo.clone(FreeDo.Matrix4.IDENTITY,!0)),this._sceneMgr.setSceneObjectProperty(this._aSceneObjectId[e],"transformMatrix",FreeDo.clone(this._t12,!0)),this._sceneMgr.setSceneObjectProperty(this._aSceneObjectId[e],"transformTime",0),this._sceneMgr.setSceneObjectProperty(this._aSceneObjectId[e],"basePoint",this._basePt),t.modelMatrix=FreeDo.clone(FreeDo.Matrix4.IDENTITY,!0)}this.calcSceneBS(),this._bInTransform&&this._mani.update(this._sceneSphere),this._event.raiseEvent("resetTransform",FreeDo.clone(this._t12,!0))},i.prototype.saveTransform=function(){var e=Date.parse(new Date);for(var t in this._aSceneObjectId){var i=this._sceneMgr._pModelMap[this._aSceneObjectId[t]];this._sceneMgr.setSceneObjectProperty(this._aSceneObjectId[t],"initialMatrix",FreeDo.clone(i.modelMatrix,!0)),this._sceneMgr.setSceneObjectProperty(this._aSceneObjectId[t],"transformMatrix",FreeDo.clone(this._t12,!0)),this._sceneMgr.setSceneObjectProperty(this._aSceneObjectId[t],"transformTime",e);void 0==this._sceneMgr.getSceneObjectProperty(this._aSceneObjectId[t],"basePoint")&&this._sceneMgr.setSceneObjectProperty(this._aSceneObjectId[t],"basePoint",this._basePt)}},i.prototype.cancelTransform=function(){this.reset(),this._event.raiseEvent("cancelTransform",{})},i.prototype.reset=function(){this._bInTransform=!1,this._sceneSphere=null,this._mani.reset(),this._transType=""},i.prototype.dispose=function(){this.reset()},i}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o,r;o=[i(38),i(0)],void 0!==(r=function(e,t){"use strict";function i(t){this._viewer=t.getViewer(),this._project=t,this._sceneMgr=t.getSceneManager(),this._bInTransform=!1,this._transType="MOVE",this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper,this._sceneSphere={},this._basePt={},this._t12={TMoveX:0,TMoveY:0,TMoveZ:0,DMoveX:0,DMoveY:0,DMoveZ:0,THeading:0,TPitch:0,TRoll:0,TScaleX:1,TScaleY:1,TScaleZ:1,TBaseX:0,TBaseY:0,TBaseZ:0},this._aSceneObjectId=[],this._mani=new e(t),this._mouseDown12Arg={},this._selectedAxis="",this._centerDis={},this._inMoveTo=!1,this.PositionType={NONE:0,ON_MODEL:1,ON_TERRAIN:2,ON_ELLIPSOID:3},this._axisZoom=1}return i.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},i.prototype.setArg=function(e,t){switch(e){case"basePtX":this._t12.TBaseX=t;break;case"basePtY":this._t12.TBaseY=t;break;case"basePtZ":this._t12.TBaseZ=t;break;case"translateX":this._t12.DMoveX=t;break;case"translateY":this._t12.DMoveY=t;break;case"translateZ":this._t12.DMoveZ=t;break;case"rotateX":this._t12.THeading=t;break;case"rotateY":this._t12.TPitch=t;break;case"rotateZ":this._t12.TRoll=t;break;case"scaleX":this._t12.TScaleX=t;break;case"scaleY":this._t12.TScaleY=t;break;case"scaleZ":this._t12.TScaleZ=t}this._t12.TMoveX=this._t12.TBaseX+this._t12.DMoveX,this._t12.TMoveY=this._t12.TBaseY+this._t12.DMoveY,this._t12.TMoveZ=this._t12.TBaseZ+this._t12.DMoveZ;var i=Freedo.Math.toRadians,o=Freedo.Math.toDegrees,r=this.getMatrix(i(this._t12.DMoveX),i(this._t12.DMoveY),this._t12.DMoveZ,this._t12.THeading,this._t12.TPitch,this._t12.TRoll,this._t12.TScaleX,this._t12.TScaleY,this._t12.TScaleZ,Freedo.Math.toRadians(this._t12.TBaseX),Freedo.Math.toRadians(this._t12.TBaseY),this._t12.TBaseZ),n=Freedo.Cartesian3.fromDegrees(this._t12.TBaseX,this._t12.TBaseY,this._t12.TBaseZ),s=Freedo.Matrix4.multiplyByPoint(r,n,new Freedo.Cartesian3),a=Freedo.Cartographic.fromCartesian(s);this._t12.TMoveX=o(a.longitude),this._t12.TMoveY=o(a.latitude),this._t12.TMoveZ=a.height,this._mani.updatePosition(this._t12.TMoveX,this._t12.TMoveY,this._t12.TMoveZ),this._mani.updateBasePt(this._t12.TBaseX,this._t12.TBaseY,this._t12.TBaseZ),this._sceneSphere.center=Freedo.Cartesian3.fromDegrees(this._t12.TMoveX,this._t12.TMoveY,this._t12.TMoveZ)},i.prototype.getMatrix=function(e,t,i,o,r,n,s,a,h,l,c,d){var p=Freedo.Cartesian3.fromRadians(l,c,d),_=Freedo.Cartesian3.fromRadians(l+e,c+t,d+i);o=Freedo.Math.toRadians(o),r=Freedo.Math.toRadians(r),n=Freedo.Math.toRadians(n);var u=Freedo.Quaternion.fromHeadingPitchRoll(new Freedo.HeadingPitchRoll(o,r,n)),v=new Freedo.Cartesian3(s,a,h),f=Freedo.Matrix4.fromTranslationQuaternionRotationScale(new Freedo.Cartesian3,u,v),g=Freedo.Transforms.eastNorthUpToFixedFrame(p),y=Freedo.Matrix4.inverse(g,new Freedo.Matrix4),m=Freedo.Transforms.eastNorthUpToFixedFrame(_),C=Freedo.Matrix4.multiply(f,y,new Freedo.Matrix4),F=Freedo.Matrix4.multiply(m,C,new Freedo.Matrix4);return Freedo.clone(F,!0)},i.prototype.getMatrixOfTileset=function(e,t,i,o,r,n,s,a,h,l,c,d,p){if(void 0!==this._sceneMgr.getSceneObject(e)){if(void 0===c){var _=this.getTilesetBasePt(e);c=_.longitude,d=_.latitude,p=_.height}var u=Freedo.Cartesian3.fromRadians(c,d,p),v=Freedo.Cartesian3.fromRadians(c+t,d+i,p+o);r=Freedo.Math.toRadians(r),n=Freedo.Math.toRadians(n),s=Freedo.Math.toRadians(s);var f=Freedo.Quaternion.fromHeadingPitchRoll(new Freedo.HeadingPitchRoll(r,n,s)),g=new Freedo.Cartesian3(a,h,l),y=Freedo.Matrix4.fromTranslationQuaternionRotationScale(new Freedo.Cartesian3,f,g),m=Freedo.Transforms.eastNorthUpToFixedFrame(u),C=Freedo.Matrix4.inverse(m,new Freedo.Matrix4),F=Freedo.Transforms.eastNorthUpToFixedFrame(v),w=Freedo.Matrix4.multiply(y,C,new Freedo.Matrix4),b=Freedo.Matrix4.multiply(F,w,new Freedo.Matrix4);return Freedo.clone(b,!0)}},i.prototype.startTransform=function(e){if(this._bInTransform=!0,this._transType=e,this._aSceneObjectId.length>0){if(this.checkConflict())return;this._basePt=void 0,this.calcSceneBS();for(var t in this._aSceneObjectId){var i=this._sceneMgr._pModelMap[this._aSceneObjectId[t]];this._mouseDownMat=FreeDo.clone(i.modelMatrix,!0)}}var o=this;this._mani.on(function(e,t){"Transform"==e&&o.onTransform(),"Transformed"==e&&o.onTransformed(),"GotoPoint"==e&&o.onGotoPoint(t),"Transforming"==e&&o.onTransforming(t)}),this._transType.indexOf("MOVETO")>=0&&(this._inMoveTo=!0),this._mani.startTransform(this._transType),this._event.raiseEvent("Start",{}),this._aSceneObjectId.length>0&&(this._mani.updateSceneSphere(this._sceneSphere),this._mani.updatePosition(this._basePt.longitude,this._basePt.latitude,this._basePt.height),this._mani.updateBasePt(this._basePt.longitude,this._basePt.latitude,this._basePt.height))},i.prototype.start=function(e){this.startTransform(e)},i.prototype.setSceneObjectIDs=function(e){this._aSceneObjectId=FreeDo.clone(e,!0)},i.prototype.checkConflict=function(){var e=0,t=0;for(var i in this._aSceneObjectId){var o=(this._sceneMgr._pModelMap[this._aSceneObjectId[i]],this._sceneMgr.getSceneObjectProperty(this._aSceneObjectId[i],"transformTime"));if(0==t)e=void 0===o?void 0:Freedo.clone(o,!0);else if(o!==e)return alert("编辑状态存在冲突无法继续！"),this.cancelTransform(),!0;t++}return!1},i.prototype.initTransform=function(){var e=0,t=0;for(var i in this._aSceneObjectId){var o=(this._sceneMgr._pModelMap[this._aSceneObjectId[i]],this._sceneMgr.getSceneObjectProperty(this._aSceneObjectId[i],"transformTime"));0==t?e=void 0===o?void 0:Freedo.clone(o,!0):o!==e&&console.log("部分模型存在变换，部分没有，请注意"),t++}for(var i in this._aSceneObjectId){var e=(this._sceneMgr._pModelMap[this._aSceneObjectId[i]],this._sceneMgr.getSceneObjectProperty(this._aSceneObjectId[i],"transformTime"));void 0!==e&&0!=e||this.resetTransform();var o=this._sceneMgr.getSceneObjectProperty(this._aSceneObjectId[i],"transformMatrix");void 0!==o&&(this._t12=FreeDo.clone(o,!0)),this._event.raiseEvent("InitTransform",FreeDo.clone(this._t12,!0))}this.cancelTransform()},i.prototype.updateBasePt=function(){this._basePt={longitude:Freedo.Math.toRadians(this._t12.TMoveX),latitude:Freedo.Math.toRadians(this._t12.TMoveY),height:this._t12.TMoveZ}},i.prototype.calcSceneBS=function(){var e=[];for(var t in this._aSceneObjectId){var i=this._sceneMgr._pModelMap[this._aSceneObjectId[t]];void 0===i&&console.log("FdTransform：无效数据"),e.push(i.boundingSphere),void 0===this._basePt&&(this._basePt=this._sceneMgr.getSceneObjectProperty(this._aSceneObjectId[t],"basePoint"))}this._sceneSphere=FreeDo.BoundingSphere.fromBoundingSpheres(e,new FreeDo.BoundingSphere),void 0===this._basePt&&(this._basePt=Freedo.Cartographic.fromCartesian(this._sceneSphere.center),this._basePt.longitude=Freedo.Math.toDegrees(this._basePt.longitude),this._basePt.latitude=Freedo.Math.toDegrees(this._basePt.latitude))},i.prototype.calcXYZDist=function(e,t,i,o,r,n){return[o-e,r-t,n-i]},i.prototype.calcAxisZoom=function(){if(!1===this._bInClip)return void(this._axisZoom=1);var e=this._sceneSphere.center,t=this._project.getCamera()._camera.positionWC,i=1;i=Freedo.Cartesian3.distance(e,t)/6,this._project.getCamera()._camera.getPixelSize(this._sceneSphere,10,10),this._axisZoom=i,this._viewer.scene._mode===Freedo.SceneMode.COLUMBUS_VIEW&&(this._axisZoom=this._project.getCamera()._camera.positionWC.x/6),this._axisZoom>4e5&&(this._axisZoom=4e5),this._axisZoom<1&&(this._axisZoom=1)},i.prototype.onTransforming=function(e){var t=e.MouseDownPos,i=e.MouseMovePos,o=e.SelectedAxis,r=e.FixedAxis;this._selectedAxis=o;var n=[0,0,0],s=1,a=1,h=1,l=0,c=0,d=0;this.calcAxisZoom();var p=void 0;Freedo.defined(t)&&(p=Freedo.Cartesian3.fromRadians(t.longitude,t.latitude,t.height));var _=void 0;Freedo.defined(i)&&(_=Freedo.Cartesian3.fromRadians(i.longitude,i.latitude,i.height));var u=0,v=0;p&&(u=Freedo.Cartesian3.distance(p,this._sceneSphere.center)),_&&(v=Freedo.Cartesian3.distance(_,this._sceneSphere.center));var f=Freedo.clone(this._mouseDown12Arg,!0);if(this._aSceneObjectId.length>0&&this.calcSceneBS(),"XY"===o&&(n=this.calcXYZDist(t.longitude,t.latitude,t.height,i.longitude,i.latitude,t.height)),"YZ"===o&&(n=this.calcXYZDist(t.longitude,t.latitude,t.height,t.longitude,i.latitude,i.height)),"XZ"===o&&(n=this.calcXYZDist(t.longitude,t.latitude,t.height,i.longitude,t.latitude,i.height)),"X"===r&&(n=this.calcXYZDist(t.longitude,t.latitude,t.height,i.longitude,t.latitude,t.height)),"Y"===r&&(n=this.calcXYZDist(t.longitude,t.latitude,t.height,t.longitude,i.latitude,t.height)),"Z"===r&&(n[0]=0,n[1]=0,n[2]=-1*(e.MouseMoveXY.y-e.MouseDownXY.y)*this._axisZoom/100),this._transType.indexOf("SCALE")>=0&&"XY_QCIRCLE"===o){var g=v/u;s=g,a=g,h=g}var y={};if(y.longitude=this._t12.TBaseX,y.latitude=this._t12.TBaseY,y.height=this._t12.TBaseZ,this._transType.indexOf("ROTATE")>=0&&"XY_CIRCLE"===o){y=Freedo.Cartographic.fromCartesian(this._sceneSphere.center);var m=FreeDo.Cartesian3.fromRadians(y.longitude+.01,y.latitude,y.height),C=FreeDo.Cartesian3.subtract(m,this._sceneSphere.center,new FreeDo.Cartesian3),F=FreeDo.Cartesian3.subtract(p,this._sceneSphere.center,new FreeDo.Cartesian3),w=FreeDo.Cartesian3.subtract(_,this._sceneSphere.center,new FreeDo.Cartesian3),b=Freedo.Math.toDegrees(FreeDo.Cartesian3.angleBetween(w,C)),P=Freedo.Math.toDegrees(FreeDo.Cartesian3.angleBetween(F,C));t.latitude<y.latitude&&(P=360-P),i.latitude<y.latitude&&(b=360-b),l=P-b}if(this._transType.indexOf("ROTATE")>=0&&"XZ_CIRCLE"===o){if(!Freedo.defined(p))return;y=Freedo.Cartographic.fromCartesian(this._sceneSphere.center);var m=FreeDo.Cartesian3.fromRadians(y.longitude+.01,y.latitude,y.height),C=FreeDo.Cartesian3.subtract(m,this._sceneSphere.center,new FreeDo.Cartesian3),F=FreeDo.Cartesian3.subtract(p,this._sceneSphere.center,new FreeDo.Cartesian3),w=FreeDo.Cartesian3.subtract(_,this._sceneSphere.center,new FreeDo.Cartesian3),b=Freedo.Math.toDegrees(FreeDo.Cartesian3.angleBetween(w,C)),P=Freedo.Math.toDegrees(FreeDo.Cartesian3.angleBetween(F,C));t.height<y.height&&(P=360-P),i.height<y.height&&(b=360-b),c=b-P}if(this._transType.indexOf("ROTATE")>=0&&"YZ_CIRCLE"===o){if(!Freedo.defined(p))return;y=Freedo.Cartographic.fromCartesian(this._sceneSphere.center);var m=FreeDo.Cartesian3.fromRadians(y.longitude,y.latitude+.01,y.height),C=FreeDo.Cartesian3.subtract(m,this._sceneSphere.center,new FreeDo.Cartesian3),F=FreeDo.Cartesian3.subtract(p,this._sceneSphere.center,new FreeDo.Cartesian3),w=FreeDo.Cartesian3.subtract(_,this._sceneSphere.center,new FreeDo.Cartesian3),b=Freedo.Math.toDegrees(FreeDo.Cartesian3.angleBetween(w,C)),P=Freedo.Math.toDegrees(FreeDo.Cartesian3.angleBetween(F,C));t.height<y.height&&(P=360-P),i.height<y.height&&(b=360-b),d=b-P}var T={TMoveX:n[0],TMoveY:n[1],TMoveZ:n[2],THeading:l,TPitch:c,TRoll:d,TScaleX:s,TScaleY:a,TScaleZ:h};if(f.DMoveX+=Freedo.Math.toDegrees(T.TMoveX),f.DMoveY+=Freedo.Math.toDegrees(T.TMoveY),f.DMoveZ+=T.TMoveZ,f.THeading+=T.THeading,f.TPitch+=T.TPitch,f.TRoll+=T.TRoll,f.TScaleX*=T.TScaleX,f.TScaleY*=T.TScaleY,f.TScaleZ*=T.TScaleZ,this._t12.DMoveX=f.DMoveX,this._t12.DMoveY=f.DMoveY,this._t12.DMoveZ=f.DMoveZ,this._t12.THeading=f.THeading,this._t12.TPitch=f.TPitch,this._t12.TRoll=f.TRoll,this._t12.TScaleX=f.TScaleX,this._t12.TScaleY=f.TScaleY,this._t12.TScaleZ=f.TScaleZ,this.refineArgs(),this._event.raiseEvent("Transforming",FreeDo.clone(this._t12,!0)),this._aSceneObjectId.length>0){for(var M in this._aSceneObjectId){y=this.getTilesetBasePt(this._aSceneObjectId[M]);this._sceneMgr._pModelMap[this._aSceneObjectId[M]];this.applyTransformToTileset(this._aSceneObjectId[M],Freedo.Math.toRadians(f.DMoveX),Freedo.Math.toRadians(f.DMoveY),f.DMoveZ,f.THeading,f.TPitch,f.TRoll,f.TScaleX,f.TScaleY,f.TScaleZ,Freedo.Math.toRadians(this._basePt.longitude),Freedo.Math.toRadians(this._basePt.latitude),this._basePt.height)}this._t12.TMoveX=Freedo.Math.toDegrees(y.longitude+f.TMoveX),this._t12.TMoveY=Freedo.Math.toDegrees(y.latitude+f.TMoveY),this._t12.TMoveZ=y.height+f.TMoveZ,this.calcSceneBS(),this._mani.updateSceneSphere(this._sceneSphere)}},i.prototype.refineArgs=function(){for(var e in this._aSceneObjectId){var i=this._sceneMgr._pModelMap[this._aSceneObjectId[e]],o=FreeDo.Matrix4.getScale(i.modelMatrix,new FreeDo.Cartesian3);this._t12.THeading>360&&(this._t12.THeading-=360),this._t12.THeading<-360&&(this._t12.THeading+=360),this._t12.TPitch>360&&(this._t12.TPitch-=360),this._t12.TPitch<-360&&(this._t12.TPitch+=360),this._t12.TRoll>360&&(this._t12.TRoll-=360),this._t12.TRoll<-360&&(this._t12.TRoll+=360),this._t12.TMoveX=t.round(this._t12.TMoveX,8),this._t12.TMoveY=t.round(this._t12.TMoveY,8),this._t12.TMoveZ=t.round(this._t12.TMoveZ,6),this._t12.THeading=t.round(this._t12.THeading,4),this._t12.TPitch=t.round(this._t12.TPitch,4),this._t12.TRoll=t.round(this._t12.TRoll,4),this._t12.TScaleX=t.round(o.x,4),this._t12.TScaleY=t.round(o.y,4),this._t12.TScaleZ=t.round(o.z,4)}},i.prototype.onGotoPoint=function(e){if(e.type!=this.PositionType.NONE&&this._inMoveTo){var t=Freedo.Cartographic.fromCartesian(e.position);if(void 0!==t){var i=FreeDo.clone(this._t12,!0);i.TMoveX=t.longitude,i.TMoveY=t.latitude;for(var o in this._aSceneObjectId){var r=this.getTilesetBasePt(this._aSceneObjectId[o]),n=i.TMoveX-r.longitude,s=i.TMoveY-r.latitude,a=i.TMoveZ-r.height;this.applyTransformToTileset(this._aSceneObjectId[o],parseFloat(n),parseFloat(s),parseFloat(a),parseFloat(i.THeading),parseFloat(i.TPitch),parseFloat(i.TRoll),parseFloat(i.TScaleX),parseFloat(i.TScaleY),parseFloat(i.TScaleZ),Freedo.Math.toRadians(this._t12.TBaseX),Freedo.Math.toRadians(this._t12.TBaseY),this._t12.TBaseZ)}i.TMoveX=Freedo.Math.toDegrees(i.TMoveX),i.TMoveY=Freedo.Math.toDegrees(i.TMoveY),i.TMoveZ=i.TMoveZ,this._t12=FreeDo.clone(i,!0),this.refineArgs(),""!==this._transType&&(this.calcSceneBS(),this._mani.update(this._sceneSphere)),this._event.raiseEvent("Transformed",FreeDo.clone(this._t12,!0))}this._inMoveTo=!1}},i.prototype.onTransform=function(e){this._event.raiseEvent("Transform",{}),this.refineArgs(),this._mouseDown12Arg=Freedo.clone(this._t12,!0)},i.prototype.onTransformed=function(e){this.refineArgs(),this._event.raiseEvent("Transformed",FreeDo.clone(this._t12,!0))},i.prototype.getTilesetBasePt=function(e){var t=this._sceneMgr.getSceneObject(e);if(void 0!==t){var i=Freedo.clone(t._root.transform,!0),o=FreeDo.Matrix4.getTranslation(i,new FreeDo.Cartesian3);return Freedo.Cartographic.fromCartesian(o)}},i.prototype.applyTransformToTileset=function(e,t,i,o,r,n,s,a,h,l,c,d,p){this._sceneMgr.getSceneObject(e).modelMatrix=this.getMatrixOfTileset(e,t,i,o,r,n,s,a,h,l,c,d,p)},i.prototype.applyTransform=function(e,t,i,o,r,n,s,a,h){if(!this.checkConflict()){this.calcSceneBS();try{e=parseFloat(e),t=parseFloat(t),i=parseFloat(i),o=parseFloat(o),r=parseFloat(r),n=parseFloat(n),s=parseFloat(s),a=parseFloat(a),h=parseFloat(h)}catch(e){return}if(!(isNaN(e)||isNaN(t)||isNaN(i)||isNaN(o)||isNaN(r)||isNaN(n)||isNaN(s)||isNaN(a)||isNaN(h))){for(var l in this._aSceneObjectId){var c=this.getTilesetBasePt(this._aSceneObjectId[l]),d=Freedo.Math.toRadians(e)-c.longitude,p=Freedo.Math.toRadians(t)-c.latitude,_=i-c.height;this.applyTransformToTileset(this._aSceneObjectId[l],parseFloat(d),parseFloat(p),parseFloat(_),parseFloat(o),parseFloat(r),parseFloat(n),parseFloat(s),parseFloat(a),parseFloat(h),Freedo.Math.toRadians(this._basePt.longitude),Freedo.Math.toRadians(this._basePt.latitude),this._basePt.height)}this._t12.TMoveX=e,this._t12.TMoveY=t,this._t12.TMoveZ=i,this._t12.THeading=o,this._t12.TPitch=r,this._t12.TRoll=n,this._t12.TScaleX=s,this._t12.TScaleY=a,this._t12.TScaleZ=h,this.refineArgs(),""!==this._transType&&(this.calcSceneBS(),this._mani.update(this._sceneSphere)),this._event.raiseEvent("Transformed",FreeDo.clone(this._t12,!0))}}},i.prototype.reset12Args=function(){if(!this.checkConflict()){var e=void 0;for(var t in this._aSceneObjectId){var e=this.getTilesetBasePt(this._aSceneObjectId[t]);break}void 0===e&&console.log("reset12Args: 出错"),this._t12.TMoveX=Freedo.Math.toDegrees(e.longitude),this._t12.TMoveY=Freedo.Math.toDegrees(e.latitude),this._t12.TMoveZ=e.height,this._t12.THeading=0,this._t12.TPitch=0,this._t12.TRoll=0,this._t12.TScaleX=1,this._t12.TScaleY=1,this._t12.TScaleZ=1,this.refineArgs(),this._basePt=void 0}},i.prototype.resetTransform=function(){this.reset12Args();for(var e in this._aSceneObjectId){var t=this._sceneMgr._pModelMap[this._aSceneObjectId[e]];this._sceneMgr.setSceneObjectProperty(this._aSceneObjectId[e],"initialMatrix",FreeDo.clone(FreeDo.Matrix4.IDENTITY,!0)),this._sceneMgr.setSceneObjectProperty(this._aSceneObjectId[e],"transformMatrix",FreeDo.clone(this._t12,!0)),this._sceneMgr.setSceneObjectProperty(this._aSceneObjectId[e],"transformTime",0),this._sceneMgr.setSceneObjectProperty(this._aSceneObjectId[e],"basePoint",this._basePt),t.modelMatrix=FreeDo.clone(FreeDo.Matrix4.IDENTITY,!0)}this.calcSceneBS(),this._bInTransform&&this._mani.update(this._sceneSphere),this._event.raiseEvent("resetTransform",FreeDo.clone(this._t12,!0))},i.prototype.saveTransform=function(){var e=Date.parse(new Date);for(var t in this._aSceneObjectId){var i=this._sceneMgr._pModelMap[this._aSceneObjectId[t]];this._sceneMgr.setSceneObjectProperty(this._aSceneObjectId[t],"initialMatrix",FreeDo.clone(i.modelMatrix,!0)),this._sceneMgr.setSceneObjectProperty(this._aSceneObjectId[t],"transformMatrix",FreeDo.clone(this._t12,!0)),this._sceneMgr.setSceneObjectProperty(this._aSceneObjectId[t],"transformTime",e);void 0==this._sceneMgr.getSceneObjectProperty(this._aSceneObjectId[t],"basePoint")&&this._sceneMgr.setSceneObjectProperty(this._aSceneObjectId[t],"basePoint",this._basePt)}},i.prototype.cancelTransform=function(){this.reset()},i.prototype.cancel=function(){this.reset()},i.prototype.reset=function(){this._bInTransform=!1,this._mani.reset(),this._transType="",this._event.raiseEvent("Cancel",{})},i.prototype.dispose=function(){this.reset()},i}.apply(t,o))&&(e.exports=r)},function(e,t,i){var o,r;o=[i(0)],void 0!==(r=function(e){"use strict";function t(e){this._viewer=e.getViewer(),this._project=e,this._sceneMgr=e.getSceneManager(),this._bInTransform=!1,this._transType="MOVE",this._bInRun=!1,this._xAxisPL=void 0,this._yAxisPL=void 0,this._zAxisPL=void 0,this._XYPlane=void 0,this._YZPlane=void 0,this._XZPlane=void 0,this._XYCircle=void 0,this._XZCircle=void 0,this._YZCircle=void 0,this._basePt=void 0,this._basePtOriPosition=void 0,this._basePtOri=void 0,this._selectedAxis="",this._mouseDownPos=void 0,this._initSphere=void 0,this._useDepthPicking=!0,this._pickTranslucentDepth=!0,this._fixedAxis="",this._DISPERRAD=111e3,this._event=new Freedo.Event,this._eventHelper=new Freedo.EventHelper,this._oldPt=void 0,this._started=!1,this._mouseDown=!1,this._lastDis=-1,this._alpha=.5,this._axisZoom=1,this.PositionType={NONE:0,ON_MODEL:1,ON_TERRAIN:2,ON_ELLIPSOID:3},this._handler=void 0,this._mouseDownXY=void 0}t.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)},t.prototype.startTransform=function(e){this._transType=e,this._bInTransform||(this._bInTransform=!0,this.addListeners(),this._bInRun=!0)},t.prototype.start=function(e){this.startTransform(e)},t.prototype.redraw=function(){this.calcAxisZoom()},t.prototype.updateSceneSphere=function(e){this._initSphere=FreeDo.clone(e,!0),void 0===this._xAxisPL&&this.showAxis()},t.prototype.updatePosition=function(e,t,i){var o=Freedo.Cartesian3.fromDegrees(e,t,i);this._initSphere={center:o},void 0===this._xAxisPL&&this.showAxis()},t.prototype.updateBasePt=function(e,t,i){this._basePtOriPosition=Freedo.Cartesian3.fromDegrees(e,t,i)},t.prototype.cancelTransform=function(){this.reset()},t.prototype.cancel=function(){this.reset()},t.prototype.addListeners=function(){this._handler=new Freedo.ScreenSpaceEventHandler(this._viewer.scene.canvas),this._handler.setInputAction(this.onLeftDown.bind(this),FreeDo.ScreenSpaceEventType.LEFT_DOWN),this._handler.setInputAction(this.onMouseMove.bind(this),FreeDo.ScreenSpaceEventType.MOUSE_MOVE),this._handler.setInputAction(this.onLeftUp.bind(this),FreeDo.ScreenSpaceEventType.LEFT_UP),this._handler.setInputAction(this.onWheel.bind(this),FreeDo.ScreenSpaceEventType.WHEEL),this._handler.setInputAction(this.onClick.bind(this),FreeDo.ScreenSpaceEventType.LEFT_CLICK);var e=this;this._project.getCamera().on(function(t,i){"Changed"==t&&e.onWheel()}),window.addEventListener("keydown",this.onKeyDown.bind(this))},t.prototype.calcFixedAxis=function(){return"X_AXIS"===this._selectedAxis?void(this._fixedAxis="X"):"Y_AXIS"===this._selectedAxis?void(this._fixedAxis="Y"):"Z_AXIS"===this._selectedAxis?void(this._fixedAxis="Z"):void 0},t.prototype.calcAxisZoom=function(){if(!1===this._bInTransform)return void(this._axisZoom=1);if(this._initSphere){var e=this._initSphere.center,t=this._project.getCamera()._camera.positionWC,i=1,i=Freedo.Cartesian3.distance(e,t)/6;this._axisZoom=i,this._viewer.scene._mode===Freedo.SceneMode.COLUMBUS_VIEW&&(this._axisZoom=this._project.getCamera()._camera.positionWC.x/3),this._axisZoom>4e5&&(this._axisZoom=4e5)}},t.prototype.onWheel=function(){!1!==this._bInTransform&&this.calcAxisZoom()},t.prototype.onKeyDown=function(){!1!==this._bInTransform&&27===window.event.keyCode&&""!==this._selectedAxis&&(this._event.raiseEvent("OnKeyDown",{keyCode:window.event.keyCode}),this._selectedAxis="",this.onLeftUp())},t.prototype.onMouseMove=function(e){if(""!=this._selectedAxis){var t=void 0;return"XY_QCIRCLE"!==this._selectedAxis&&"XY_CIRCLE"!==this._selectedAxis&&"X_AXIS"!==this._selectedAxis&&"Y_AXIS"!==this._selectedAxis&&"Z_AXIS"!==this._selectedAxis||(t=this.pickPositionOnEllipsoid(e.endPosition)),"YZ"!==this._selectedAxis&&"YZ_CIRCLE"!==this._selectedAxis||(t=this.pickPositionOnPlane(e.endPosition,"YZ")),"XZ"!==this._selectedAxis&&"XZ_CIRCLE"!==this._selectedAxis||(t=this.pickPositionOnPlane(e.endPosition,"XZ")),void this._event.raiseEvent("Transforming",{MouseDownPos:this._mouseDownPos,MouseMovePos:t,MouseDownXY:this._mouseDownXY,MouseMoveXY:e.endPosition,SelectedAxis:this._selectedAxis,FixedAxis:this._fixedAxis})}},t.prototype.onClick=function(e){var t=this.pickPosition(e.position);this._event.raiseEvent("GotoPoint",t)},t.prototype.onLeftDown=function(e){if(this._bInTransform){this._mouseDown=!0,this._oldPt=void 0,this._started=!1,this._lastDis=-1;var t=this._viewer.scene.pick(e.position);if(FreeDo.defined(t)){if(FreeDo.defined(t.id)&&FreeDo.defined(t.id._name)){var i=t.id._name;("X_AXIS"===i||"Y_AXIS"===i||"Z_AXIS"===i)&&this._transType.indexOf("MOVE")>=0&&(t.id.polyline.material.color=new Freedo.Color(1,1,0,1)),"YZ"!==i&&"XZ"!==i||(t.id.wall.material.color=new Freedo.Color(1,0,0,.2)),"XY_QCIRCLE"===i&&(t.id.polygon.material.color=new Freedo.Color(1,1,0,1)),"XY_CIRCLE"!==i&&"YZ_CIRCLE"!==i&&"XZ_CIRCLE"!==i||(t.id.polyline.material.color=new Freedo.Color(1,1,0,1)),"XY_CIRCLE"!==i&&"XZ_CIRCLE"!==i&&"YZ_CIRCLE"!==i&&"XY_QCIRCLE"!==i&&"XZ"!==i&&"YZ"!==i&&"X_AXIS"!==i&&"Y_AXIS"!==i&&"Z_AXIS"!==i||(this._selectedAxis=FreeDo.clone(i,!0),this._viewer.scene.screenSpaceCameraController.enableRotate=!1,this._viewer.scene.screenSpaceCameraController.enableLook=!1,this._mouseDownPos=void 0,this._event.raiseEvent("Transform",{}))}"XY_QCIRCLE"!==this._selectedAxis&&"XY_CIRCLE"!==this._selectedAxis&&"X_AXIS"!==this._selectedAxis&&"Y_AXIS"!==this._selectedAxis||(this._mouseDownPos=this.pickPositionOnEllipsoid(e.position),this._transType.indexOf("MOVE")>=0&&this.calcFixedAxis()),"YZ"!==this._selectedAxis&&"YZ_CIRCLE"!==this._selectedAxis||(this._mouseDownPos=this.pickPositionOnPlane(e.position,"YZ"),this._transType.indexOf("MOVE")>=0&&this.calcFixedAxis()),"XZ"!==this._selectedAxis&&"Z_AXIS"!==this._selectedAxis&&"XZ_CIRCLE"!==this._selectedAxis||(this._mouseDownPos=this.pickPositionOnPlane(e.position,"XZ"),this._transType.indexOf("MOVE")>=0&&this.calcFixedAxis()),"X"===this._fixedAxis&&(this._xAxisPL.polyline.material.color=FreeDo.Color.YELLOW),"Y"===this._fixedAxis&&(this._yAxisPL.polyline.material.color=FreeDo.Color.YELLOW),"Z"===this._fixedAxis&&(this._zAxisPL.polyline.material.color=FreeDo.Color.YELLOW),this._mouseDownXY=e.position}}},t.prototype.backToEnableRotate=function(e){""===this._selectedAxis&&(this._viewer.scene.screenSpaceCameraController.enableRotate=!0,this._viewer.scene.screenSpaceCameraController.enableLook=!0)},t.prototype.onLeftUp=function(e){setTimeout(this.backToEnableRotate.bind(this),500),this._mouseDownPos=void 0,this._mouseDown=!1,"XY_QCIRCLE"===this._selectedAxis&&(this._XYPlane.polygon.material.color=new Freedo.Color(0,0,1,this._alpha)),"XZ"===this._selectedAxis&&(this._XZPlane.wall.material.color=new Freedo.Color(1,0,1,this._alpha)),"YZ"===this._selectedAxis&&(this._YZPlane.wall.material.color=new Freedo.Color(0,1,1,this._alpha)),"XY_CIRCLE"===this._selectedAxis&&(this._XYCircle.polyline.material.color=new Freedo.Color(0,0,1,this._alpha)),"XZ_CIRCLE"===this._selectedAxis&&(this._XZCircle.polyline.material.color=new Freedo.Color(0,1,0,this._alpha)),"YZ_CIRCLE"===this._selectedAxis&&(this._YZCircle.polyline.material.color=new Freedo.Color(1,0,0,this._alpha)),"X"===this._fixedAxis&&(this._xAxisPL.polyline.material.color=FreeDo.Color.RED),"Y"===this._fixedAxis&&(this._yAxisPL.polyline.material.color=FreeDo.Color.GREEN),"Z"===this._fixedAxis&&(this._zAxisPL.polyline.material.color=FreeDo.Color.BLUE),""!==this._selectedAxis&&this._event.raiseEvent("Transformed",{}),this.calcAxisZoom(),this._selectedAxis="",this._fixedAxis=""},t.prototype.clearAxis=function(){void 0!=this._xAxisPL&&(this._viewer.entities.remove(this._basePt),this._viewer.entities.remove(this._basePtOri),this._viewer.entities.remove(this._xAxisPL),this._viewer.entities.remove(this._yAxisPL),this._viewer.entities.remove(this._zAxisPL),this._viewer.entities.remove(this._XZPlane),this._viewer.entities.remove(this._YZPlane),this._viewer.entities.remove(this._XYPlane),this._viewer.entities.remove(this._XYCircle),this._viewer.entities.remove(this._XZCircle),this._viewer.entities.remove(this._YZCircle)),this._selectedAxis=""};var i=void 0,o=void 0,r=void 0,n=void 0,s=void 0,a=void 0;return t.prototype.calcCallbackArgs=function(){i=this._initSphere.center,r=Freedo.Cartographic.fromCartesian(i),n=Freedo.Math.toDegrees(r.longitude),s=Freedo.Math.toDegrees(r.latitude),a=r.height,o=this._axisZoom},t.prototype.pickPositionOnEllipsoid=function(e){var t=Freedo.Cartographic.fromCartesian(this._initSphere.center),i=Freedo.clone(Freedo.Ellipsoid.WGS84,!0);i.radii.x+=t.height,i.radii.y+=t.height,i.radii.z+=t.height;var o=new Freedo.Ellipsoid(i.radii.x,i.radii.y,i.radii.z),r=this._viewer.camera.pickEllipsoid(e,o,new Freedo.Cartesian3);if(void 0!==r){return Freedo.Cartographic.fromCartesian(r)}},t.prototype.pickPositionOnPlane=function(e,t){this.calcCallbackArgs();var i=1e-5*this._axisZoom,n=Freedo.Cartesian3.fromRadians(r.longitude-i,r.latitude,-2e3),s=Freedo.Cartesian3.fromRadians(r.longitude,r.latitude,r.height+.95*o+1e3),a=Freedo.Cartesian3.fromRadians(r.longitude+i,r.latitude,-2e3);"YZ"===t&&(n=Freedo.Cartesian3.fromRadians(r.longitude,r.latitude-i,-2e3),s=Freedo.Cartesian3.fromRadians(r.longitude,r.latitude,r.height+.95*o+1e3),a=Freedo.Cartesian3.fromRadians(r.longitude,r.latitude+i,-2e3));var h=this._viewer.camera.getPickRay(e),l=0,c=0,d=Freedo.Cartographic.fromCartesian(this._initSphere.center);l=Math.cos(d.longitude),c=Math.sin(d.longitude);var p=(new Freedo.Plane.fromPointNormal(new Freedo.Cartesian3(0,0,0),new Freedo.Cartesian3(l,c,0)),{});p.x=h.origin.x+1e6*h.direction.x,p.y=h.origin.y+1e6*h.direction.y,p.z=h.origin.z+1e6*h.direction.z;var _=Freedo.IntersectionTests.lineSegmentTriangle(h.origin,p,n,s,a);if(void 0!==_){return Freedo.Cartographic.fromCartesian(_)}},t.prototype.pickPosition=function(e){var t,i,o=this.PositionType.NONE;if(this._viewer.scene.pickPositionSupported){var i=this._viewer.scene.drillPick(e);if(Freedo.defined(i)&&i.length>0)for(var r=0;r<i.length;++r)if(i[r]instanceof Freedo.FreedoPModelFeature&&(t=this._viewer.scene.pickPosition(e),Freedo.defined(t))){o=this.PositionType.ON_MODEL;break}}if(o===this.PositionType.NONE){if(this._useDepthPicking=FreeDo.clone(this._viewer.scene.useDepthPicking,!0),this._pickTranslucentDepth=FreeDo.clone(this._viewer.scene.pickTranslucentDepth,!0),this._viewer.scene.pickPositionSupported){t=this._viewer.scene.pickPosition(e,new Freedo.Cartesian3);Freedo.Cartographic.fromCartesian(t);Freedo.defined(t)&&(o=this.PositionType.ON_TERRAIN)}this._viewer.scene.useDepthPicking=FreeDo.clone(this._useDepthPicking,!0),this._viewer.scene.pickTranslucentDepth=FreeDo.clone(this._pickTranslucentDepth,!0)}return o===this.PositionType.NONE&&(t=this._viewer.camera.pickEllipsoid(e,this._viewer.scene.globe.ellipsoid),Freedo.defined(t)&&(o=this.PositionType.ON_ELLIPSOID)),{type:o,position:t}},t.prototype.callbackXY=function(t,i){this.calcCallbackArgs();var a=e.getLongAndLatRatio(r),h=FreeDo.Math.toDegrees(.5*o*a[0]),l=FreeDo.Math.toDegrees(.5*o*a[1]);return Freedo.Cartesian3.fromDegreesArray([n,s,n+h,s,n+h,s+l,n,s+l,n,s])},t.prototype.callbackQXY=function(t,i){this.calcCallbackArgs();var h=[],l=e.getLongAndLatRatio(r),c=FreeDo.Math.toDegrees(.55*o*l[0]),d=FreeDo.Math.toDegrees(.55*o*l[1]);h.push(Freedo.Cartesian3.fromRadians(r.longitude,r.latitude,r.height));for(var p=0;p<=Math.PI/2;p+=.001){var _=n+c*Math.cos(p),u=s+d*Math.sin(p),v=Freedo.Cartesian3.fromDegrees(_,u,a);h.push(v)}return h},t.prototype.callbackXYHalfCircle=function(t,i){this.calcCallbackArgs();for(var h=[],l=e.getLongAndLatRatio(r),c=FreeDo.Math.toDegrees(.65*o*l[0]),d=FreeDo.Math.toDegrees(.65*o*l[1]),p=0;p<=Math.PI/2;p+=.001){var _=n+c*Math.cos(p),u=s+d*Math.sin(p),v=Freedo.Cartesian3.fromDegrees(_,u,a);h.push(v)}return h},t.prototype.callbackXZHalfCircle=function(t,i){this.calcCallbackArgs();for(var h=e.getLongAndLatRatio(r),l=FreeDo.Math.toDegrees(.65*o*h[0]),c=(FreeDo.Math.toDegrees(.65*o*h[1]),[]),d=Math.PI/2;d>=0;d-=.001){var p=n+l*Math.cos(d),_=s,u=a+.65*o*Math.sin(d),v=Freedo.Cartesian3.fromDegrees(p,_,u);c.push(v)}return c},t.prototype.callbackYZHalfCircle=function(t,i){this.calcCallbackArgs();for(var h=e.getLongAndLatRatio(r),l=(FreeDo.Math.toDegrees(.65*o*h[0]),FreeDo.Math.toDegrees(.65*o*h[1])),c=[],d=Math.PI/2;d>=0;d-=.001){var p=n,_=s+l*Math.cos(d),u=a+.65*o*Math.sin(d),v=Freedo.Cartesian3.fromDegrees(p,_,u);c.push(v)}return c},t.prototype.callbackXYShow=function(e,t){return this.calcCallbackArgs(),t=!0,"XY_CIRCLE"==this._selectedAxis&&(t=!1),t},t.prototype.callbackXYH=function(e,t){return a+.1},t.prototype.callbackXZ=function(t,i){this.calcCallbackArgs();var a=e.getLongAndLatRatio(r),h=FreeDo.Math.toDegrees(.5*o*a[0]);return Freedo.Cartesian3.fromDegreesArray([n,s,n+h,s])},t.prototype.callbackXZMinimumHeights=function(e,t){return this.calcCallbackArgs(),[a,a]},t.prototype.callbackXZMaximumHeights=function(e,t){return this.calcCallbackArgs(),[a+.5*o,a+.5*o]},t.prototype.callbackYZ=function(e,t){return this.calcCallbackArgs(),Freedo.Cartesian3.fromDegreesArray([n,s,n,s+.5*o/this._DISPERRAD])},t.prototype.callbackXYCCBP=function(e,t){return this.calcCallbackArgs(),Freedo.Cartesian3.fromDegrees(n,s)},t.prototype.callbackX=function(t,i){this.calcCallbackArgs();var h=e.getLongAndLatRatio(r),l=FreeDo.Math.toDegrees(o*h[0]);return Freedo.Cartesian3.fromDegreesArrayHeights([n,s,a,n+l,s,a])},t.prototype.callbackY=function(e,t){return this.calcCallbackArgs(),Freedo.Cartesian3.fromDegreesArrayHeights([n,s,a,n,s+o/this._DISPERRAD,a])},t.prototype.callbackZ=function(e,t){return this.calcCallbackArgs(),Freedo.Cartesian3.fromDegreesArrayHeights([n,s,a,n,s,a+o])},t.prototype.callbackH=function(e,t){return this.calcCallbackArgs(),a},t.prototype.callbackBasePt=function(e,t){return this.calcCallbackArgs(),i.clone()},t.prototype.callbackBasePtOri=function(e,t){return this._basePtOriPosition.clone()},t.prototype.showAxis=function(){this.clearAxis(),this.calcAxisZoom();var e=(new Freedo.CallbackProperty(this.callbackXY.bind(this),!1),new Freedo.CallbackProperty(this.callbackQXY.bind(this),!1)),t=new Freedo.CallbackProperty(this.callbackXYHalfCircle.bind(this),!1),i=new Freedo.CallbackProperty(this.callbackXZHalfCircle.bind(this),!1),o=new Freedo.CallbackProperty(this.callbackYZHalfCircle.bind(this),!1),r=(new Freedo.CallbackProperty(this.callbackXYShow.bind(this),!1),new Freedo.CallbackProperty(this.callbackXYH.bind(this),!1),new Freedo.CallbackProperty(this.callbackXZ.bind(this),!1),new Freedo.CallbackProperty(this.callbackXZMaximumHeights.bind(this),!1),new Freedo.CallbackProperty(this.callbackXZMinimumHeights.bind(this),!1),new Freedo.CallbackProperty(this.callbackYZ.bind(this),!1),new Freedo.CallbackProperty(this.callbackXYCCBP.bind(this),!1),new Freedo.CallbackProperty(this.callbackX.bind(this),!1)),n=new Freedo.CallbackProperty(this.callbackY.bind(this),!1),s=new Freedo.CallbackProperty(this.callbackZ.bind(this),!1),a=new Freedo.CallbackProperty(this.callbackH.bind(this),!1),h=new Freedo.CallbackProperty(this.callbackBasePt.bind(this),!1),l=new Freedo.CallbackProperty(this.callbackBasePtOri.bind(this),!1);this._basePt=this._viewer.entities.add({position:h,point:{pixelSize:10,color:Freedo.Color.YELLOW.withAlpha(.9)}}),this._basePtOri=this._viewer.entities.add({name:"xxxx",position:l,point:{pixelSize:10,color:Freedo.Color.YELLOW.withAlpha(.9)}}),this._xAxisPL=this._viewer.entities.add({name:"X_AXIS",polyline:{positions:r,width:16,followSurface:!1,material:new Freedo.PolylineArrowMaterialProperty(Freedo.Color.RED)}}),this._yAxisPL=this._viewer.entities.add({name:"Y_AXIS",polyline:{positions:n,width:16,followSurface:!1,material:new Freedo.PolylineArrowMaterialProperty(Freedo.Color.GREEN)}}),this._zAxisPL=this._viewer.entities.add({name:"Z_AXIS",polyline:{positions:s,width:16,show:!0,followSurface:!1,material:new Freedo.PolylineArrowMaterialProperty(Freedo.Color.BLUE)}}),this._transType.indexOf("SCALE")>=0&&(this._XYPlane=this._viewer.entities.add({name:"XY_QCIRCLE",polygon:{hierarchy:e,height:a,outline:!1,show:!0,outlineColor:Freedo.Color.WHITE,outlineWidth:0,material:new Freedo.Color(0,0,1,this._alpha)}})),this._transType.indexOf("ROTATE")>=0&&(this._XYCircle=this._viewer.entities.add({name:"XY_CIRCLE",polyline:{positions:t,width:4,show:!0,material:new Freedo.Color(0,0,1,this._alpha)}})),this._transType.indexOf("ROTATE")>=0&&(this._XZCircle=this._viewer.entities.add({name:"XZ_CIRCLE",polyline:{positions:i,width:4,show:!0,material:new Freedo.Color(0,1,0,this._alpha)}}),this._YZCircle=this._viewer.entities.add({name:"YZ_CIRCLE",polyline:{positions:o,width:4,show:!0,material:new Freedo.Color(1,0,0,this._alpha)}}))},t.prototype.reset=function(){void 0===this._handler||this._handler.isDestroyed()||this._handler.destroy(),this._bInTransform=!1,this.clearAxis(),this._mouseDownPos=void 0,this._initSphere=void 0,this._fixedAxis=""},t.prototype.dispose=function(){this.reset()},t}.apply(t,o))&&(e.exports=r)},function(e,t,i){function o(e){var t=new d(e).resolve(I);t.normalize();var i=t.authority;return/:/.test(i)||(i=i+":"+("https"===t.scheme?"443":"80")),i}function r(e,t){var i=o(e),n=f(E[i],0);if(!(n>=r.maximumRequestsPerServer))return E[i]=n+1,p(t(e),function(e){return E[i]--,e}).otherwise(function(e){return E[i]--,p.reject(e)})}function n(e){if(g(e)&&0!==e.length){return{Accept:"application/vnd.quantized-mesh;extensions="+e.join("-")+",application/octet-stream;q=0.9,*/*;q=0.01"}}return{Accept:"application/vnd.quantized-mesh,application/octet-stream;q=0.9,*/*;q=0.01"}}function s(e,t,i,o,r,n){var s;if(s=i<e.maxLevel?new Uint8Array([15])[0]:new Uint8Array([0])[0],t.byteLength>0){for(var a=new Int16Array(t,0,e._heightmapWidth*e._heightmapWidth),h=0,l=0;l<a.length;l++)h>a[l]&&(h=a[l]);for(var c=new Float32Array(a.length),l=0;l<a.length;l++)c[l]=a[l]-h;var d={heightScale:3,heightOffset:3*h,elementsPerHeight:1,stride:1,elementMultiplier:512,isBigEndian:!1,lowestEncodedHeight:0,highestEncodedHeight:262143};return new w({buffer:c,childTileMask:s,waterMask:new Uint8Array([0]),width:e._heightmapWidth,height:e._heightmapWidth,structure:d})}for(var c=new Uint16Array(e._heightmapWidth*e._heightmapWidth),l=0;l<c.byteLength;l++)c[l]=0;return new w({buffer:c,childTileMask:s,waterMask:new Uint8Array([0]),width:e._heightmapWidth,height:e._heightmapWidth,structure:e._heightmapStructure})}function a(e,t,i,o,r,n){function s(e){return e>>1^-(1&e)}var a=0,l=3*Float64Array.BYTES_PER_ELEMENT,c=4*Float64Array.BYTES_PER_ELEMENT,d=3*Uint16Array.BYTES_PER_ELEMENT,p=Uint16Array.BYTES_PER_ELEMENT,v=3*p,f=new DataView(t),g=new u(f.getFloat64(a,!0),f.getFloat64(a+8,!0),f.getFloat64(a+16,!0));a+=l;var y=f.getFloat32(a,!0);a+=Float32Array.BYTES_PER_ELEMENT;var m=f.getFloat32(a,!0);a+=Float32Array.BYTES_PER_ELEMENT;var C=new _(new u(f.getFloat64(a,!0),f.getFloat64(a+8,!0),f.getFloat64(a+16,!0)),f.getFloat64(a+l,!0));a+=c;var F=new u(f.getFloat64(a,!0),f.getFloat64(a+8,!0),f.getFloat64(a+16,!0));a+=l;var w=f.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;var P=new Uint16Array(t,a,3*w);a+=w*d,w>65536&&(p=Uint32Array.BYTES_PER_ELEMENT,v=3*p);var D,x=P.subarray(0,w),E=P.subarray(w,2*w),I=P.subarray(2*w,3*w),L=0,O=0,k=0;for(D=0;D<w;++D)L+=s(x[D]),O+=s(E[D]),k+=s(I[D]),x[D]=L,E[D]=O,I[D]=k;a%p!=0&&(a+=p-a%p);var R=f.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;var X=b.createTypedArrayFromArrayBuffer(w,t,a,3*R);a+=R*v;var Y=0;for(D=0;D<X.length;++D){var Z=X[D];X[D]=Y-Z,0===Z&&++Y}var j=f.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;var H=b.createTypedArrayFromArrayBuffer(w,t,a,j);a+=j*p;var B=f.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;var N=b.createTypedArrayFromArrayBuffer(w,t,a,B);a+=B*p;var G=f.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;var z=b.createTypedArrayFromArrayBuffer(w,t,a,G);a+=G*p;var V=f.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;var U=b.createTypedArrayFromArrayBuffer(w,t,a,V);a+=V*p;for(var W,q;a<f.byteLength;){var K=f.getUint8(a,!0);a+=Uint8Array.BYTES_PER_ELEMENT;var Q=f.getUint32(a,e._littleEndianExtensionSize);a+=Uint32Array.BYTES_PER_ELEMENT,K===A.OCT_VERTEX_NORMALS&&e._requestVertexNormals?W=new Uint8Array(t,a,2*w):K===A.WATER_MASK&&e._requestWaterMask&&(q=new Uint8Array(t,a,Q)),a+=Q}var J,$=5*e.getLevelMaximumGeometricError(i),ee=e._tilingScheme.tileXYToRectangle(o,r,i);return ee.width<T.PI_OVER_TWO+T.EPSILON5&&(J=M.fromRectangle(ee,y,m,e._tilingScheme.ellipsoid)),new S({center:g,minimumHeight:y,maximumHeight:m,boundingSphere:C,orientedBoundingBox:J,horizonOcclusionPoint:F,quantizedVertices:P,encodedNormals:W,indices:X,westIndices:H,southIndices:N,eastIndices:z,northIndices:U,westSkirtHeight:$,southSkirtHeight:$,eastSkirtHeight:$,northSkirtHeight:$,childTileMask:h(e,i,o,n),waterMask:q})}function h(e,t,i,o){var r=e._availableTiles;if(!r||0===r.length)return 15;var n=t+1;if(n>=r.length)return 0;var s=r[n],a=0;return a|=l(s,2*i,2*o)?1:0,a|=l(s,2*i+1,2*o)?2:0,a|=l(s,2*i,2*o+1)?4:0,a|=l(s,2*i+1,2*o+1)?8:0}function l(e,t,i){for(var o=0,r=e.length;o<r;++o){var n=e[o];if(t>=n.startX&&t<=n.endX&&i>=n.startY&&i<=n.endY)return!0}return!1}var c,d=Freedo.Uri,p=Freedo.when,_=Freedo.BoundingSphere,u=Freedo.Cartesian3,v=Freedo.Credit,f=Freedo.defaultValue,g=Freedo.defined,y=Freedo.defineProperties,m=Freedo.DeveloperError,C=Freedo.Event,F=Freedo.GeographicTilingScheme,w=Freedo.HeightmapTerrainData,b=Freedo.IndexDatatype,P=(Freedo.joinUrls,Freedo.loadArrayBuffer),T=(Freedo.loadJson,Freedo.Math),M=(Freedo.Matrix3,Freedo.OrientedBoundingBox),S=Freedo.QuantizedMeshTerrainData,D=(Freedo.RuntimeError,Freedo.TerrainProvider),x=Freedo.TileProviderError,E={},I="undefined"!=typeof document?new d(document.location.href):new d;r.maximumRequestsPerServer=6,void 0!==(c=function(){"use strict";function e(e){function t(e){var t;if(!e.format)return t="The tile format is not specified in the layer.json file.",void(r=x.handleError(r,n,n._errorEvent,t,void 0,void 0,void 0,requestMetadata));if(!e.tiles||0===e.tiles.length)return t="The layer.json file does not specify any tile URL templates.",void(r=x.handleError(r,n,n._errorEvent,t,void 0,void 0,void 0,requestMetadata));if("heightmap-1.0"===e.format)n._heightmapStructure={heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:512,isBigEndian:!1,lowestEncodedHeight:0,highestEncodedHeight:262143},n._hasWaterMask=!0,n._requestWaterMask=!0;else if(0!==e.format.indexOf("quantized-mesh-1."))return t='The tile format "'+e.format+'" is invalid or not supported.',void(r=x.handleError(r,n,n._errorEvent,t,void 0,void 0,void 0,requestMetadata));n._tileUrlTemplates=n._url,n._availableTiles=e.available,!g(n._credit)&&g(e.attribution)&&null!==e.attribution&&(n._credit=new v(e.attribution)),g(e.extensions)&&-1!==e.extensions.indexOf("octvertexnormals")?n._hasVertexNormals=!0:g(e.extensions)&&-1!==e.extensions.indexOf("vertexnormals")&&(n._hasVertexNormals=!0,n._littleEndianExtensionSize=!1),g(e.extensions)&&-1!==e.extensions.indexOf("watermask")&&(n._hasWaterMask=!0),n._ready=!0,n._readyPromise.resolve(!0)}if(!g(e)||!g(e.url))throw new m("options.url is required.");this.maxLevel=f(e.maxLevel,0),this._url=e.url,this._proxy=e.proxy,this._tilingScheme=new F({numberOfLevelZeroTilesX:18,numberOfLevelZeroTilesY:9,ellipsoid:e.ellipsoid}),this._heightmapWidth=150,this._levelZeroMaximumGeometricError=D.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.ellipsoid,this._heightmapWidth,this._tilingScheme.getNumberOfXTilesAtLevel(0)),this._heightmapStructure=void 0,this._hasWaterMask=!1,this._hasVertexNormals=!1,this._requestVertexNormals=f(e.requestVertexNormals,!1),this._littleEndianExtensionSize=!0,this._requestWaterMask=f(e.requestWaterMask,!1),this._errorEvent=new C;var i=e.credit;"string"==typeof i&&(i=new v(i)),this._credit=i,this._ready=!1,this._readyPromise=p.defer();var o=this._url;g(this._proxy)&&(o=this._proxy.getURL(o));var r,n=this;!function(){t({tilejson:"2.1.0",format:"heightmap-1.0",version:"1.0.0",scheme:"tms",tiles:["?"]})}()}return e.prototype.requestTileGeometry=function(e,t,i,o){function h(e){return P(e,n(y))}if(!this._ready)throw new m("requestTileGeometry must not be called before the terrain provider is ready.");var l=this._tileUrlTemplates;if(0!==l.length){var c=this._tilingScheme.getNumberOfYTilesAtLevel(i),d=c-t-1,_=l.replace("{TileMatrix}",i).replace("{TileCol}",e).replace("{TileRow}",t),u=this._proxy;g(u)&&(_=u.getURL(_));var v,y=[];if(this._requestVertexNormals&&this._hasVertexNormals&&y.push(this._littleEndianExtensionSize?"octvertexnormals":"vertexnormals"),this._requestWaterMask&&this._hasWaterMask&&y.push("watermask"),o=f(o,!0)){if(v=r(_,h),!g(v))return}else v=h(_);var C=this;return p(v,function(o){return g(C._heightmapStructure)?s(C,o,i,e,t,d):a(C,o,i,e,t,d)})}},e.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)},e.prototype.getTileDataAvailable=function(e,t,i){var o=this._availableTiles;if(o&&0!==o.length){if(i>=o.length)return!1;return l(o[i],e,this._tilingScheme.getNumberOfYTilesAtLevel(i)-t-1)}},y(e.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){if(!this._ready)throw new m("credit must not be called before the terrain provider is ready.");return this._credit}},tilingScheme:{get:function(){if(!this._ready)throw new m("tilingScheme must not be called before the terrain provider is ready.");return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},hasWaterMask:{get:function(){if(!this._ready)throw new m("hasWaterMask must not be called before the terrain provider is ready.");return this._hasWaterMask&&this._requestWaterMask}},hasVertexNormals:{get:function(){if(!this._ready)throw new m("hasVertexNormals must not be called before the terrain provider is ready.");return this._hasVertexNormals&&this._requestVertexNormals}},requestVertexNormals:{get:function(){return this._requestVertexNormals}},requestWaterMask:{get:function(){return this._requestWaterMask}}}),e}.call(t,i,t,e))&&(e.exports=c);var A={OCT_VERTEX_NORMALS:1,WATER_MASK:2}}]);